// Generated with grunt. Do not edit!


angular.$=angular.element,angular.$.prototype.parent=function(e){if(!e)return angular.$(this[0].parentNode);for(var t,i=[].slice.call(document.querySelectorAll(e)),n=this[0];"HTML"!==n.nodeName;){n=n.parentNode,-1===i.indexOf(n)||(t=n,n=document.documentElement)}return angular.$(t)};"use strict";var debug=!0;angular.module("seroApp.services",[]),angular.module("seroApp.directives",[]),angular.module("seroApp.controllers",[]),angular.module("pax.validations",[]);var seroApp=angular.module("seroApp",["ngRoute","ngResource","ngAnimate","ngMessages","ngSanitize","ui.bootstrap","ui.select2","ngFileUpload","ui.grid","ui.grid.edit","ui.grid.rowEdit","ui.grid.cellNav","ui.grid.resizeColumns","ui.grid.moveColumns","ui.grid.selection","seroApp.services","seroApp.directives","seroApp.controllers","pax.validations"]).config(["$routeProvider","$rootScopeProvider",function(e,t){t.digestTtl(500);var i={templateUrl:"partials/projectTabs.html",controller:"ProjectTabsController"};e.when("/",{templateUrl:"partials/home.html",controller:"HomeController"}),e.when("/projects",{templateUrl:"partials/projects.html",controller:"ProjectsController"}),e.when("/projects/:projectId",i),e.when("/projects/:projectId/eiaspermits",i),e.when("/projects/:projectId/eiaspermits/:eiapermitId",i),e.when("/projects/:projectId/eiaspermits/:eiapermitId/documents",i),e.when("/projects/:projectId/eiaspermits/:eiapermitId/documents/:documentId",i),e.when("/projects/:projectId/eiaspermits/:eiapermitId/documents/:documentId/hearings",i),e.when("/projects/:projectId/eiaspermits/:eiapermitId/documents/:documentId/hearings/:hearingId",i),e.when("/projects/:projectId/externalaudits",i),e.when("/projects/:projectId/externalaudits/:externalauditId",i),e.when("/projects/:projectId/externalaudits/:externalauditId/documents",i),e.when("/projects/:projectId/externalaudits/:externalauditId/documents/:documentId",i),e.when("/projects/:projectId/auditsinspections",i),e.when("/projects/:projectId/auditsinspections/:auditinspectionId",i),e.when("/projects/:projectId/permitslicenses",i),e.when("/projects/:projectId/permitslicenses/:permitlicenseId",i);var n={templateUrl:"partials/searchTabs.html",controller:"SearchTabsController"};e.when("/search",{redirectTo:"/search/projects"}),e.when("/search/projects",n),e.when("/search/eiaspermits",n),e.when("/search/permitslicenses",n),e.when("/search/auditsinspections",n),e.when("/search/externalaudits",n);e.when("/statistics",{redirectTo:"/statistics/projects"}),e.when("/statistics/projects",{templateUrl:"partials/statisticsTabs.html",controller:"StatisticsTabsController"}),e.when("/advanced/codes",{templateUrl:"partials/advancedCodes.html",controller:"AdvancedCodesController"}),e.when("/advanced/users",{templateUrl:"partials/advancedUsers.html",controller:"AdvancedUsersController"}),e.when("/advanced/emailOrders",{templateUrl:"partials/advancedEmailOrder.html",controller:"AdvancedEmailOrderController"}),e.when("/advanced/leadagencies",{templateUrl:"partials/advancedLeadAgency.html",controller:"AdvancedLeadAgenciesController"}),e.when("/advanced/pirking/statusEIA",{templateUrl:"partials/eiapermit-pirking.html",controller:"EiapermitPirkingController"}),e.when("/advanced/pirking/statusEA",{templateUrl:"partials/externalAudit-pirking.html",controller:"ExternalAudiPirkingController"}),e.when("/advanced/pirking/statusAI",{templateUrl:"partials/auditInspection-pirking.html",controller:"AuditInspecitionPirkingController"}),e.when("/advanced/pirking/statusPL",{templateUrl:"partials/permitlicense-pirking.html",controller:"PermitLicensePirkingController"}),e.when("/advanced/anonymize-data",{templateUrl:"partials/anonymize-data.html",controller:"DataAnonymizerController"}),e.when("/about",{templateUrl:"partials/about.html"}),e.when("/login",{templateUrl:"partials/login.html",controller:"UserController"}),e.when("/password/send",{templateUrl:"partials/passwordSend.html",controller:"LoginController"}),e.when("/password/reset/:token",{templateUrl:"partials/passwordReset.html",controller:"LoginController"}),e.when("/user",{templateUrl:"partials/user.html",controller:"UserController"}),e.when("/practitioners",{templateUrl:"partials/practitioners.html",controller:"PractitionersController"}),e.when("/public/practitioners",{templateUrl:"partials/publicPractitioners.html",controller:"PractitionersController"}),e.otherwise({redirectTo:"/"})}]).factory("authHttpResponseInterceptor",["$q","$location",function(t,i){return{responseError:function(e){return 0==i.path().indexOf("/password/reset/")||"/public/practitioners"==i.path()||401===e.status&&i.path("/login"),t.reject(e)}}}]).factory("unsavedDataProtection",["$q","$location",function(e,t){return{request:function(e){return"GET"!=e.method?window.globalWordCount="":window.interceptPageNavigation(),e}}}]).config(["$httpProvider",function(e){e.interceptors.push("authHttpResponseInterceptor"),e.interceptors.push("unsavedDataProtection")}]),SavingStateEnum={None:"None",LoadingNew:"Loading new",Loading:"Loading",Loaded:"Loaded",SavingStarted:"Saving started",SavingFinished:"Saving finished",SavingFailed:"Saving failed",Invalid:"Form not valid",MissingDependency:"Missing dependency in other form"},DisplayStateEnum={Show:!0,Hide:!1},ProjectTabEnum={Project:"Project",EiasPermits:"EIAS",PermitsLicenses:"Permits and Licenses",AuditsInspections:"Audits and Inspections",ExternalAudits:"External audits"},EiasPermitsTabEnum={EiaPermit:"EIA",Documents:"Documents",Hearings:"Hearings"},ExternalAuditsTabEnum={ExternalAudit:"External audit",Documents:"Documents",Hearings:"Hearings"},SearchTabEnum={Projects:"Projects",EiasPermits:"EIAS",PermitsLicenses:"Permits and Licenses",AuditsInspections:"Audits and Inspections",ExternalAudits:"External audits"},StatisticsTabEnum={Projects:"Projects",EiasPermits:"EIAS",AuditsInspections:"Audits and Inspections"},DocumentTagEnum={PermitLicenseApplicationForm:"Application form",PermitLicensePermitLicense:"Permit or license",PermitLicenseAttachments:"Attachment to the application"},fileUploadPattern="image/*,application/pdf,application/vnd.openxmlformats*,application/msword,text/plain,text/csv,application/octet-stream,binary/octet-stream,.xls,.xlsx,.docx",fileUploadNgfPattern="'image/*,application/pdf,application/vnd.openxmlformats*,application/msword,text/plain,text/csv,application/octet-stream,binary/octet-stream,.xls,.xlsx,.docx'",fileUploadMaxSize="50MB",exportObj={};function so(){console.log("ca")}function isCoordinateWithinUganda(e,t,i){if(!e||!t)return i(!1,{error:"undefined coordinates"});fetch("https://nominatim.openstreetmap.org/reverse?format=json&lat="+e+"&lon="+t,{headers:{"content-type":"application/json"},method:"GET",mode:"cors"}).then(function(e){return e.json()}).then(function(e){return e.address&&"ug"==e.address.country_code?i(!0,e):i(!1,e)}).catch(function(){return i(!1,{error:"network"})})}exportObj.exportMetaData={},exportObj.exportData=function(e,t){var i=this.exportMetaData[t];excelExport(e,i,t)},exportObj.exportMetaData.emailOrders={fieldmap:{id:"ID",foreign_id:"Document ID",foreign_type:"Document Type",order_status:"Order Status",subject:"Subject",unformatted_body:"Body",recipient:"Recipient",cc:"CC",bcc:"BCC",remarks_from_service:"Remarks from Service",remarks:"Remarks",number_of_attempts:"Number of Attempts",created_by:"Created By",formatted_created_at:"Created On",updated_by:"Updated By",formatted_updated_at:"Updated On",formatted_deleted_at:"Deleted On"},dateFields:["formatted_created_at","formatted_updated_at","formatted_deleted_at"]},exportObj.exportMetaData.auditAndInspection={fieldmap:{auditinspection_code:"Control number",auditinspection_status:"Audit and inspection status",auditinspection_year:"Year",auditinspection_type:"Activity",auditinspection_reason:"Type",lead_officer_name:"Lead officer",other_officer_name:"Other officers",auditinspection_date_carried_out:"Date carried out",auditinspection_days:"Number of days",auditinspection_external_participants:"Participants from lead agencies, facilities etc.",auditinspection_coordinated:"Multisectoral",lead_agency_name:"Lead agencies",auditinspection_date_action_taken:"Date of response",auditinspection_action_taken:"Response",auditinspection_advance_notice:"Advanced notice",auditinspection_findings:"Description of findings",auditinspection_performance_level:"Performance level",auditinspection_recommendations:"Recommendations",auditinspection_date_deadline:"Follow-up date",auditinspection_date_closing:"Activity ended",auditinspection_remarks:"Remarks",project_id:"Project ID",project_title:"Project name",category_description:"Category",district_district:"District",organisation_id:"Developer ID",developer_name:"Developer name"},dateFields:["auditinspection_date_carried_out","auditinspection_date_deadline","auditinspection_date_closing","auditinspection_date_action_taken"]},exportObj.exportMetaData.project={fieldmap:{project_id:"Project ID",project_title:"Project name",category_description:"Category",district_district:"District",project_location:"Location",project_longitude:"Longitude",project_latitude:"Latitude",project_has_industrial_waste_water:"Industrial waste water?",project_risk_level:"Risk level",project_contact_person:"Contact person",project_remarks:"Project remarks",organization_id:"Developer ID",developer_name:"Developer name",developer_tin:"TIN",organization_visiting_address:"Visiting address",organization_physical_address:"Physical address",organization_box_no:"PO box",organization_city:"City",organization_phone:"Phone",organization_fax:"Fax",organization_email:"Email",organization_remarks:"Developer remarks"},dateFields:[]},exportObj.exportMetaData.exportPermitsLicenses={fieldmap:{permitlicense_id:"Permit and license ID",permitlicense_regulation:"Regulation",permitlicense_date_submitted:"Date of submission",permitlicense_waste_license_type:"Waste license type",permitlicense_ecosystem:"Ecosystem",permitlicense_regulation_activity:"Regulation activity",permitlicense_area:"Area",permitlicense_unit:"Unit",permitlicense_approved_by_the_lc1:"LC1 approved",permitlicense_approved_by_the_dec:"DEC approved",permitlicense_application_number:"Application number",permitlicense_application_fee_receipt_number:"Application fee receipt number",permitlicense_date_feedback_to_applicants:"Date feedback to applicants",permitlicense_date_sent_officer:"Date feedback to applicants",permitlicense_date_sent_to_director:"Date sent to Director",permitlicense_date_sent_from_dep:"Date sent to team leader from dep",permitlicense_date_sent_officer:"Date sent to the officer",permitlicense_officer_assigned:"Team leader",permitlicense_handling_officer:"Officers to handle",permitlicense_officer_evaluation:"Application evaluation by officer",permitlicense_date_of_evaluation:"Date of evaluation",permitlicense_folio_no:"File and foliono.",permitlicense_inspection_recommended:"Inspection before decision ?",permitlicense_date_inspection:"Date of inspection",permitlicense_officer_recommend:"Recommendations by reviewer",permitlicense_fee_receipt_no:"Permit/license fee receipt number",permitlicense_date_fee_payed:"Date permit / license fee paid",permitlicense_date_sent_for_decision:"Date sent for decision",permitlicense_decision:"Decision taken",permitlicense_signature_on_permit_license:"Signature on permit / license",permitlicense_date_permit_license:"Date on the permit / licence",permitlicense_permit_license_no:"Permit / license number",permitlicense_date_permit_license_expired:"Date permit / license expired",permitlicense_documentation_files:"Soft copy",project_id:"Project ID",project_title:"Project name",category_name:"Category",district_district:"District",organisation_id:"Developer ID",organisation_name:"Developer name"},dateFields:["permitlicense_date_submitted","permitlicense_date_sent_to_director","permitlicense_date_sent_from_dep","permitlicense_date_sent_officer","permitlicense_date_of_evaluation","permitlicense_date_inspection","permitlicense_date_fee_payed","permitlicense_date_sent_for_decision","permitlicense_date_permit_license","permitlicense_date_permit_license_expired","permitlicense_date_feedback_to_applicants"]},exportObj.exportMetaData.eiaspermits={fieldmap:{eiapermit_id:"EIA and permit ID",eiapermit_status:"EIA status",practitioner_teamleader:"Practitioner team leader",cost:"Cost of the proposed development",eiapermit_cost_currency:"Cost currency",eiapermit_expected_jobs_created:"Expected jobs created",team_leader_name:"Team leader",personnel_officers_name:"Officers to handle",eias_permits_inspection_recommendation:"Inspection before decision?",eiapermit_date_inspection:"Date of inspection",eiapermit_officer_recommend:"Recommendations by reviewer",eiapermit_fee:"Expected fees",eiapermit_fee_currency:"Fee currency",eiapermit_date_sent_ded_approval:"Date sent for approval",eiapermit_decision:"Decision taken",eiapermit_date_decision:"Date for decision",eiapermit_date_fee_notification:"Date of invoicing",eiapermit_date_fee_payed:"Date invoice is payed",eiapermit_fee_receipt_no:"Fee receipt number",eiapermit_designation:"Signature on certificate",eiapermit_date_certificate:"Date on the certificate",eiapermit_certificate_no:"Certificate number",eiapermit_date_cancelled:"Certificate canceled date",eiapermit_remarks:"Remarks",file_metadata:"Soft copy of certificate",document_codes:"Documents",project_id:"Project ID",project_title:"Project name",category_description:"Category",district_district:"District",developer_id:"Developer ID",developer_name:"Developer name"},dateFields:["eiapermit_date_inspection","eiapermit_date_sent_ded_approval","eiapermit_date_decision","eiapermit_date_fee_notification","eiapermit_date_fee_payed","eiapermit_date_certificate","eiapermit_date_cancelled"]},exportObj.exportMetaData.externalAudit={fieldmap:{externalaudit_id:"External audit ID",externalaudit_status:"Status",ea_type:"Type of external audit",team_leader:"Team leader",handling_officers:"Officers to handle",verification_inspection:"Verification inspection?",date_inspection:"Date of inspection",date_response:"Date of response",file_metadata_response_id:"Response letter",review_findings:"Review findings",response:"Response",date_deadline_compliance:"Date for complete compliance",doc_code:"Documents",project_id:"Project ID",project_project_name:"Project name",category_name:"Category",district_district:"District",organisation_id:"Developer ID",organisation_name:"Developer name",date_create_invoice:"Date of invoice creation",date_invoice_receipt_issued:"Date invoice was issued",date_invoice_payment:"Date invoice was paid"},dateFields:["date_inspection","date_response","date_create_invoice","date_invoice_receipt_issued","date_invoice_payment"]},exportObj.exportMetaData.practitioners={fieldmap:{practitioner:"Practitioner",tin:"TIN",organisation_name:"Organisation Name",visiting_address:"Address",box_no:"P.O. Box",phone:"Phone",fax:"Fax",email:"Email",qualifications:"Qualifications",expertise:"Expertise",remarks:"Remarks",year:"Year",date_of_entry:"Date of entry",cert_type:"Type of certificate",cert_no:"Certificate number",conditions:"Conditions",is_cancelled:"Cancelled?"},dateFields:[]};var regexIso8601=/^(\d{4}-\d{2}-\d{2} \d{2}\:\d{2}\:\d{2})$/;function convertDateStringsToDates(e){if("object"!=typeof e)return e;for(var t in e)if(e.hasOwnProperty(t)){var i,n=e[t];if("string"==typeof n&&(i=n.match(regexIso8601))){var r=i[0].replace(" ","T");r+="Z",e[t]=new Date(r)}else"object"==typeof n&&convertDateStringsToDates(n)}}seroApp.config(["$httpProvider",function(e){e.defaults.transformResponse.push(function(e){return convertDateStringsToDates(e),e})}]);var uploadFile=function(e,t,i,n,r,a){n.$setValidity("serverError",!0);var o=e.defer();return r&&!r.$error?(r.upload=i.upload({url:"/file/v1/upload",file:r,fields:{tag:a}}),r.upload.then(function(e){t(function(){r.result=e.data,o.resolve(r)})},function(e){0<e.status&&(n.$setValidity("serverError",!1),r.progress=0,r.error=e.status+": "+e.data.message,o.reject(r.error))}),r.upload.progress(function(e){r.progress=Math.min(100,parseInt(100*e.loaded/e.total))})):o.reject("Validation error."),o.promise};function addDays(e,t){var i=new Date(e);return i.setDate(i.getDate()+t),i}function updateExternalAuditStatus(e,t){var r=null,i=_.groupBy(t,function(e){return e.type});if(e.date_deadline_compliance)return console.log(e),e.status=147,!0;if(e.date_response)return e.status=146,!0;if(t.length){if(console.log(e),i[12])var n=i[12][0],a={date_submitted:142,date_sent_director:143,date_sent_from_dep:144,date_sent_officer:145};else if(i[11])n=i[11][0],a={date_submitted:137,date_sent_director:138,date_sent_from_dep:139,date_sent_officer:140,date_conclusion:141};return function(e,t){for(var i=Object.keys(t),n=0;n<i.length;n++)console.log(e[i[n]],i[n],"find set keys"),e[i[n]]&&(r=t[i[n]])}(n,a),e.status=r,!0}return!1}function updateAuditInspectionStatus(e){return e.date_closing?e.status=75:e.date_received?e.status=74:e.date_deadline&&e.date_deadline<new Date?e.status=73:e.action_taken?e.status=72:e.date_carried_out&&(e.status=71),!![71,72,73,74,75].includes(e.status)}function updateEiaPermitStatus(e,t){var i=e.status,n=null;if(e.date_cancelled)n=37;else if(e.certificate_no)n=36;else if(e.fee_receipt_no)n=35;else if(e.date_fee_notification)n=34;else if(e.date_decision)n=33;else if(e.date_sent_ded_approval)n=32;else{var r=_.groupBy(t,function(e){return e.type}),a=0,o={13:{conclusion:59,date_dispatched:58,date_sent_officer:57,date_sent_from_dep:56,date_sent_director:55,date_submitted:54},10:{date_dispatched:31,date_sent_officer:30,date_sent_from_dep:29,date_sent_director:28,date_submitted:27},9:{conclusion:26,date_dispatched:25,date_sent_officer:24,date_sent_from_dep:23,date_sent_director:22,date_submitted:21},8:{conclusion:20,date_dispatched:19,date_sent_officer:18,date_sent_from_dep:17,date_sent_director:16,date_submitted:15}};_.forEach([13,10,9,8],function(t){var e=r[t];if(e){var i=0;return _.forEach(e,function(e){e.conclusion&&_.includes([78,79],e.conclusion)&&o[t].conclusion?i=o[t].conclusion:e.date_sent_officer?i=o[t].date_sent_officer:e.date_sent_from_dep?i=o[t].date_sent_from_dep:e.date_sent_director?i=o[t].date_sent_director:e.date_submitted&&(i=o[t].date_submitted),a<i&&(a=i)}),!1}}),0<a&&(n=a)}return i!=n&&(e.status=n,!0)}function updatePermitLicenseStatus(e){return e.date_permit_license_expired&&e.date_permit_license_expired<new Date?e.status=157:e.permit_license_no?e.status=156:e.fee_receipt_no?e.status=154:e.date_sent_for_decision?e.status=155:e.date_of_evaluation?e.status=153:e.date_sent_officer?e.status=152:e.date_sent_from_dep?e.status=151:e.date_sent_to_director?e.status=150:e.date_submitted&&(e.status=149),!0}function showNavBarItems(e){var t=document.querySelectorAll(".navbar-nav, .navbar-right");t[0].style.display=t[1].style.display=e?"block":"none"}function toggleNavBarItems(e,t){if(0==(t=t||!1)&&(t={path:function(){return"/public/"}}),0==t.path().startsWith("/public/")||1==t.path().startsWith("/public/")&&"Not signed in"!=e.info.name)return showNavBarItems(!0);showNavBarItems(!1)}window.unsavedDataProtectionIgnoredSubPaths=["#/practitioners","/#/search","#/statistics","#/about","#/advanced","/#/user"],window.unsavedDataProtectionIgnoredExactPaths=["#/projects"],window.verifyEmailList=function(e){var t=e;t=t.split(";");for(var i=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,n=[],r=0;r<t.length;r++)t[r]=t[r].trim(),""!=t[r]&&i.test(t[r])||n.push(t[r]);return 0==n.length},window.createEmailOrder=function(e,t,i,n){fetch("/api/v1/create-email-order/"+e.toLowerCase()+"/"+t+"/"+i).then(function(e){return e.json()}).then(function(t){fetch("/cron-route").then(function(e){return e.json()}).then(function(e){t.order_status=e.order_status,n(t)})})},window.emailerStatusObj=[{index:0,type:"non_existent",btnMsg:"Send email"},{index:1,type:"processing",btnMsg:"Sending email..."},{index:2,type:"processing",btnMsg:"Sending email..."},{index:3,type:"processed",btnMsg:"Email sent"},{index:4,type:"failed",btnMsg:"Email failed"}],Number.prototype.countDecimals=function(){return Math.floor(this.valueOf())===this.valueOf()?0:this.toString().split(".")[1].length||0},Number.prototype.truncateDecimal=function(e){var t=new RegExp("(\\d+\\.\\d{"+e+"})(\\d)"),i=this.toString().match(t);return i?parseFloat(i[1]):this.valueOf()},Number.prototype.isOneOf=function(e){for(var t=e.length,i=0;i<t;i++){var n=this==e[i];if(n)break}return n},Date.prototype.humanDate=function(){return this.getDate()+" "+["January","February","March","April","May","June","July","August","September","October","November","December"][this.getMonth()]+" "+this.getFullYear()},Array.prototype.searchObj=function(t,i){return this.find(function(e){return e[t]==i})},(controllers=angular.module("seroApp.controllers")).controller("DatePickerController",["$scope",function(t){t.open=function(e){e.preventDefault(),e.stopPropagation(),t.opened=!0},t.datepickerOptions={startingDay:1}}]),controllers.controller("DatePickerSearchController",["$scope",function(t){t.open=function(e){e.preventDefault(),e.stopPropagation(),t.opened=!0},t.datepickerOptions={startingDay:1}}]),controllers.controller("NavBarController",["$scope","$location","UserInfo","EnvInfo",function(t,i,e,n){t.userinfo=e,t.$watch("userinfo",function(e,t){toggleNavBarItems(e,i)}),n(function(e){t.envinfo=e.env,t.lvVersion=e.lv_version}),t.isActive=function(e){return e===i.path()},t.isAdvancedActive=function(e){return 0==i.path().indexOf(e)},t.hasAccess=function(e){return!!t.userinfo.info.role_8}}]),controllers.controller("HomeController",["$scope","GeneralStatistics",function(t,e){t.counts={},e.get({},function(e){t.counts=e.counts})}]),controllers.controller("UserController",["$scope","UserInfo",function(e,t){showNavBarItems(!0),e.userinfo=t,e.userid_to_impersonate=null,e.impersonate=function(){e.userinfo.impersonate(e.userid_to_impersonate)}}]),controllers.controller("PractitionersController",["$scope","$filter","$animate","UserInfo","Practitioner","Valuelists",function(u,r,e,t,i,n){u.certificateYearMin=2e3,u.certificateYearMax=(new Date).getFullYear()+1,u.certificateYearValid=(new Date).getFullYear(),u.current=null,u.currentForm=null,u.userinfo=t,u.valuelists=n,i.query(function(e){u.practitioners=e}),setTimeout(function(){toggleNavBarItems(t)},3e3);var a=function(e,t,i,n){if(!e)return!1;return 0<r("filter")(e,function(e){return!(e.cert_type!=t||e.year!==i||0<n&&e.conditions!=n||e.is_deleted||e.is_cancelled)},!0).length};u.hasEiaTL=function(e){var t=a(e.practitioner_certificates,50,u.certificateYearValid,38);return e.cert_eia=t?"eia":null,t},u.hasEiaTM=function(e){var t=a(e.practitioner_certificates,50,u.certificateYearValid,39);return e.cert_eia=t?"eia":null,t},u.hasAuditTL=function(e){var t=a(e.practitioner_certificates,51,u.certificateYearValid,38);return e.cert_au=t?"audit":null,t},u.hasAuditTM=function(e){var t=a(e.practitioner_certificates,51,u.certificateYearValid,39);return e.cert_au=t?"audit":null,t},u.hasPartnershipEia=function(e){var t=a(e.practitioner_certificates,52,u.certificateYearValid,53);return e.cert_ep=t?"partnership":null,t},u.hasPartnershipEa=function(e){var t=a(e.practitioner_certificates,52,u.certificateYearValid,97);return e.cert_ep=t?"partnership":null,t},u.hasForeignPractitioner=function(e){var t="object"==typeof _.find(e.practitioner_certificates,"cert_type",148);return e.cert_ep=t?"ForeignPractitioner":null,t},u.newPractitioner=function(){if(u.currentForm&&u.currentForm.$invalid)alert("Current form not valid. Can't create new practitioner.");else{var e=new i({practitioner_certificates:[],is_new:!0});u.practitioners.unshift(e),u.toggleRow(e)}},u.deletePractitioner=function(e,t){u.current=null,t.is_new||t.$delete(),u.practitioners.splice(e,1)},u.deleteCertificate=function(e,t,i){i.is_new?t.practitioner_certificates.splice(e,1):(i.year=2e3,i.date_of_entry=new Date,i.cert_type=51,i.cert_no="CC/EA/022/00",i.number=22,i.conditions=39,i.is_deleted=!0,u.currentForm.$setDirty(),setTimeout(function(){u.toggleRow(t,!0)},0))},u.newCertificate=function(e){var t={year:u.certificateYearValid,date_of_entry:new Date,is_new:!0};t.cert_no=u.certificateNumber(t),e.practitioner_certificates.unshift(t)},u.calculateCertificateNumber=function(e){e.cert_no=u.certificateNumber(e)},u.canSave=function(){return u.userinfo.info.role_6};u.toggleRow=function(t,e){if(!u.loading){if(u.canSave()&&u.current){var i=u.current,n=u.currentForm;if(console.log(n.$invalid,n,"what is not valid"),n.$invalid)return void alert("Form not valid. Can't save.");n.$dirty&&(function(e){u.canSave()&&(e.is_new?e.$save({},function(e){o()}):e.$update({},function(e){console.log("save pract called",e),o()}))}(i),n.$setPristine())}u.current!=t||e?t.is_new?u.current=t:(u.loading=t).$get({},function(e){u.loading=null,u.current=t}):u.current=null}},u.setCurrentForm=function(e){u.currentForm=e},u.certificateNumber=function(e){var t="E",i=_.find(u.valuelists.practitionertype,{id:+e.cert_type});return i&&(t=i.description1),"CC/"+t+"/"+(e.number?("00"+e.number).slice(-3):"000")+"/"+(e.year?e.year.toString().substr(2):"00")},u.changeNumericBoolean=function(e){return 0===e?1:0};var o=function(){};function p(e){var t={EIA:"Environmental Impact Assessor",EA:"Environmental Auditor",EP:"Environmental Partnership",FP:"Foreign Practitioner"},i=u.valuelists.practitionertype.searchObj("id",e),n=i?i.description1:null;try{return t[n]?t[n]:i.description2}catch(e){return"NA"}}u.practitionerOrderBy=function(e){return e.person.trim().substring(e.person.trim().lastIndexOf(" "))},u.exportPractitioners=function(e){for(var t=e,i=[],n=t.length,r=0;r<n;r++)for(var a=t[r],o=a.practitioner_certificates,s=o.length,c=0;c<s;c++){var d=a.practitioner_title_id?u.valuelists.practitioner_title.searchObj("id",a.practitioner_title_id).description1:"",l=o[c];delete l.id,l.cert_type=p(l.cert_type),l.practitioner=d+" "+a.person,l.organisation_name=a.organisation_name,l.visiting_address=a.visiting_address,l.tin=a.tin,l.box_no=a.box_no+","+a.city,l.fax=a.fax,l.email=a.email,l.expertise=a.expertise,l.qualifications=a.qualifications,l.phone=a.phone,l.remark=a.remark,l.is_cancelled=l.is_cancelled?"YES":"NO",l.conditions=u.valuelists.practitionermembertype.searchObj("id",l.conditions).description2,l.date_of_entry=l.date_of_entry.humanDate(),i.push(l)}exportObj.exportData(i,"practitioners")},u.find=function(e,t,i){if(console.log(e,t,i),e&&t&&i)return _.find(e,t,i)}}]);var controllers,paginationCount=20,projectPagerOffset=0;controllers.controller("ProjectsController",["$scope","$location","$filter","Project","UserInfo",function(i,t,e,n,r){i.projectSearchTxt="Search",i.loadMoreProjectsTxt="Load more",i.projects=n.query({count:20}),i.projectsCount=0,n.query({countOnly:1},function(e){i.projectsCount=e[0]}),i.userinfo=r,i.goto=function(e){t.path(e)},i.canSave=function(){return i.userinfo.info.role_1},i.loadMoreProjects=function(){i.loadMoreProjectsTxt="Loading..",projectPagerOffset+=20,n.query({count:20,offset:projectPagerOffset,searchWord:i.searchWord},function(e){if(0!=e.length){var t=i.projects.concat(e);i.projects=t,i.loadMoreProjectsTxt="Load more"}else i.hideProjectLoader=!0})},i.searchProjects=function(){i.projectSearchTxt="Searching...",n.query({count:20,searchWord:i.searchWord},function(e){i.hideProjectLoader=!1,i.projects=e,i.projectSearchTxt="Search"})}}]),controllers.controller("ProjectTabsController",["$scope","$routeParams","$location","$q","$timeout","ProjectFactory","UserInfo","Valuelists",function(a,e,t,o,i,s,n,r){a.SavingStateEnum=SavingStateEnum,a.ProjectTabEnum=ProjectTabEnum,a.routeParams=e,a.userinfo=n,a.valuelists=r,a.data=s,a.loadMoreBtnTxt="Load more",a.searchBtnTxt="search",a.organisations=[];var c;a.tab=(c=t.path(),_.contains(c,"eiaspermits")?ProjectTabEnum.EiasPermits:_.contains(c,"auditsinspections")?ProjectTabEnum.AuditsInspections:_.contains(c,"externalaudits")?ProjectTabEnum.ExternalAudits:_.contains(c,"permitslicenses")?ProjectTabEnum.PermitsLicenses:ProjectTabEnum.Project),a.goto=function(e){i(function(){t.path(e)})},a.auth={},a.auth.canSave=function(){return!1},a.saveCurrent=function(t,e,i){if(i=void 0!==i&&i,t.saveInProgress&&t.isNew)return(n=o.defer()).reject(),n.promise;t.saveInProgress=!0;var n=o.defer();if(t.form.$pristine&&!i)t.saveInProgress=!1,n.reject();else if(!t.form.$invalid&&!this.coordinateError||t.isNew&&i){t.state=t.isNew?SavingStateEnum.LoadingNew:SavingStateEnum.SavingStarted;var r=a.routeParams;i&&(r=_.omit(r,"auditinspectionId"),r=_.omit(r,"eiapermitId"),r=_.omit(r,"externalauditId")),s.save(r,e).then(function(e){_.isUndefined(t.form)||(t.state=t.isNew?SavingStateEnum.LoadingNew:SavingStateEnum.SavingFinished,t.form.$setPristine(),t.saveInProgress=!1,n.resolve(e))},function(e){console&&console.log("Error on server:",e),t.state=SavingStateEnum.SavingFailed,t.saveInProgress=!1})}else t.state=SavingStateEnum.Invalid,t.saveInProgress=!1,n.reject();return n.promise}}]),controllers.controller("ProjectController",["$scope","$q","ProjectFactory","Organisation","$timeout",function(o,e,t,r,i){function a(e){function t(t){var e="None";if(t.address.city)(a=_.find(o.valuelists.district,function(e){return e.description1.trim().toLowerCase()==t.address.city.trim().toLowerCase()}))&&(e=a.description1);else if(t.address.state)e=t.address.state;else for(var i=t.display_name.split(","),n=i.length,r=0;r<n;r++){var a;(a=_.find(o.valuelists.district,function(e){return e.description1.trim().toLowerCase()==i[r].trim().toLowerCase()}))&&(e=a.description1)}return e.trim().toLowerCase()}var i,n,r=_.find(o.valuelists.district,"id",parseInt(o.data.project.district_id)).description1.trim().toLowerCase(),a=t(e);return r==a||(i=a,(n=["kwania","apac"]).includes(r)&&n.includes(i))?(o.districtState.isError=DisplayStateEnum.Hide,!0):(o.districtState.isError=DisplayStateEnum.Show,o.districtState.suggestion="apac"==t(e)?"Apac/Kwania":t(e),!1)}if(o.selectOrganisationMode=!1,o.isNewProject=!1,o.coordinateError=DisplayStateEnum.Hide,o.districtState={isError:DisplayStateEnum.Hide,suggestion:""},o.currentCoordinateObject={},o.coordinateNetworkIssues=DisplayStateEnum.Hide,o.checkingCoordinates=!1,o.currentLong="",o.currentLat="",o.parts={project:{form:null,state:SavingStateEnum.Loading},organisation:{form:null,state:SavingStateEnum.Loading}},o.newProjectExisitingOrganisation=function(e){o.selectOrganisationMode=!1,t.setOrganisation(e).then(function(e){o.parts.organisation.state=SavingStateEnum.Loaded}),0<t.project.id?(t.project.organisation_id=e.id,i(function(){o.saveCurrentProject(!0)})):t.createNewProject(e),o.parts.project.state=SavingStateEnum.Loaded},o.newProjectNewOganisation=function(){o.selectOrganisationMode=!1,t.createNewOrganisation(),0<t.project.id||t.createNewProject(o.data.organisation),o.parts.project.state=SavingStateEnum.Loaded,o.parts.organisation.state=SavingStateEnum.Loaded,o.parts.organisation.isNew=!0},o.loadMoreDevelopers=function(e){o.loadMoreBtnTxt="Loading...",paginationCount+=20;var t=o.data.searchWord,i=r.query({offset:paginationCount,searchWord:t}),n=o.organisations;i.$promise.then(function(e){var t=e[0].organisations,i=n.concat(t);o.organisations=i.sort(o.projectSortScript),o.currentCount=e[0].properties.currentCount,o.loadMoreBtnTxt="Load more"})},o.search=function(){o.searchBtnTxt="searching...";var e=o.data.searchWord;paginationCount=0,r.query({searchWord:e}).$promise.then(function(e){var t=e[0].organisations.sort(o.projectSortScript);o.organisations=t,o.totalCount=e[0].properties.totalCount,o.currentCount=e[0].properties.currentCount,o.searchBtnTxt="search"})},o.saveCurrentProject=function(e){if(e=void 0!==e&&e,o.isNewProject)o.saveNewProjectAndNewOrganisation();else{var t=o.data.project;o.saveCurrent(o.parts.project,t,e).then(function(e){})}},o.saveCurrentOrganisation=function(){if(o.isNewProject)o.saveNewProjectAndNewOrganisation();else{var t=o.data.project,e=o.data.organisation;o.saveCurrent(o.parts.organisation,e).then(function(e){e.id!==t.organisation_id&&(t.organisation_id=e.id,o.saveCurrentProject(!0))})}},o.saveNewProjectAndNewOrganisation=function(){var t=o.parts.project,e=o.parts.organisation;if(t.form.$invalid||this.coordinateError)return o.parts.project.state=SavingStateEnum.Invalid,void(e.form.$dirty&&(o.parts.organisation.state=SavingStateEnum.MissingDependency));if(t.form.$valid&&e.form.$invalid)return o.parts.project.state=SavingStateEnum.MissingDependency,void(o.parts.organisation.state=SavingStateEnum.Invalid);if(t.form.$valid&&e.form.$valid){var i=o.data.project,n=o.data.organisation;e.form.$pristine?(i.organisation_id=n.id,o.saveCurrent(t,i).then(function(e){o.goto("/projects/"+e.id)})):o.saveCurrent(e,n).then(function(e){i.organisation_id=e.id,o.saveCurrent(t,i).then(function(e){o.goto("/projects/"+e.id)})})}},o.auth.canSave=function(e){switch(e){case"has_industrial_waste_water":return o.userinfo.info.role_3;default:return o.userinfo.info.role_1}},o.auth.canDelete=function(){return!o.isNewProject&&(o.parts.project.state!=SavingStateEnum.Loading&&(!(0<o.data.eiaspermits.length||0<o.data.auditsinspections.length)&&o.auth.canSave()))},o.deleteProject=function(){t.deleteProject(o.routeParams).then(function(){o.goto("/projects")})},o.changeDeveloper=function(){o.selectOrganisationMode=!0,r.query().$promise.then(function(e){o.organisations=e[0].organisations.sort(o.projectSortScript),o.totalCount=e[0].totalCount,o.currentCount=e[0].currentCount})},o.verifyCoordinates=function(e,t){if(!t||o.parts.project.state!=SavingStateEnum.Loading){var i=o.data.project.latitude?o.data.project.latitude.trim():o.data.project.latitude,n=o.data.project.longitude?o.data.project.longitude.trim():o.data.project.longitude;o.data.project.latitude=i,o.data.project.longitude=n,!o.isNewProject||i||n?o.parts.project.state!=SavingStateEnum.Loading&&(o.currentLong==n&&o.currentLat==i||(i||n?(o.currentLat=i,o.currentLong=n,r(!0),isCoordinateWithinUganda(i,n,function(e,t){o.$apply(function(){e?(o.currentCoordinateObject=t,o.coordinateError=DisplayStateEnum.Hide,a(t),o.saveCurrentProject()):(document.getElementById("latitude").classList.remove("ng-valid"),document.getElementById("longitude").classList.remove("ng-valid"),o.coordinateError=DisplayStateEnum.Show,"network"==t.error?o.coordinateNetworkIssues=DisplayStateEnum.Show:o.coordinateNetworkIssues=DisplayStateEnum.Hide),r(!1)})})):o.coordinateError=DisplayStateEnum.Hide)):o.coordinateError=DisplayStateEnum.Hide}function r(e){e&&(o.coordinateError=e),o.checkingCoordinates=e}},o.onDistrictChange=function(){a(o.currentCoordinateObject),o.saveCurrentProject()},o.splitCoordinates=function(t){setTimeout(function(){var e=document.getElementById(t).value.split(",");e.length<2||(o.data.project.latitude=e[0],o.data.project.longitude=e[1])},0)},"new"==o.routeParams.projectId){o.selectOrganisationMode=!0,o.isNewProject=!0,o.parts.project.isNew=!0,t.empty(),r.query().$promise.then(function(e){o.organisations=e[0].organisations.sort(o.projectSortScript),o.totalCount=e[0].properties.totalCount,o.currentCount=e[0].properties.currentCount})}else{var n=t.retrieveProjectData(o.routeParams);n[0].then(function(){o.parts.project.state=SavingStateEnum.Loaded}),n[1].then(function(){o.parts.organisation.state=SavingStateEnum.Loaded})}o.projectSortScript=function(e,t){return e.projectCount<t.projectCount?1:e.projectCount>t.projectCount?-1:0}}]),controllers.controller("EiasPermitsTabsController",["$scope","$location","ProjectFactory",function(i,e,t){i.fileUploadPattern=fileUploadPattern,i.fileUploadNgfPattern=fileUploadNgfPattern,i.fileUploadMaxSize=fileUploadMaxSize,i.EiasPermitsTabEnum=EiasPermitsTabEnum,i.parts={eiapermits:{state:SavingStateEnum.None},eiapermit:{form:null,state:SavingStateEnum.None},documents:{state:SavingStateEnum.None},document:{form:null,state:SavingStateEnum.None},hearings:{state:SavingStateEnum.None},hearing:{form:null,state:SavingStateEnum.None}};var n;i.eptab=(n=e.path(),_.contains(n,"hearings")?EiasPermitsTabEnum.Hearings:_.contains(n,"documents")?EiasPermitsTabEnum.Documents:EiasPermitsTabEnum.EiaPermit),i.preventClickIfDisabled=function(e,t){e&&t.preventDefault()},i.stopPropagation=function(e){e.stopPropagation()},i.openEiapermit=function(e,t){i.routeParams.eiapermitId==e?i.goto("/projects/"+i.data.project.id+"/eiaspermits"):i.routeParams.eiapermitId||i.goto("/projects/"+i.data.project.id+"/eiaspermits/"+e)},i.openEiapermitDocument=function(e,t){i.routeParams.documentId==e?i.goto("/projects/"+i.data.project.id+"/eiaspermits/"+i.data.eiapermit.id+"/documents"):i.routeParams.documentId||i.goto("/projects/"+i.data.project.id+"/eiaspermits/"+i.data.eiapermit.id+"/documents/"+e)},i.openEiapermitDocumentHearing=function(e,t){i.routeParams.hearingId==e?i.goto("/projects/"+i.data.project.id+"/eiaspermits/"+i.data.eiapermit.id+"/documents/"+i.data.document.id+"/hearings"):i.routeParams.hearingId||i.goto("/projects/"+i.data.project.id+"/eiaspermits/"+i.data.eiapermit.id+"/documents/"+i.data.document.id+"/hearings/"+e)},i.isDocumentsDisabled=function(e){return!!i.isDisabled(e)||i.parts.documents.state==SavingStateEnum.Loading},i.isHearingsDisabled=function(e){return!!i.isDisabled(e)||i.parts.hearings.state==SavingStateEnum.Loading},i.isDisabled=function(e){return _.isUndefined(e)},i.downloadFileUrl=function(e){return"/file/v1/download/"+e},i.updateStatus=function(e){var t=updateEiaPermitStatus(e,i.data.documents);return t&&i.parts.eiapermit.form&&i.parts.eiapermit.form.$setDirty(),t},i.loadEiaPermitWithDocuments=function(){i.parts.eiapermit.state=SavingStateEnum.Loading,i.parts.documents.state=SavingStateEnum.Loading;var e=t.retrieveEiaPermit(i.routeParams);e[0].then(function(e){i.parts.eiapermit.state=SavingStateEnum.Loaded}),e[1].then(function(e){i.parts.documents.state=SavingStateEnum.Loaded})},i.parts.eiapermits.state=SavingStateEnum.Loading,t.retrieveProjectData(i.routeParams)[2].then(function(e){i.parts.eiapermits.state=SavingStateEnum.Loaded,_.isUndefined(i.routeParams.eiapermitId)||i.loadEiaPermitWithDocuments()})}]),controllers.controller("EiasPermitsController",["$scope","ProjectFactory","$timeout","Upload","$q","$location",function(r,e,t,i,n,a){r.showUploadingCertificate=!1,r.invalidRecipients=!1,r.shouldShowEiaPermit=function(e){return r.parts.eiapermit.state!=SavingStateEnum.Loading&&r.routeParams.eiapermitId==e.id},r.customValidation=function(e){return e.email_contact&&!window.verifyEmailList(e.email_contact)?!(r.invalidRecipients=!0):!(r.invalidRecipients=!1)},r.saveCurrentEiaPermit=function(e){var t=e.is_new;if(!r.customValidation(e))return!1;t||r.updateStatus(e),r.saveCurrent(r.parts.eiapermit,e,t).then(function(e){t&&r.goto("/projects/"+r.data.project.id+"/eiaspermits/"+e.id)})},r.newEiaPermit=function(){r.parts.eiapermit.state=SavingStateEnum.LoadingNew,e.createNewEiaPermit(r.data.project),r.saveCurrentEiaPermit(r.data.eiapermit)},r.deleteEiaPermit=function(){e.deleteEiaPermit(r.routeParams),r.goto("/projects/"+r.data.project.id+"/eiaspermits")},r.uploadCertificate=function(e){e&&(r.showUploadingCertificate=!0,r.certificateFile=e[0],uploadFile(n,t,i,r.parts.eiapermit.form.certificate,r.certificateFile).then(function(e){r.data.eiapermit.file_metadata_id=e.result.id,r.parts.eiapermit.form.certificate.$setDirty(),r.saveCurrentEiaPermit(r.data.eiapermit)},function(e){}))},r.deleteCertificate=function(){r.showUploadingCertificate=!1,r.data.eiapermit.file_metadata_id=null,r.parts.eiapermit.form.certificate.$setDirty(),r.saveCurrentEiaPermit(r.data.eiapermit)},r.criteriaMatchOfficer1=function(e){return function(e){return!0}},r.criteriaMatchOfficer=function(e){return function(e){return!0}},r.modifyInputDecimals=function(){var e=r.data.eiapermit.fee?r.data.eiapermit.fee:"",t=r.data.eiapermit.expected_jobs_created?r.data.eiapermit.expected_jobs_created:"",i=parseFloat(e.replaceAll(",",".")),n=parseFloat(t.replaceAll(",","."));i&&2<i.countDecimals()&&(r.data.eiapermit.fee=i.truncateDecimal(2)),n&&1<n.countDecimals()&&(r.data.eiapermit.expected_jobs_created=n.truncateDecimal(1))},r.auth.canSave=function(e){if(r.data.eiapermit.is_new&&r.parts.eiapermit.state==SavingStateEnum.SavingStarted)return!1;switch(e){case"new":case"delete":return r.userinfo.info.role_1;case"teamleader_id":case"practitioner_id":case"cost":case"cost_currency":case"recipient_email":case"expected_jobs_created":return r.userinfo.info.role_1;case"personnel":return r.userinfo.info.role_2;case"inspection_recommended":case"date_inspection":case"officer_recommend":case"fee":case"fee_currency":case"remarks":return r.userinfo.info.role_3;case"date_fee_notification":case"date_fee_payed":case"fee_receipt_no":return r.userinfo.info.role_4;case"decision":case"date_decision":case"designation":case"date_certificate":case"certificate_no":case"date_cancelled":case"user_id":case"date_sent_ded_approval":return r.userinfo.info.role_5;case"status":default:return!1}}}]),controllers.controller("EiasPermitsDocumentsController",["$scope","ProjectFactory","$timeout","Upload","$q","$location","EiaPermitSearch",function(r,a,t,i,n,e,o){r.failedToSendMail=!1,r.ep=r.data.eiapermit,r.shouldShowDocument=function(e){return r.parts.document.state!=SavingStateEnum.Loading&&r.routeParams.documentId==e.id},r.moveButton={},r.moveDocument=function(){r.moveButton.error="",o.query({eiapermit_id:r.moveButton.id},function(e){if(1<=e.length){var t=e[0].project_id,i=e[0].eiapermit_id,n=r.data.document.id;a.moveDocument(r.routeParams,r.moveButton.id).then(function(){r.updateStatusBasedOnDocument(),r.goto("/projects/"+t+"/eiaspermits/"+i+"/documents/"+n)})}else r.moveButton.error="Not a valid EIA ID."})},r.updateStatusBasedOnDocument=function(){r.updateStatus(r.data.eiapermit)&&r.data.eiapermit.$update(r.routeParams,function(e){},function(){})},r.saveCurrentDocument=function(e){var t=e.is_new;r.saveCurrent(r.parts.document,e).then(function(e){r.updateStatusBasedOnDocument(),t&&r.goto("/projects/"+r.data.project.id+"/eiaspermits/"+r.data.eiapermit.id+"/documents/"+e.id)})},r.newDocument=function(){r.parts.document.state=SavingStateEnum.LoadingNew,a.createNewDocument(r.data.eiapermit)},r.deleteDocument=function(){a.deleteDocument(r.routeParams).then(function(){r.updateStatusBasedOnDocument(),r.goto("/projects/"+r.data.project.id+"/eiaspermits/"+r.data.eiapermit.id+"/documents")})},r.uploadAttachment=function(e){e&&(r.showUploadingAttachment=!0,r.attachmentFile=e[0],uploadFile(n,t,i,r.parts.document.form.attachment,r.attachmentFile).then(function(e){r.data.document.file_metadata_id=e.result.id,r.parts.document.form.attachment.$setDirty(),r.saveCurrentDocument(r.data.document)},function(e){}))},r.uploadResponseDocument=function(e){e&&(r.showUploadingResponseDocument=!0,r.responseDocumentFile=e[0],uploadFile(n,t,i,r.parts.document.form.response_document,r.responseDocumentFile).then(function(e){r.data.document.file_metadata_response_id=e.result.id,r.parts.document.form.response_document.$setDirty(),r.saveCurrentDocument(r.data.document)},function(e){}))},r.deleteAttachment=function(){r.showUploadingAttachment=!1,r.data.document.file_metadata_id=null,r.parts.document.form.attachment.$setDirty(),r.saveCurrentDocument(r.data.document)},r.deleteResponseDocument=function(){r.showUploadingResponseDocument=!1,r.data.document.file_metadata_response_id=null,r.parts.document.form.response_document.$setDirty(),r.saveCurrentDocument(r.data.document)},r.calculateNumberOfCopiesOfDocument=function(){r.data.document.director_copy_no=1,r.data.document.coordinator_copy_no=r.data.document.sub_copy_no-1},r.calculateDocumentCode=function(){var e=_.find(r.valuelists.documenttype,{id:parseInt(r.data.document.type)}),t=e?e.description1:"",i=r.data.document.number?r.data.document.number:"";r.data.document.code=t+i},r.setDefaultDocumentConclusion=function(){0<=_.indexOf(["8","9"],r.data.document.type)?r.data.document.conclusion=80:r.data.document.conclusion=81},r.getEmailerObj=function(e){var t=e.email_order&&e.email_order.order_status?e.email_order.order_status:0;return window.emailerStatusObj[t]},r.createEmailOrder=function(e,t,i,n){r.data.document.email_order={},r.data.document.email_order.order_status=1,window.createEmailOrder(e,t,i,function(e){r.$apply(function(){0==e.order_status?(r.data.document.email_order=null,r.failedToSendMail=!0):r.data.document.email_order=e,x})})},r.isDisabledBasedOnRule=function(e){switch(e){case"document.conclusion":return 81==r.data.document.conclusion&&9!=r.data.document.type&&8!=r.data.document.type;case"document.type":return 10==r.data.document.type;default:return!1}},r.auth.canSave=function(e){if(r.data.document.is_new&&r.parts.document.state==SavingStateEnum.SavingStarted)return!1;switch(e){case"new":case"delete":return r.userinfo.info.role_1;case"can_email":case"document.date_submitted":case"document.sub_copy_no":case"document.title":case"document.type":case"document.number":case"document.code":case"document.consultent":case"document.director_copy_no":case"document.date_sent_director":case"document.coordinator_copy_no":case"document.date_copies_coordinator":case"document.date_next_appointment":case"document.folio_no":return r.userinfo.info.role_1;case"document.date_sent_officer":case"document.remarks_team_leader":return r.userinfo.info.role_2;case"document.file_metadata_response_id":case"document.conclusion":case"document.date_conclusion":case"document.remarks":return r.userinfo.info.role_3;case"document.remarks_director":case"document.date_sent_from_dep":return r.userinfo.info.role_5;case"move":return r.userinfo.info.role_8;default:return!1}},r.loadDocumentWithHearings=function(){r.parts.document.state=SavingStateEnum.Loading,r.parts.hearings.state=SavingStateEnum.Loading;var e=a.retrieveDocument(r.routeParams);e[0].then(function(e){r.parts.document.state=SavingStateEnum.Loaded}),e[1].then(function(e){r.parts.hearings.state=SavingStateEnum.Loaded})},r.parts.document,SavingStateEnum.Loading,a.retrieveProjectData(r.routeParams)[2].then(function(e){a.retrieveEiaPermit(r.routeParams)[1].then(function(e){r.parts.documents.state=SavingStateEnum.Loaded,_.isUndefined(r.routeParams.documentId)||r.loadDocumentWithHearings()})})}]),controllers.controller("EiasPermitsHearingsController",["$scope","ProjectFactory","$timeout","Upload","$q","$location",function(i,t,n,r,a,e){i.shouldShowHearing=function(e){return i.parts.hearing.state!=SavingStateEnum.Loading&&i.routeParams.hearingId==e.id},i.saveCurrentHearing=function(e){var t=e.is_new;i.saveCurrent(i.parts.hearing,e).then(function(e){t&&i.goto("/projects/"+i.data.project.id+"/eiaspermits/"+i.data.eiapermit.id+"/documents/"+i.data.document.id+"/hearings/"+e.id)})},i.newHearing=function(){i.parts.hearing.state=SavingStateEnum.LoadingNew,t.createNewHearing(i.data.document)},i.deleteHearing=function(){t.deleteHearing(i.routeParams).then(function(){i.goto("/projects/"+i.data.project.id+"/eiaspermits/"+i.data.eiapermit.id+"/documents/"+i.data.document.id)})},i.uploadAttachment=function(e){e&&(i.showUploadingAttachment=!0,i.attachmentFile=e[0],uploadFile(a,n,r,i.parts.hearing.form.attachment,i.attachmentFile).then(function(e){i.data.hearing.file_metadata_id=e.result.id,i.parts.hearing.form.attachment.$setDirty(),i.saveCurrentHearing(i.data.hearing)},function(e){}))},i.deleteAttachment=function(){i.showUploadingAttachment=!1,i.data.hearing.file_metadata_id=null,i.parts.hearing.form.attachment.$setDirty(),i.saveCurrentHearing(i.data.hearing)},i.isDisabledBasedOnRule=function(e){switch(e){case"hearing.district_id":return 7!=i.data.hearing.lead_agency&&8!=i.data.hearing.lead_agency&&!(i.data.hearing.district_id=null);default:return!1}},i.auth.canSave=function(e){if(i.data.hearing.is_new&&i.parts.hearing.state==SavingStateEnum.SavingStarted)return!1;switch(e){case"new":case"delete":case"hearing.date_dispatched":case"hearing.lead_agency":case"hearing.district_id":case"hearing.date_expected":case"hearing.date_received":case"hearing.recommendations":case"hearing.document_id":return i.userinfo.info.role_1;case"hearing.remarks":return i.userinfo.info.role_3;default:return!1}},i.loadHearing=function(){i.parts.hearing.state=SavingStateEnum.Loading,t.retrieveHearing(i.routeParams)[0].then(function(e){i.parts.hearing.state=SavingStateEnum.Loaded})},i.loadDocumentWithHearings=function(){i.parts.document.state=SavingStateEnum.Loading,i.parts.hearings.state=SavingStateEnum.Loading;var e=t.retrieveDocument(i.routeParams);e[0].then(function(e){i.parts.document.state=SavingStateEnum.Loaded}),e[1].then(function(e){i.parts.hearings.state=SavingStateEnum.Loaded,_.isUndefined(i.routeParams.hearingId)||i.loadHearing()})},t.retrieveProjectData(i.routeParams)[2].then(function(e){t.retrieveEiaPermit(i.routeParams)[1].then(function(e){i.parts.documents.state=SavingStateEnum.Loaded,_.isUndefined(i.routeParams.documentId)||i.loadDocumentWithHearings()})})}]),controllers.controller("ExternalAuditsTabsController",["$scope","$location","ProjectFactory",function(i,e,t){i.fileUploadPattern=fileUploadPattern,i.fileUploadNgfPattern=fileUploadNgfPattern,i.fileUploadMaxSize=fileUploadMaxSize,i.ExternalAuditsTabEnum=ExternalAuditsTabEnum,i.parts={externalaudits:{state:SavingStateEnum.None},externalaudit:{form:null,state:SavingStateEnum.None},documents:{state:SavingStateEnum.None},document:{form:null,state:SavingStateEnum.None},hearings:{state:SavingStateEnum.None},hearing:{form:null,state:SavingStateEnum.None}};var n;i.eatab=(n=e.path(),_.contains(n,"hearings")?EiasPermitsTabEnum.Hearings:_.contains(n,"documents")?ExternalAuditsTabEnum.Documents:ExternalAuditsTabEnum.ExternalAudit),i.openExternalaudit=function(e,t){i.routeParams.externalauditId==e?i.goto("/projects/"+i.data.project.id+"/externalaudits"):i.routeParams.externalauditId||i.goto("/projects/"+i.data.project.id+"/externalaudits/"+e)},i.openExternalauditDocument=function(e,t){i.routeParams.documentId==e?i.goto("/projects/"+i.data.project.id+"/externalaudits/"+i.data.externalaudit.id+"/documents"):i.routeParams.documentId||i.goto("/projects/"+i.data.project.id+"/externalaudits/"+i.data.externalaudit.id+"/documents/"+e)},i.preventClickIfDisabled=function(e,t){e&&t.preventDefault()},i.stopPropagation=function(e){e.stopPropagation()},i.isDocumentsDisabled=function(e){return!!i.isDisabled(e)||i.parts.documents.state==SavingStateEnum.Loading},i.isHearingsDisabled=function(e){return!!i.isDisabled(e)||i.parts.hearings.state==SavingStateEnum.Loading},i.isDisabled=function(e){return _.isUndefined(e)},i.downloadFileUrl=function(e){return"/file/v1/download/"+e},i.updateStatus=function(e){var t=updateExternalAuditStatus(e,i.data.documents_ea);return t&&i.parts.externalaudit.form&&i.parts.externalaudit.form.$setDirty(),t},i.loadExternalAuditWithDocuments=function(){i.parts.externalaudit.state=SavingStateEnum.Loading,i.parts.documents.state=SavingStateEnum.Loading;var e=t.retrieveExternalAudit(i.routeParams);e[0].then(function(e){i.parts.externalaudit.state=SavingStateEnum.Loaded}),e[1].then(function(e){i.parts.documents.state=SavingStateEnum.Loaded})},i.parts.externalaudits.state=SavingStateEnum.Loading,t.retrieveProjectData(i.routeParams)[5].then(function(e){i.parts.externalaudits.state=SavingStateEnum.Loaded,_.isUndefined(i.routeParams.externalauditId)||i.loadExternalAuditWithDocuments()})}]),controllers.controller("ExternalAuditsController",["$scope","ProjectFactory","$timeout","Upload","$q","$location",function(i,e,t,n,r,a){i.showUploadingResponseDocument=!1,i.invalidRecipients=!1,i.shouldShowExternalAudit=function(e){return console.log("was called"),i.parts.externalaudit.state!=SavingStateEnum.Loading&&i.routeParams.externalauditId==e.id},i.saveCurrentExternalAudit=function(e){var t=e.is_new;t||i.updateStatus(e),i.saveCurrent(i.parts.externalaudit,e,t).then(function(e){t&&i.goto("/projects/"+i.data.project.id+"/externalaudits/"+e.id)})},i.newExternalAudit=function(){i.parts.externalaudit.state=SavingStateEnum.LoadingNew,e.createNewExternalAudit(i.data.project)},i.deleteExternalAudit=function(){e.deleteExternalAudit(i.routeParams),i.goto("/projects/"+i.data.project.id+"/externalaudits")},i.uploadResponseDocument=function(e){e&&(i.showUploadingResponseDocument=!0,i.responseDocumentFile=e[0],uploadFile(r,t,n,i.parts.externalaudit.form.response_document,i.responseDocumentFile).then(function(e){i.data.externalaudit.file_metadata_response_id=e.result.id,i.parts.externalaudit.form.response_document.$setDirty(),i.saveCurrentExternalAudit(i.data.externalaudit)},function(e){}))},i.deleteResponseDocument=function(){i.showUploadingResponseDocument=!1,i.data.externalaudit.file_metadata_response_id=null,i.parts.externalaudit.form.response_document.$setDirty(),i.saveCurrentExternalAudit(i.data.externalaudit)},i.criteriaMatchOfficer1=function(e){return function(e){return!0}},i.criteriaMatchOfficer=function(e){return function(e){return!0}},i.auth.canSave=function(e){if(i.data.externalaudit.is_new&&i.parts.externalaudit.state==SavingStateEnum.SavingStarted)return!1;switch(e){case"date_invoice_payment":case"date_invoice_receipt_issued":case"date_create_invoice":return!0;case"new":return i.userinfo.info.role_1;case"teamleader_id":case"practitioner_id":case"type":case"recipient_email":return i.userinfo.info.role_1;case"personnel":case"remarks_team_leader":return i.userinfo.info.role_2;case"verification_inspection":case"date_inspection":case"date_response":case"fee":case"fee_currency":case"remarks":case"review_findings":case"response":case"date_deadline_compliance":case"delete":case"upload_documentation_response_letter":case"delete_documentation_response_letter":return i.userinfo.info.role_3;case"user_id":return i.userinfo.info.role_5;case"status":default:return!1}},i.filterByDateSubmission=function(e){if(console.log("filter called"),e.length||e[0].documents)return e.sort(function(e,t){return console.log("sort is running"),(e.documents&&e.documents[0]?e.documents[0].date_submitted:"")<(t.documents&&t.documents[0]?t.documents[0].date_submitted:"")?-1:1}),e.reverse()},i.customValidation=function(e){return e.email_contact&&!window.verifyEmailList(e.email_contact)?!(i.invalidRecipients=!0):!(i.invalidRecipients=!1)},i.saveCurrentEmailContact=function(e){if(!i.customValidation(e))return!1;i.saveCurrentExternalAudit(e)}}]),controllers.controller("ExternalAuditsDocumentsController",["$scope","ProjectFactory","$timeout","Upload","$q","$location","ExternalAuditSearch",function(r,a,t,i,n,e,o){r.ep=r.data.eiaspermits[0],r.ea=r.data.externalaudit,r.shouldShowDocument=function(e){return r.parts.document.state!=SavingStateEnum.Loading&&r.routeParams.documentId==e.id},r.moveButton={},r.moveDocument=function(){r.moveButton.error="",o.query({externalaudit_id:r.moveButton.id},function(e){if(1<=e.length){var t=e[0].project_id,i=e[0].externalaudit_id,n=r.data.document_ea.id;console.log(t,i,n),a.moveDocumentEA(r.routeParams,r.moveButton.id).then(function(){r.updateStatusBasedOnDocument(),r.goto("/projects/"+t+"/externalaudits/"+i+"/documents/"+n)})}else r.moveButton.error="Not a valid EA ID."})},r.updateStatusBasedOnDocument=function(){r.updateStatus(r.data.externalaudit)&&r.data.externalaudit.$update(r.routeParams,function(e){},function(){})},r.saveCurrentDocument=function(e){var t=e.is_new;r.saveCurrent(r.parts.document,e).then(function(e){r.updateStatusBasedOnDocument(),t&&r.goto("/projects/"+r.data.project.id+"/externalaudits/"+r.data.externalaudit.id+"/documents/"+e.id)})},r.newDocument=function(){r.parts.document.state=SavingStateEnum.LoadingNew,a.createNewDocumentEA(r.data.externalaudit)},r.deleteDocument=function(){a.deleteDocumentEA(r.routeParams).then(function(){r.updateStatusBasedOnDocument(),r.goto("/projects/"+r.data.project.id+"/externalaudits/"+r.data.externalaudit.id+"/documents")})},r.uploadAttachment=function(e){e&&(r.showUploadingAttachment=!0,r.attachmentFile=e[0],uploadFile(n,t,i,r.parts.document.form.attachment,r.attachmentFile).then(function(e){r.data.document_ea.file_metadata_id=e.result.id,r.parts.document.form.attachment.$setDirty(),r.saveCurrentDocument(r.data.document_ea)},function(e){}))},r.uploadResponseDocument=function(e){e&&(r.showUploadingResponseDocument=!0,r.responseDocumentFile=e[0],uploadFile(n,t,i,r.parts.document.form.response_document,r.responseDocumentFile).then(function(e){r.data.document_ea.file_metadata_response_id=e.result.id,r.parts.document.form.response_document.$setDirty(),r.saveCurrentDocument(r.data.document_ea)},function(e){}))},r.deleteAttachment=function(){r.showUploadingAttachment=!1,r.data.document_ea.file_metadata_id=null,r.parts.document.form.attachment.$setDirty(),r.saveCurrentDocument(r.data.document_ea)},r.deleteResponseDocument=function(){r.showUploadingResponseDocument=!1,r.data.document_ea.file_metadata_response_id=null,r.parts.document.form.response_document.$setDirty(),r.saveCurrentDocument(r.data.document_ea)},r.calculateNumberOfCopiesOfDocument=function(){r.data.document_ea.director_copy_no=1,r.data.document_ea.coordinator_copy_no=r.data.document_ea.sub_copy_no-1},r.calculateDocumentCode=function(){var e=_.find(r.valuelists.documenttypeexternalaudits,{id:parseInt(r.data.document_ea.type)}),t=e?e.description1:"",i=r.data.document_ea.number?r.data.document_ea.number:"";r.data.document_ea.code=t+i},r.setDefaultDocumentConclusion=function(){0<=_.indexOf(["11"],r.data.document_ea.type)?r.data.document_ea.conclusion=80:r.data.document_ea.conclusion=81},r.isDisabledBasedOnRule=function(e){switch(e){case"document.conclusion":return 81==r.data.document_ea.conclusion&&11!=r.data.document_ea.type;case"document.type":return 12==r.data.document_ea.type;default:return!1}},r.auth.canSave=function(e){if(r.data.document_ea.is_new&&r.parts.document.state==SavingStateEnum.SavingStarted)return!1;switch(e){case"new":case"delete":return r.userinfo.info.role_1;case"can_email":case"document.date_submitted":case"document.sub_copy_no":case"document.title":case"document.type":case"document.number":case"document.code":case"document.consultent":case"document.director_copy_no":case"document.date_sent_director":case"document.coordinator_copy_no":case"document.date_copies_coordinator":case"document.date_next_appointment":case"document.folio_no":case"document.remarks":return r.userinfo.info.role_1;case"document.date_sent_officer":return r.userinfo.info.role_2;case"document.file_metadata_response_id":case"document.conclusion":case"document.date_conclusion":return r.userinfo.info.role_3;case"document.date_sent_from_dep":return r.userinfo.info.role_5;case"move":return r.userinfo.info.role_8;default:return!1}},r.loadDocument=function(){r.parts.document.state=SavingStateEnum.Loading,a.retrieveDocumentEA(r.routeParams)[0].then(function(e){r.parts.document.state=SavingStateEnum.Loaded})},r.parts.document,SavingStateEnum.Loading,a.retrieveProjectData(r.routeParams)[5].then(function(e){a.retrieveExternalAudit(r.routeParams)[1].then(function(e){r.parts.documents.state=SavingStateEnum.Loaded,_.isUndefined(r.routeParams.documentId)||r.loadDocument()})}),r.getEmailerObj=function(e){var t=e.email_order&&e.email_order.order_status?e.email_order.order_status:0;return window.emailerStatusObj[t]},r.failedToSendMail=!1,r.createEmailOrder=function(e,t,i,n){r.data.document_ea.email_order={},r.data.document_ea.email_order.order_status=1,window.createEmailOrder(e,t,i,function(e){r.$apply(function(){0==e.order_status?(r.data.document_ea.email_order=null,r.failedToSendMail=!0):r.data.document_ea.email_order=e})})}}]),(controllers=angular.module("seroApp.controllers")).controller("AuditsInspectionsController",["$scope","ProjectFactory","$timeout","Upload","$q",function(i,e,t,n,r){i.parts={auditsinspections:{state:SavingStateEnum.None},auditinspection:{form:null,state:SavingStateEnum.None}},i.newButton={},i.newButton.year=(new Date).getFullYear(),i.fileUploadPattern=fileUploadPattern,i.fileUploadNgfPattern=fileUploadNgfPattern,i.fileUploadMaxSize=fileUploadMaxSize,i.shouldShowAuditInspection=function(e){return i.parts.auditinspection.state!=SavingStateEnum.Loading&&i.routeParams.auditinspectionId==e.id},i.criteriaMatchOfficer1=function(e){return function(e){return!0}},i.criteriaMatchOfficer=function(e){return function(e){return!0}},i.isLoading=function(){return i.parts.auditinspection.state==SavingStateEnum.Loading?!!i.hasAuditInspection():i.parts.auditinspection.state==SavingStateEnum.LoadingNew},i.hasAuditInspection=function(){return!_.isEmpty(i.data.auditinspection)},i.updateStatus=function(e){updateAuditInspectionStatus(e)},i.openAuditInspection=function(e,t){i.routeParams.auditinspectionId==e?i.goto("/projects/"+i.data.project.id+"/auditsinspections"):i.routeParams.auditinspectionId||i.goto("/projects/"+i.data.project.id+"/auditsinspections/"+e)},i.stopPropagation=function(e){e.stopPropagation()},i.saveCurrentAuditInspection=function(){i.data.auditinspection.year=new Date(i.data.auditinspection.date_carried_out).getFullYear();var e=i.data.auditinspection;console.log(e,"about to save");var t=e.is_new;t||i.updateStatus(e),i.saveCurrent(i.parts.auditinspection,e,t).then(function(e){t&&i.goto("/projects/"+i.data.project.id+"/auditsinspections/"+e.id)})},i.newAuditInspection=function(){i.parts.auditinspection.state=SavingStateEnum.LoadingNew,i.newButton.isopen=!1,i.newButton.year=new Date(i.newButton.date_carried_out).getFullYear(),e.createNewAuditInspection(i.data.project,i.newButton.year,i.newButton.type,i.newButton.reason,i.newButton.date_carried_out),i.parts.auditinspection.isNew=!0,i.saveCurrentAuditInspection()},i.deleteAuditInspection=function(){e.deleteAuditInspection(i.routeParams),i.goto("/projects/"+i.data.project.id+"/auditsinspections/")},i.auth.canSave=function(e){return"new"==e?i.userinfo.info.role_7:!!i.userinfo.info.role_8||"lead_officer"!=e&&i.userinfo.info.id===i.data.auditinspection.lead_officer},i.uploadActionTakenLetter=function(e){e&&(i.showUploadingFileActionTakenLetter=!0,i.actionTakenLetterFile=e[0],uploadFile(r,t,n,i.parts.auditinspection.form.action_taken_letter,i.actionTakenLetterFile).then(function(e){i.data.auditinspection.file_metadata_id=e.result.id,i.parts.auditinspection.form.action_taken_letter.$setDirty(),i.saveCurrentAuditInspection(),t(function(){i.showUploadingFileActionTakenLetter=!1},3e3)},function(e){}))},i.uploadReport=function(e){e&&(i.showUploadingFileReport=!0,i.reportFile=e[0],uploadFile(r,t,n,i.parts.auditinspection.form.report,i.reportFile).then(function(e){i.data.auditinspection.file_metadata_report_id=e.result.id,i.parts.auditinspection.form.report.$setDirty(),i.saveCurrentAuditInspection(),t(function(){i.showUploadingFileReport=!1},3e3)},function(e){}))},i.uploadDocumentation=function(e){e&&(i.showUploadingFileDocumentation=!0,i.documentationFile=e[0],uploadFile(r,t,n,i.parts.auditinspection.form.documentation,i.documentationFile).then(function(e){i.data.auditinspection.documentation_ids.push(e.result.id),i.parts.auditinspection.form.documentation.$setDirty(),i.saveCurrentAuditInspection(),t(function(){i.showUploadingFileDocumentation=!1},3e3)},function(e){}))},i.downloadFileUrl=function(e){return"/file/v1/download/"+e},i.deleteActionTakenLetter=function(){i.data.auditinspection.file_metadata_id=null,i.parts.auditinspection.form.action_taken_letter.$setDirty(),i.saveCurrentAuditInspection()},i.deleteReport=function(){i.data.auditinspection.file_metadata_report_id=null,i.parts.auditinspection.form.report.$setDirty(),i.saveCurrentAuditInspection()},i.deleteDocumentation=function(t){_.remove(i.data.auditinspection.documentation_ids,function(e){return e===t}),i.parts.auditinspection.form.documentation.$setDirty(),i.saveCurrentAuditInspection()},i.loadAuditInspection=function(){i.parts.auditinspection.state=SavingStateEnum.Loading,e.retrieveAuditInspection(i.routeParams)[0].then(function(e){i.parts.auditinspection.state=SavingStateEnum.Loaded})},i.parts.auditinspection.state=SavingStateEnum.Loading,e.retrieveProjectData(i.routeParams)[3].then(function(e){i.parts.auditsinspections.state=SavingStateEnum.Loaded,_.isUndefined(i.routeParams.auditinspectionId)||i.loadAuditInspection()})}]),controllers.controller("PermitsLicensesController",["$scope","ProjectFactory","$timeout","Upload","$q","$location",function(r,t,n,a,o,e){r.invalidRecipients=!1,r.parts={permitslicenses:{state:SavingStateEnum.None},permitlicense:{form:null,state:SavingStateEnum.None}},r.newButton={},r.newButton.approved_by_the_lc1=!1,r.newButton.approved_by_the_dec=!1,r.fileUploadPattern=fileUploadPattern,r.fileUploadNgfPattern=fileUploadNgfPattern,r.fileUploadMaxSize=fileUploadMaxSize,r.DocumentTagEnum=DocumentTagEnum,r.documentationData={ApplicationForm:{formField:"documentation_applicationform",tag:DocumentTagEnum.PermitLicenseApplicationForm},PermitLicense:{formField:"documentation_permitlicense",tag:DocumentTagEnum.PermitLicensePermitLicense},Attachments:{formField:"documentation_attachments",tag:DocumentTagEnum.PermitLicenseAttachments}},r.idPermit=118,r.idLicense=119,r.idWetland=123,r.isEcosystemWetland=function(e){return e.ecosystem==r.idWetland},r.shouldShowPermitLicense=function(e){return r.parts.permitlicense.state!=SavingStateEnum.Loading&&r.routeParams.permitlicenseId==e.id},r.notOkToEditOrCreateNew=function(){return!!r.routeParams.permitlicenseId||!!r.data.permitlicense.is_new},r.preventClickIfDisabled=function(e,t){e&&t.preventDefault()},r.openPermitLicense=function(e,t){console.log(r.routeParams.permitlicenseId,e),r.data.permitlicense.is_new||(r.routeParams.permitlicenseId==e?r.goto("/projects/"+r.data.project.id+"/permitslicenses"):r.routeParams.permitlicenseId&&r.routeParamspermitlicenseId!=e?r.goto("/projects/"+r.data.project.id+"/permitslicenses/"+e):r.routeParams.permitlicenseId||(console.log("it says its not set"),r.goto("/projects/"+r.data.project.id+"/permitslicenses/"+e)))},r.customValidation=function(e){return e.email_contact&&!window.verifyEmailList(e.email_contact)?!(r.invalidRecipients=!0):!(r.invalidRecipients=!1)},r.saveCurrentPermitLicense=function(e){var t=e.is_new;if(!r.customValidation(e))return!1;r.isEcosystemWetland(e)||(e.regulation_activity=null),r.updateStatus(e),r.saveCurrent(r.parts.permitlicense,e,t).then(function(e){t&&r.goto("/projects/"+r.data.project.id+"/permitslicenses/"+e.id)})},r.updateStatus=function(e){updatePermitLicenseStatus(e)},r.newPermitLicense=function(){r.parts.permitlicense.state=SavingStateEnum.LoadingNew,r.newButton.isopen=!1;var e=null;r.isEcosystemWetland(r.newButton)&&(e=r.newButton.regulation_activity),t.createNewPermitLicense(r.data.project,r.newButton.regulation,r.newButton.ecosystem,e,r.newButton.area,r.newButton.unit,r.newButton.approved_by_the_lc1,r.newButton.approved_by_the_dec,r.newButton.waste_license_type)},r.deletePermitLicense=function(){t.deletePermitLicense(r.routeParams),r.goto("/projects/"+r.data.project.id+"/permitslicenses")},r.calculateDateFeedbackToApplicants=function(){r.data.permitlicense.date_feedback_to_applicants=addDays(r.data.permitlicense.date_submitted,21)},r.uploadDocumentation=function(t,i,e){e&&(i.showUploading=!0,i.file=e[0],uploadFile(o,n,a,r.parts.permitlicense.form[i.formField],i.file,i.tag).then(function(e){t.documentation_ids.push(e.result.id),r.parts.permitlicense.form[i.formField].$setDirty(),r.saveCurrentPermitLicense(t),n(function(){i.showUploading=!1},3e3)},function(e){}))},r.deleteDocumentation=function(e,t,i){_.remove(e.documentation_ids,function(e){return e===t}),r.parts.permitlicense.form[i.formField].$setDirty(),r.saveCurrentPermitLicense(e)},r.hasDocumentationTag=function(e,t){var i=!1;return _.forEach(e,function(e){e.tag==t&&(i=!0)}),i},r.downloadFileUrl=function(e){return"/file/v1/download/"+e},r.auth.canSave=function(e){if(r.data.permitlicense.is_new&&r.parts.permitlicense.state==SavingStateEnum.SavingStarted)return!1;switch(e){case"new":case"delete":case"regulation":case"date_submitted":case"waste_license_type":case"ecosystem":case"regulation_activity":case"area":case"unit":case"approved_by_the_lc1":case"approved_by_the_dec":case"application_number":case"application_fee_receipt_number":case"date_feedback_to_applicants":case"date_sent_to_director":case"date_sent_from_dep":case"folio_no":case"can_email":case"recipient_email":return r.userinfo.info.role_1;case"date_sent_officer":return r.userinfo.info.role_1||r.userinfo.info.role_2;case"personnel":case"remarks_team_leader":return r.userinfo.info.role_2;case"application_evaluation_by_officer":case"date_of_evaluation":case"inspection_recommended":case"date_inspection":case"officer_recommend":case"date_sent_for_decision":return r.userinfo.info.role_3;case"fee_receipt_no":case"date_fee_payed":return r.userinfo.info.role_4;case"user_id":case"decision":case"date_decision":case"signature_on_permit_license":case"date_permit_license":case"permit_license_no":case"date_permit_license_expired":case"upload_documentation_permit_license":case"delete_documentation_permit_license":return r.userinfo.info.role_5;case"status":default:return!1}},r.getEmailerObj=function(e){var t=e.email_order&&e.email_order.order_status?e.email_order.order_status:0;return window.emailerStatusObj[t]},r.failedToSendMail=!1,r.pl=r.data.permitlicense,r.createEmailOrder=function(e,t,i,n){n.email_order={},n.email_order.order_status=1,window.createEmailOrder(e,t,i,function(e){r.$apply(function(){0==e.order_status?(n.email_order=null,r.failedToSendMail=!0):n.email_order=e})})},r.loadPermitLicense=function(){r.parts.permitlicense.state=SavingStateEnum.Loading,t.retrievePermitLicense(r.routeParams)[0].then(function(e){r.parts.permitlicense.state=SavingStateEnum.Loaded})},r.parts.permitlicense.state=SavingStateEnum.Loading,t.retrieveProjectData(r.routeParams)[4].then(function(e){r.parts.permitslicenses.state=SavingStateEnum.Loaded,_.isUndefined(r.routeParams.permitlicenseId)||r.loadPermitLicense()})}]),controllers.controller("SearchTabsController",["$scope","$routeParams","$location","$q","$timeout","ProjectFactory","Valuelists","UserInfo",function(e,t,i,n,r,a,o,s){e.SearchTabEnum=SearchTabEnum,e.routeParams=t,e.userinfo=s,e.valuelists=o;var c;e.tab=(c=i.path(),_.contains(c,"projects")?SearchTabEnum.Projects:_.contains(c,"eiaspermits")?SearchTabEnum.EiasPermits:_.contains(c,"permitslicenses")?SearchTabEnum.PermitsLicenses:_.contains(c,"auditsinspections")?SearchTabEnum.AuditsInspections:_.contains(c,"externalaudits")?SearchTabEnum.ExternalAudits:null),e.goto=function(e){r(function(){i.path(e)})}}]),controllers.controller("SearchAuditsInspectionsController",["$scope","$routeParams","$location","$q","$timeout","AuditInspectionSearch","UserInfo","Valuelists","SearchService",function(t,e,i,n,r,a,o,s,c){t.isSearching=!1,t.showResultGrid=!1,t.gridOptions={},t.gridOptions.enableHorizontalScrollbar=0,t.gridOptions.showGridFooter=!0,t.gridOptions.minRowsToShow=10,t.gridOptions.enableColumnMenus=!1,t.gridOptions.enableRowSelection=!0,t.gridOptions.enableRowHeaderSelection=!1,t.gridOptions.multiSelect=!1,t.gridOptions.noUnselect=!0,t.gridOptions.enableFooterTotalSelected=!1,t.gridOptions.appScopeProvider={onDblClick:function(e){t.goto("/projects/"+e.project_id+"/auditsinspections/"+e.auditinspection_id)}},t.gridOptions.rowTemplate='<div ng-dblclick="grid.appScope.onDblClick(row.entity)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',t.gridOptions.columnDefs=[{name:"auditinspection_code",displayName:"Number",width:80,cellTooltip:!0,headerTooltip:!0},{name:"project_title",displayName:"Project name",cellTooltip:!0,headerTooltip:!0},{name:"developer_name",displayName:"Developer name",cellTooltip:!0,headerTooltip:!0},{name:"developer_tin",displayName:"TIN",type:"number",width:90,cellTooltip:!0,headerTooltip:!0},{name:"district_district",displayName:"District",cellTooltip:!0,headerTooltip:!0},{name:"auditinspection_type",displayName:"Activity",cellTooltip:!0,headerTooltip:!0},{name:"category_description",displayName:"Category of project",width:150,cellTooltip:!0,headerTooltip:!0},{name:"auditinspection_action_taken",displayName:"Response",cellTooltip:!0,headerTooltip:!0},{name:"auditinspection_performance_level",displayName:"Performance",width:110,cellTooltip:!0,headerTooltip:!0},{name:"auditinspection_date_deadline",displayName:"Deadline for complete compliance",width:90,type:"date",cellFilter:'date:"d MMM yyyy"',headerTooltip:!0}],t.gridOptions.onRegisterApi=function(e){t.gridApi=e},t.setSearchUrl=function(){_.isEmpty(t.criteria)||(_.isEqual(c.criteria,t.criteria)?(c.allowCache=!1,t.search()):i.search(t.criteria))},t.search=function(){t.isSearching=!0,t.showResultGrid=!1,c.search(t.criteria).then(function(e){t.gridOptions.data=e,t.isSearching=!1,t.showResultGrid=!0})},t.reset=function(){t.criteria={},c.criteria={},t.gridOptions.data=[],t.showResultGrid=!1},t.exportAuditAndInspectionResults=function(e){exportObj.exportData(e,"auditAndInspection")},t.criteria=i.search(),_.isEmpty(t.criteria)&&!_.isEmpty(c.criteria)?i.search(c.criteria):_.isEmpty(t.criteria)||t.search()}]),controllers.controller("SearchProjectsController",["$scope","$routeParams","$location","$q","$timeout","ProjectSearch","UserInfo","Valuelists","ProjectSearchService",function(t,e,i,n,r,a,o,s,c){t.isSearching=!1,t.showResultGrid=!1,t.gridOptions={},t.gridOptions.enableHorizontalScrollbar=0,t.gridOptions.showGridFooter=!0,t.gridOptions.minRowsToShow=10,t.gridOptions.enableColumnMenus=!1,t.gridOptions.enableRowSelection=!0,t.gridOptions.enableRowHeaderSelection=!1,t.gridOptions.multiSelect=!1,t.gridOptions.noUnselect=!0,t.gridOptions.enableFooterTotalSelected=!1,t.gridOptions.appScopeProvider={onDblClick:function(e){t.goto("/projects/"+e.project_id)}},t.gridOptions.rowTemplate='<div ng-dblclick="grid.appScope.onDblClick(row.entity)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',t.gridOptions.columnDefs=[{name:"project_id",displayName:"Id",type:"number",width:50,cellTooltip:!0,headerTooltip:!0},{name:"project_title",displayName:"Name",cellTooltip:!0,headerTooltip:!0},{name:"project_location",displayName:"Location",cellTooltip:!0,headerTooltip:!0},{name:"district_district",displayName:"District",cellTooltip:!0,headerTooltip:!0},{name:"category_description",displayName:"Category",cellTooltip:!0,headerTooltip:!0},{name:"developer_name",displayName:"Developer name",cellTooltip:!0,headerTooltip:!0},{name:"developer_tin",displayName:"TIN",type:"number",width:90,cellTooltip:!0,headerTooltip:!0}],t.gridOptions.onRegisterApi=function(e){t.gridApi=e},t.setSearchUrl=function(){_.isEmpty(t.criteria)||(_.isEqual(c.criteria,t.criteria)?(c.allowCache=!1,t.search()):i.search(t.criteria))},t.search=function(){t.isSearching=!0,t.showResultGrid=!1,c.search(t.criteria).then(function(e){t.gridOptions.data=e,localStorage.projectData=JSON.stringify(e),t.isSearching=!1,t.showResultGrid=!0})},t.reset=function(){t.criteria={},c.criteria={},t.gridOptions.data=[],t.showResultGrid=!1},t.criteria=i.search(),_.isEmpty(t.criteria)&&!_.isEmpty(c.criteria)?i.search(c.criteria):_.isEmpty(t.criteria)||t.search(),t.exportProjects=function(e){exportObj.exportData(e,"project")}}]),controllers.controller("SearchEiasPermitsController",["$scope","$routeParams","$location","$q","$timeout","EiaPermitSearch","UserInfo","Valuelists","EiaPermitSearchService",function(i,e,t,n,r,a,o,s,c){i.isSearching=!1,i.showResultGrid=!1,i.gridOptions={},i.gridOptions.enableHorizontalScrollbar=0,i.gridOptions.showGridFooter=!0,i.gridOptions.minRowsToShow=10,i.gridOptions.enableColumnMenus=!1,i.gridOptions.enableRowSelection=!0,i.gridOptions.enableRowHeaderSelection=!1,i.gridOptions.multiSelect=!1,i.gridOptions.noUnselect=!0,i.gridOptions.enableFooterTotalSelected=!1,i.gridOptions.appScopeProvider={onDblClick:function(e){i.goto("/projects/"+e.project_id+"/eiaspermits/"+e.eiapermit_id)}},i.gridOptions.rowTemplate='<div ng-dblclick="grid.appScope.onDblClick(row.entity)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',i.gridOptions.columnDefs=[{name:"eiapermit_id",displayName:"EIA Id",type:"number",width:80,cellTooltip:!0,headerTooltip:!0},{name:"eiapermit_status",displayName:"Status",cellTooltip:!0,headerTooltip:!0},{name:"eiapermit_decision",displayName:"Decision taken",cellTooltip:!0,headerTooltip:!0},{name:"eiapermit_officer_assigned",displayName:"Team leader",cellTooltip:!0,headerTooltip:!0},{name:"project_title",displayName:"Project name",cellTooltip:!0,headerTooltip:!0},{name:"eiapermit_certificate_no",displayName:"Certificate No.",cellTooltip:!0,headerTooltip:!0}],i.gridOptions.onRegisterApi=function(e){i.gridApi=e},i.setSearchUrl=function(){(_.forOwn(i.dateCriteria,function(e,t){e instanceof Date&&(e.setHours(12),i.criteria[t]=e.toJSON().substr(0,10))}),_.isEmpty(i.criteria))||(_.isEqual(c.criteria,i.criteria)?(c.allowCache=!1,i.search()):t.search(i.criteria))},i.search=function(){i.isSearching=!0,i.showResultGrid=!1,c.search(i.criteria).then(function(e){i.gridOptions.data=e,i.isSearching=!1,i.showResultGrid=!0})},i.reset=function(){i.criteria={},i.dateCriteria={},c.criteria={},i.gridOptions.data=[],i.showResultGrid=!1},i.exportEiasPermits=function(e){exportObj.exportData(e,"eiaspermits")},i.criteria=t.search(),i.dateCriteria={},i.criteria.eiapermit_date_submission_from&&(i.dateCriteria.eiapermit_date_submission_from=new Date(i.criteria.eiapermit_date_submission_from)),i.criteria.eiapermit_date_submission_to&&(i.dateCriteria.eiapermit_date_submission_to=new Date(i.criteria.eiapermit_date_submission_to)),_.isEmpty(i.criteria)&&!_.isEmpty(c.criteria)?t.search(c.criteria):_.isEmpty(i.criteria)||i.search()}]),controllers.controller("SearchPermitsLicensesController",["$scope","$routeParams","$location","$q","$timeout","PermitLicenseSearch","UserInfo","Valuelists","PermitLicenseSearchService",function(i,e,t,n,r,a,o,s,c){i.isSearching=!1,i.showResultGrid=!1,i.gridOptions={},i.gridOptions.enableHorizontalScrollbar=0,i.gridOptions.showGridFooter=!0,i.gridOptions.minRowsToShow=10,i.gridOptions.enableColumnMenus=!1,i.gridOptions.enableRowSelection=!0,i.gridOptions.enableRowHeaderSelection=!1,i.gridOptions.multiSelect=!1,i.gridOptions.noUnselect=!0,i.gridOptions.enableFooterTotalSelected=!1,i.gridOptions.appScopeProvider={onDblClick:function(e){i.goto("/projects/"+e.project_id+"/permitslicenses/"+e.permitlicense_id)}},i.gridOptions.rowTemplate='<div ng-dblclick="grid.appScope.onDblClick(row.entity)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',i.gridOptions.columnDefs=[{name:"permitlicense_id",displayName:"PL Id",type:"number",width:80,cellTooltip:!0,headerTooltip:!0},{name:"permitlicense_date_submitted",displayName:"Date of submission",width:130,type:"date",cellFilter:'date:"d MMM yyyy"',headerTooltip:!0},{name:"permitlicense_regulation",displayName:"Regulation",width:80,cellTooltip:!0,headerTooltip:!0},{name:"permitlicense_officer_assigned",displayName:"Team leader",cellTooltip:!0,headerTooltip:!0},{name:"project_title",displayName:"Project name",cellTooltip:!0,headerTooltip:!0}],i.idPermit=118,i.idLicense=119,i.idWetland=123,i.idRB=124,i.idLS=125,i.isDisabled=function(e){switch(e){case"permitlicense_ecosystem":return i.criteria.permitlicense_regulation==i.idLicense;case"permitlicense_waste_license_type":return i.criteria.permitlicense_regulation==i.idPermit;case"permitlicense_regulation_activity":return i.criteria.permitlicense_regulation==i.idLicense||i.criteria.permitlicense_ecosystem==i.idRB||i.criteria.permitlicense_ecosystem==i.idLS;default:return!1}},i.gridOptions.onRegisterApi=function(e){i.gridApi=e},i.setSearchUrl=function(){(i.removeDisabledSearchCriteria(),_.forOwn(i.dateCriteria,function(e,t){e instanceof Date&&(e.setHours(12),i.criteria[t]=e.toJSON().substr(0,10))}),_.isEmpty(i.criteria))||(_.isEqual(c.criteria,i.criteria)?(c.allowCache=!1,i.search()):t.search(i.criteria))},i.removeDisabledSearchCriteria=function(){_.forOwn(i.criteria,function(e,t){i.isDisabled(t)&&(i.criteria[t]=null)})},i.search=function(){i.isSearching=!0,i.showResultGrid=!1,c.search(i.criteria).then(function(e){i.gridOptions.data=e,i.isSearching=!1,i.showResultGrid=!0})},i.reset=function(){i.criteria={},i.dateCriteria={},c.criteria={},i.gridOptions.data=[],i.showResultGrid=!1},i.exportPermitsLicensesResults=function(e){exportObj.exportData(e,"exportPermitsLicenses")},i.criteria=t.search(),i.dateCriteria={},i.criteria.permitlicense_date_submission_from&&(i.dateCriteria.permitlicense_date_submission_from=new Date(i.criteria.permitlicense_date_submission_from)),i.criteria.permitlicense_date_submission_to&&(i.dateCriteria.permitlicense_date_submission_to=new Date(i.criteria.permitlicense_date_submission_to)),_.isEmpty(i.criteria)&&!_.isEmpty(c.criteria)?t.search(c.criteria):_.isEmpty(i.criteria)||i.search()}]),controllers.controller("StatisticsTabsController",["$scope","$routeParams","$location","$q","$timeout","ProjectFactory","Valuelists","StatisticsService",function(e,t,i,n,r,a,o,s){e.routeParams=t,e.valuelists=o,e.StatisticsService=s,e.StatisticsTabEnum=StatisticsTabEnum;var c;e.tab=(c=i.path(),_.contains(c,"projects")?StatisticsTabEnum.Projects:_.contains(c,"eiaspermits")?StatisticsTabEnum.EiasPermits:_.contains(c,"auditsinspections")?StatisticsTabEnum.AuditsInspections:null),e.goto=function(e){r(function(){i.path(e)})}}]),controllers.controller("StatisticsProjectsController",["$scope","$routeParams","$location","$q","$timeout","ProjectStatistics","UserInfo","Valuelists","StatisticsService",function(t,e,i,n,r,a,o,s,c){t.data={},t.isLoadingData=!0,c.getProjectData().then(function(e){t.data=e,t.isLoadingData=!1})}]),controllers.controller("SearchExternalAuditsController",["$scope","$routeParams","$location","$q","$timeout","ExternalAuditSearch","UserInfo","Valuelists","ExternalAuditSearchService",function(i,e,t,n,r,a,o,s,c){i.isSearching=!1,i.showResultGrid=!1,i.gridOptions={},i.gridOptions.enableHorizontalScrollbar=0,i.gridOptions.showGridFooter=!0,i.gridOptions.minRowsToShow=10,i.gridOptions.enableColumnMenus=!1,i.gridOptions.enableRowSelection=!0,i.gridOptions.enableRowHeaderSelection=!1,i.gridOptions.multiSelect=!1,i.gridOptions.noUnselect=!0,i.gridOptions.enableFooterTotalSelected=!1,i.gridOptions.appScopeProvider={onDblClick:function(e){i.goto("/projects/"+e.project_id+"/externalaudits/"+e.externalaudit_id)}},i.gridOptions.rowTemplate='<div ng-dblclick="grid.appScope.onDblClick(row.entity)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',i.gridOptions.columnDefs=[{name:"externalaudit_id",displayName:"EA Id",type:"number",width:80,cellTooltip:!0,headerTooltip:!0},{name:"externalaudit_status",displayName:"Status",width:200,cellTooltip:!0,headerTooltip:!0},{name:"externalaudit_officer_assigned",displayName:"Team leader",cellTooltip:!0,headerTooltip:!0},{name:"project_title",displayName:"Project name",cellTooltip:!0,headerTooltip:!0},{name:"verification_inspection",displayName:"Verification inspection",width:162,cellTooltip:!0,headerTooltip:!0},{name:"response",displayName:"Response",width:80,cellTooltip:!0,headerTooltip:!0}],i.gridOptions.onRegisterApi=function(e){i.gridApi=e},i.setSearchUrl=function(){(_.forOwn(i.dateCriteria,function(e,t){e instanceof Date&&(e.setHours(12),i.criteria[t]=e.toJSON().substr(0,10))}),_.isEmpty(i.criteria))||(_.isEqual(c.criteria,i.criteria)?(c.allowCache=!1,i.search()):t.search(i.criteria))},i.search=function(){i.isSearching=!0,i.showResultGrid=!1,c.search(i.criteria).then(function(e){i.gridOptions.data=e,i.isSearching=!1,i.showResultGrid=!0})},i.exportExternalAuditResults=function(e){exportObj.exportData(e,"externalAudit")},i.reset=function(){i.criteria={},i.dateCriteria={},c.criteria={},i.gridOptions.data=[],i.showResultGrid=!1},i.criteria=t.search(),i.dateCriteria={},i.criteria.externalaudit_date_submission_from&&(i.dateCriteria.externalaudit_date_submission_from=new Date(i.criteria.externalaudit_date_submission_from)),i.criteria.externalaudit_date_submission_to&&(i.dateCriteria.externalaudit_date_submission_to=new Date(i.criteria.externalaudit_date_submission_to)),_.isEmpty(i.criteria)&&!_.isEmpty(c.criteria)?t.search(c.criteria):_.isEmpty(i.criteria)||i.search()}]),controllers.controller("AdvancedCodesController",["$scope","$routeParams","EditCode","$timeout","$q","$interval","uiGridConstants",function(i,e,t,n,r,a,o){i.routeParams=e,i.parts={code:{form:null,state:SavingStateEnum.Loading}},i.gridOptions={},i.gridOptions.enableCellEditOnFocus=!0,i.gridOptions.showGridFooter=!0,i.gridOptions.minRowsToShow=15,i.gridOptions.rowEditWaitInterval=1e3,i.gridOptions.enableFiltering=!0,i.gridOptions.columnDefs=[{name:"id",type:"number",enableCellEdit:!1,width:60},{name:"description1",cellTooltip:!0,width:"*"},{name:"description2",cellTooltip:!0,width:150},{name:"value1",type:"number",width:100},{name:"dropdown_list",cellTooltip:!0,width:150},{name:"updated_by",enableCellEdit:!1,width:120},{name:"updated_at",enableCellEdit:!1,enableFiltering:!1,type:"date",cellFilter:'date:"d MMM yyyy HH:mm:ss"',width:160},{name:"delete",displayName:"",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,enableColumnMenu:!1,width:80,cellTemplate:'<div><button ng-show="row.entity.deleted_at" ng-click="grid.appScope.undeleteRow(row.entity)" class="btn undelete btn-sm btn-link">undelete</button><button ng-hide="row.entity.deleted_at" ng-click="grid.appScope.deleteRow(row.entity)" class="btn delete btn-sm btn-link">delete</button></div>'}],i.saveRow=function(e){var t=e.$update();i.gridApi.rowEdit.setSavePromise(e,t)},i.deleteRow=function(e){var t=e.$delete({});i.gridApi.rowEdit.setSavePromise(e,t)},i.undeleteRow=function(e){e.deleted_at=null,i.saveRow(e)},i.addRow=function(){(new t).$save().then(function(e){i.gridOptions.data.push(e),n(function(){i.gridApi.cellNav.scrollToFocus(e,i.gridOptions.columnDefs[0])})})},i.gridOptions.onRegisterApi=function(e){(i.gridApi=e).rowEdit.on.saveRow(i,i.saveRow)},t.query({},function(e){i.gridOptions.data=e})}]),controllers.controller("AdvancedUsersController",["$scope","$routeParams","EditUser","$timeout","$q","$interval","uiGridConstants",function(i,e,t,n,r,a,o){i.routeParams=e,i.parts={code:{form:null,state:SavingStateEnum.Loading}},i.gridOptions={},i.gridOptions.enableCellEditOnFocus=!0,i.gridOptions.showGridFooter=!0,i.gridOptions.minRowsToShow=15,i.gridOptions.rowEditWaitInterval=1e3,i.gridOptions.enableFiltering=!0,i.gridOptions.columnDefs=[{name:"id",type:"number",enableCellEdit:!1,width:60},{name:"initials",cellTooltip:!0,width:80},{name:"name",cellTooltip:!0,width:"*"},{name:"job_position_code",cellTooltip:!0,width:80},{name:"job_position_name",cellTooltip:!0,width:100},{name:"email",cellTooltip:!0,width:100},{name:"password",cellTooltip:!0,width:80},{name:"is_passive",type:"number",width:90},{name:"role_ids",enableCellEdit:!0,width:90},{name:"updated_by",enableCellEdit:!1,width:120},{name:"updated_at",enableCellEdit:!1,enableFiltering:!1,type:"date",cellFilter:'date:"d MMM yyyy HH:mm:ss"',width:160},{name:"delete",displayName:"",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,enableColumnMenu:!1,width:80,cellTemplate:'<div><button ng-show="row.entity.deleted_at" ng-click="grid.appScope.undeleteRow(row.entity)" class="btn undelete btn-sm btn-link">undelete</button><button ng-hide="row.entity.deleted_at" ng-click="grid.appScope.deleteRow(row.entity)" class="btn delete btn-sm btn-link">delete</button></div>'}],i.saveRow=function(e){var t=e.$update();i.gridApi.rowEdit.setSavePromise(e,t)},i.deleteRow=function(e){var t=e.$delete({});i.gridApi.rowEdit.setSavePromise(e,t)},i.undeleteRow=function(e){e.deleted_at=null,i.saveRow(e)},i.addRow=function(){(new t).$save().then(function(e){i.gridOptions.data.push(e),n(function(){i.gridApi.cellNav.scrollToFocus(e,i.gridOptions.columnDefs[0])})})},i.gridOptions.onRegisterApi=function(e){(i.gridApi=e).rowEdit.on.saveRow(i,i.saveRow)},t.query({},function(e){i.gridOptions.data=e})}]),controllers.controller("AdvancedLeadAgenciesController",["$scope","$routeParams","EditLeadAgency","$timeout","$q","$interval","uiGridConstants",function(i,e,t,n,r,a,o){i.routeParams=e,i.parts={code:{form:null,state:SavingStateEnum.Loading}},i.gridOptions={},i.gridOptions.enableCellEditOnFocus=!0,i.gridOptions.showGridFooter=!0,i.gridOptions.minRowsToShow=15,i.gridOptions.rowEditWaitInterval=1e3,i.gridOptions.enableFiltering=!0,i.gridOptions.columnDefs=[{name:"id",type:"number",enableCellEdit:!1,width:60},{name:"short_name",cellTooltip:!0,width:150},{name:"long_name",cellTooltip:!0,width:"*"},{name:"updated_by",enableCellEdit:!1,width:120},{name:"updated_at",enableCellEdit:!1,enableFiltering:!1,type:"date",cellFilter:'date:"d MMM yyyy HH:mm:ss"',width:160},{name:"delete",displayName:"",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,enableColumnMenu:!1,width:80,cellTemplate:'<div><button ng-show="row.entity.deleted_at" ng-click="grid.appScope.undeleteRow(row.entity)" class="btn undelete btn-sm btn-link">undelete</button><button ng-hide="row.entity.deleted_at" ng-click="grid.appScope.deleteRow(row.entity)" class="btn delete btn-sm btn-link">delete</button></div>'}],i.saveRow=function(e){var t=e.$update();i.gridApi.rowEdit.setSavePromise(e,t)},i.deleteRow=function(e){var t=e.$delete({});i.gridApi.rowEdit.setSavePromise(e,t)},i.undeleteRow=function(e){e.deleted_at=null,i.saveRow(e)},i.addRow=function(){(new t).$save().then(function(e){i.gridOptions.data.push(e),n(function(){i.gridApi.cellNav.scrollToFocus(e,i.gridOptions.columnDefs[0])})})},i.gridOptions.onRegisterApi=function(e){(i.gridApi=e).rowEdit.on.saveRow(i,i.saveRow)},t.query({},function(e){i.gridOptions.data=e})}]),controllers.controller("AdvancedEmailOrderController",["$scope","$routeParams","EditEmailOrder","$timeout","$q","$interval","uiGridConstants",function(i,e,t,n,r,a,o){i.routeParams=e,i.parts={code:{form:null,state:SavingStateEnum.Loading}},i.gridOptions={},i.gridOptions.enableCellEditOnFocus=!0,i.gridOptions.showGridFooter=!0,i.gridOptions.minRowsToShow=15,i.gridOptions.rowEditWaitInterval=1e3,i.gridOptions.enableFiltering=!0,i.gridOptions.columnDefs=[{name:"id",type:"number",enableCellEdit:!1,width:60},{name:"foreign_id",enableCellEdit:!1,width:80,cellTemplate:'<a href="/resolveLink/emailOrder/{{row.entity.foreign_type}}/{{row.entity.foreign_id}}" ng-click="grid.appScope.visitLink(row.entity)">{{row.entity.foreign_id}}</a>'},{name:"foreign_type",enableCellEdit:!1,width:80},{name:"order_status",enableCellEdit:!0,width:80},{name:"subject",enableCellEdit:!1,width:120},{name:"body",enableCellEdit:!1,width:160},{name:"recipient",enableCellEdit:!0,width:160},{name:"cc",enableCellEdit:!1,width:120},{name:"bcc",enableCellEdit:!1,width:120},{name:"remarks_from_service",enableCellEdit:!1,width:200},{name:"remarks",enableCellEdit:!0,width:120},{name:"updated_by",enableCellEdit:!1,width:120},{name:"updated_at",enableCellEdit:!1,enableFiltering:!1,type:"date",cellFilter:'date:"d MMM yyyy HH:mm:ss"',width:160},{name:"created_by",enableCellEdit:!1,enableFiltering:!1,type:"date",cellFilter:'date:"d MMM yyyy HH:mm:ss"',width:160},{name:"delete",displayName:"",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,enableColumnMenu:!1,width:80,cellTemplate:'<div><button ng-show="row.entity.deleted_at" ng-click="grid.appScope.undeleteRow(row.entity)" class="btn undelete btn-sm btn-link">undelete</button><button ng-hide="row.entity.deleted_at" ng-click="grid.appScope.deleteRow(row.entity)" class="btn delete btn-sm btn-link">delete</button></div>'}],i.exportEmailOrders=function(e){exportObj.exportData(e,"emailOrders")},i.saveRow=function(e){var t=e.$update();i.gridApi.rowEdit.setSavePromise(e,t)},i.deleteRow=function(e){var t=e.$delete({});i.gridApi.rowEdit.setSavePromise(e,t)},i.undeleteRow=function(e){e.deleted_at=null,i.saveRow(e)},i.gridOptions.onRegisterApi=function(e){(i.gridApi=e).rowEdit.on.saveRow(i,i.saveRow)},t.query({},function(e){i.gridOptions.data=e})}]),controllers.controller("LoginController",["$scope","$http","$routeParams","$location","UserInfo","$timeout",function(r,e,t,a,o,i){r.loginData={},r.sendData={},r.resetData={},r.loginMessages=[],r.sendMessages=[],r.resetMessages=[],r.loginFormDisabled=!1,r.sendFormDisabled=!1,r.resetFormDisabled=!1,r.forgot=function(){console.debug("/password/email")};var s=function(e){return _.flatten(_.values(e))};r.login=function(){r.loginForm.$invalid||(r.loginFormDisabled=!0,e.post("/auth/login",r.loginData).success(function(e,t,i,n){r.loginMessages=s(e),o.reTry(),a.path("/")}).error(function(e,t,i,n){r.loginMessages=s(e),r.loginFormDisabled=!1}))},r.send=function(){r.sendForm.$invalid||(r.sendFormDisabled=!0,e.post("/password/email",r.sendData).success(function(e,t,i,n){r.sendMessages=s(e)}).error(function(e,t,i,n){r.sendMessages=s(e),r.sendFormDisabled=!1}))},r.reset=function(){r.resetForm.$invalid||(r.resetFormDisabled=!0,r.resetData.token=t.token,e.post("/password/reset",r.resetData).success(function(e,t,i,n){r.resetMessages=s(e),o.reTry(),a.path("/user")}).error(function(e,t,i,n){r.resetMessages=s(e),r.resetFormDisabled=!1}))},i(function(){})}]),(controllers=angular.module("seroApp.controllers")).controller("EiapermitPirkingController",["$scope","$http","EiaPermit","Document","Valuelists","$q",function(o,e,s,c,d,l){o.lastId="..",o.criteria={},o.dryrun=!0,o.eiaspermits=[],o.working=!1,o.info={error:0,nochange:0,changed:0,finished:function(){return this.error+this.nochange+this.changed},progress:function(){return 0==o.eiaspermits.length?0:Math.round(100*this.finished()/o.eiaspermits.length)}},e({method:"GET",url:"/pirking/v1/eiaspermits/stats"}).then(function(e){o.lastId=e.data},function(e){console.log("couldn't fetch stats")}),o.beginPirking=function(){o.info.error=0,o.info.nochange=0,o.info.changed=0,console.log("beginPirking"),console.log("dryrun:",o.dryrun),o.working=!0,e({method:"GET",url:"/pirking/v1/eiaspermits",params:o.criteria}).then(function(e){o.eiaspermits=e.data,console.log("beginPirking finished"),o.beginUpdate()},function(e){console.log("oh noes")})};o.beginUpdate=function(){function i(n){n.updating=!0;var r={projectId:n.project_id,eiapermitId:n.eiapermit_id},e=s.get(r).$promise,t=c.query(r).$promise,a=l.defer();return l.all([e,t]).then(function(e){var t=e[0],i=updateEiaPermitStatus(t,e[1]);n.status_id_new=t.status,n.status_description_new=function(e){var t=_.find(d.eiastatus,{id:e});return t?t.description1:""}(t.status),i?o.dryrun?(n.changed=!0,n.result="CHANGED",o.info.changed+=1,n.updating=!1,a.resolve()):(t.pirking=!0,t.$update(r,function(e){n.changed=!0,n.result="CHANGED",o.info.changed+=1,n.updating=!1,n.eiapermit_updated_at=e.updated_at,a.resolve()})):(n.nochange=!0,n.result="NO CHANGE",o.info.nochange+=1,n.updating=!1,a.resolve())},function(e){n.updating=!1,n.error=!0,n.result="ERROR",o.info.error+=1,a.reject("Server Error")}),a.promise}console.log("beginUpdate"),o.eiaspermits.reduce(function(e,t){return e.then(function(){return i(t)}).catch(function(e){console.log("ERROR:",e)})},l.when()).then(function(){console.log("beginUpdate finished"),o.working=!1})}}]),controllers.controller("ExternalAudiPirkingController",["$scope","$http","ProjectFactory","Document","Valuelists","$q",function(o,e,t,i,s,c){o.lastId="sdjshdfj..",o.criteria={},o.dryrun=!0,o.EaData=[],o.working=!1,o.info={error:0,nochange:0,changed:0,finished:function(){return this.error+this.nochange+this.changed},progress:function(){return 0==o.EaData.length?0:Math.round(100*this.finished()/o.EaData.length)}},e({method:"GET",url:"/pirking/v1/externalAuditList/stats"}).then(function(e){o.lastId=e.data},function(e){console.log("couldn't fetch stats")}),o.beginPirking=function(){o.info.error=0,o.info.nochange=0,o.info.changed=0,console.log("beginPirking"),console.log("dryrun:",o.dryrun),o.working=!0,e({method:"GET",url:"/pirking/v1/externalAuditList",params:o.criteria}).then(function(e){o.EaData=e.data,console.log("beginPirking finished"),o.beginUpdate()},function(e){console.log("oh noes")})};o.beginUpdate=function(){function i(n){n.updating=!0;var r={projectId:n.project_id,externalauditId:n.externalaudit_id},e=t.retrieveProjectData(r),a=c.defer();return c.all([e[5]]).then(function(e){var t=_.find(e[0],{id:n.externalaudit_id});console.log(t,"data");var i=updateExternalAuditStatus(t,t.documents);n.status_id_new=t.status,n.status_description_new=function(e){var t=_.find(s.eastatus,{id:e});return t?t.description1:""}(t.status),i&&parseInt(n.status_id_new)!=parseInt(n.status_id)?o.dryrun?(n.changed=!0,n.result="CHANGED",o.info.changed+=1,n.updating=!1,a.resolve()):(t.pirking=!0,t.$update(r,function(e){n.changed=!0,n.result="CHANGED",o.info.changed+=1,n.updating=!1,n.externalaudit_updated_at=e.updated_at,a.resolve()})):(n.nochange=!0,n.result="NO CHANGE",o.info.nochange+=1,n.updating=!1,a.resolve())},function(e){n.updating=!1,n.error=!0,n.result="ERROR",o.info.error+=1,a.reject("Server Error")}),a.promise}console.log("beginUpdate"),o.EaData.reduce(function(e,t){return e.then(function(){var e=i(t);return console.log(e,"ray"),e}).catch(function(e){console.log("ERROR:",e)})},c.when()).then(function(){console.log("beginUpdate finished"),o.working=!1})}}]),controllers.controller("AuditInspecitionPirkingController",["$scope","$http","ProjectFactory","Valuelists","$q",function(o,e,t,s,c){o.lastId="..",o.criteria={},o.dryrun=!0,o.aiData=[],o.working=!1,o.info={error:0,nochange:0,changed:0,finished:function(){return this.error+this.nochange+this.changed},progress:function(){return 0==o.aiData.length?0:Math.round(100*this.finished()/o.aiData.length)}},e({method:"GET",url:"/pirking/v1/auditInspection/stats"}).then(function(e){o.lastId=e.data},function(e){console.log("couldn't fetch stats")}),o.beginPirking=function(){o.info.error=0,o.info.nochange=0,o.info.changed=0,console.log("beginPirking"),console.log("dryrun:",o.dryrun),o.working=!0,e({method:"GET",url:"/pirking/v1/auditInspection",params:o.criteria}).then(function(e){o.aiData=e.data,console.log("beginPirking finished"),o.beginUpdate()},function(e){console.log("oh noes")})};o.beginUpdate=function(){function i(n){n.updating=!0;var r={projectId:n.project_id,auditinspectionId:n.auditsInspections_id},e=t.retrieveProjectData(r),a=c.defer();return c.all([e[3]]).then(function(e){var t=_.find(e[0],{id:n.auditsInspections_id}),i=updateAuditInspectionStatus(t);n.status_id_new=t.status,n.status_description_new=function(e){var t=_.find(s.auditinspectionstatus,{id:e});return t?t.description1:""}(t.status),i&&parseInt(n.status_id_new)!=parseInt(n.status_id)?o.dryrun?(n.changed=!0,n.result="CHANGED",o.info.changed+=1,n.updating=!1,a.resolve()):(t.pirking=!0,t.$update(r,function(e){n.changed=!0,n.result="CHANGED",o.info.changed+=1,n.updating=!1,n.externalaudit_updated_at=e.updated_at,a.resolve()})):(n.nochange=!0,n.result="NO CHANGE",o.info.nochange+=1,n.updating=!1,a.resolve())},function(e){n.updating=!1,n.error=!0,n.result="ERROR",o.info.error+=1,a.reject("Server Error")}),a.promise}console.log("beginUpdate"),o.aiData.reduce(function(e,t){return e.then(function(){return i(t)}).catch(function(e){console.log("ERROR:",e)})},c.when()).then(function(){console.log("beginUpdate finished"),o.working=!1})}}]),controllers.controller("PermitLicensePirkingController",["$scope","$http","ProjectFactory","Valuelists","$q",function(o,e,t,s,c){o.lastId="..",o.criteria={},o.dryrun=!0,o.plData=[],o.working=!1,o.info={error:0,nochange:0,changed:0,finished:function(){return this.error+this.nochange+this.changed},progress:function(){return 0==o.plData.length?0:Math.round(100*this.finished()/o.plData.length)}},e({method:"GET",url:"/pirking/v1/permitLicense/stats"}).then(function(e){o.lastId=e.data},function(e){console.log("couldn't fetch stats")}),o.beginPirking=function(){o.info.error=0,o.info.nochange=0,o.info.changed=0,console.log("beginPirking"),console.log("dryrun:",o.dryrun),o.working=!0,e({method:"GET",url:"/pirking/v1/permitLicense",params:o.criteria}).then(function(e){o.plData=e.data,console.log("beginPirking finished"),o.beginUpdate()},function(e){console.log("oh noes")})};o.beginUpdate=function(){function i(n){var r={projectId:n.project_id,permitlicenseId:n.permitLicense_id},e=t.retrieveProjectData(r),a=c.defer();return c.all([e[4]]).then(function(e){var t=_.find(e[0],{id:n.permitLicense_id});if(t){console.log("before the change",t);var i=updatePermitLicenseStatus(t);n.status_id_new=t.status,n.status_description_new=function(e){var t=_.find(s.permitlicencestatus,{id:e});return t?t.description1:""}(t.status),i&&parseInt(n.status_id_new)!=parseInt(n.status_id)?o.dryrun?(n.changed=!0,n.result="CHANGED",o.info.changed+=1,n.updating=!1,a.resolve()):(t.pirking=!0,t.$update(r,function(e){n.changed=!0,n.result="CHANGED",o.info.changed+=1,n.updating=!1,n.externalaudit_updated_at=e.updated_at,a.resolve()})):(n.nochange=!0,n.result="NO CHANGE",o.info.nochange+=1,n.updating=!1,a.resolve())}},function(e){n.updating=!1,n.error=!0,n.result="ERROR",o.info.error+=1,a.reject("Server Error")}),a.promise}console.log("beginUpdate"),o.plData.reduce(function(e,t){return e.then(function(){return i(t)}).catch(function(e){console.log("ERROR:",e)})},c.when()).then(function(){console.log("beginUpdate finished"),o.working=!1})}}]),(controllers=angular.module("seroApp.controllers")).controller("DataAnonymizerController",["$scope","$http",function(t,i){t.defaultBtnTxt="anonymize",t.loaded=!0,t.successState=parseInt(localStorage.reloaded_dac),localStorage.reloaded_dac=0,t.working=!1,console.log(t.successState,t.working,"params"),t.done=0,t.anonymize=function(e){t.working=!0,i({method:"GET",url:"/anonymizerData/v1/"+e,params:t.criteria}).then(function(e){t.working=!1,t.successState=e.data.status,t.done=2,t.successState&&(localStorage.reloaded_dac=t.successState,window.location.reload())},function(e){t.done=2,t.working=!1,t.successState=0})}}]);var directives=angular.module("seroApp.directives").directive("appVersion",["version",function(n){return function(e,t,i){t.text(n.replace(/\.0$/,"").replace(/\.00$/,".0").replace(/\.([1-9])$/,".0$1"))}}]);directives.directive("addPractitionerButton",["Practitioner",function(n){return{restrict:"A",link:function(e,t,i){t.bind("click",function(){new n({person:"Gunnar Nymann",city:"Oslo"}).$save()})}}}]),directives.directive("animateNewElement",["$animate",function(r){return function(e,n,t){e.$watch(t.animateNewElement,function(e,t){if(!0===e){console.log(n);var i="new-element";r.addClass(n,i,function(){r.removeClass(n,i)})}})}}]),directives.directive("hoverOnParent",[function(){return{restrict:"A",link:function(e,t,i){var n=i.hoverOnParent;t.parent(n).bind("mouseenter",function(){t.addClass("btn-link-hover")}),t.parent(n).bind("mouseleave",function(){t.removeClass("btn-link-hover")})}}}]),directives.directive("coordinatePasting",function(){return{require:"ngModel",link:function(e,t,i,n){n.$setViewValue("0.12104"),n.$render()}}}),directives.directive("setFocus",["$timeout",function(n){return{restrict:"A",link:function(e,t,i){n(function(){n(function(){t[0].focus()})})}}}]),directives.directive("statisticsPanel",function(){return{restrict:"E",scope:{part:"="},templateUrl:"partials/statisticsTablePanel.html"}}),angular.module("seroApp.directives").directive("seroDeleteButton",["$sce",function(e){return{restrict:"E",scope:{onYes:"&",text:"=",warning:"=",buttonClass:"="},templateUrl:"partials/directives.deleteButton.html"}}]),seroApp.filter("myDateFormat",function(i){return function(e){if(!e)return"tom";var t=new Date(e.replace(/-/g,"/"));return i("date")(t,"MMM-dd-yyyy")}});var version={version:"5.52.0"},services=angular.module("seroApp.services");services.value("version",version.version),services.factory("Practitioner",["$resource",function(e){return e("/api/v1/practitioner/:id",{id:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Project",["$resource",function(e){return e("/api/v1/project/:projectId",{projectId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Organisation",["$resource",function(e){return e("/api/v1/organisation/:organisationId",{organisationId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("EiaPermit",["$resource",function(e){return e("/api/v1/project/:projectId/eiapermit/:eiapermitId",{eiapermitId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Document",["$resource",function(e){return e("/api/v1/project/:projectId/eiapermit/:eiapermitId/document/:documentId",{documentId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Hearing",["$resource",function(e){return e("/api/v1/project/:projectId/eiapermit/:eiapermitId/document/:documentId/hearing/:hearingId",{hearingId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("PermitLicense",["$resource",function(e){return e("/api/v1/project/:projectId/permitlicense/:permitlicenseId",{permitLicenseId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("ExternalAudit",["$resource",function(e){return e("/api/v1/project/:projectId/externalaudit/:externalauditId",{externalauditId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("DocumentEA",["$resource",function(e){return e("/api/v1/project/:projectId/externalaudit/:externalauditId/document/:documentId",{documentId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("AuditInspection",["$resource",function(e){return e("/api/v1/project/:projectId/auditinspection/:auditinspectionId",{auditinspectionId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Valuelist",["$resource",function(e){return e("/api/v1/valuelist/:id",{id:"@id"})}]),services.factory("EnvInfo",["$http",function(e){return function(t){e.get("/env").success(function(e){return t(e)})}}]),services.factory("Valuelists",["Valuelist",function(e){return e.get({id:"all"})}]),services.factory("UserInfo",["$http","$location",function(t,i){var n={info:{}},r={name:"Not signed in",role_1:!1,role_2:!1,role_3:!1,role_4:!1,role_5:!1,role_6:!1,role_7:!1,role_8:!1,roles:[],features:[]},a=function(e){e?(_.merge(n.info,e),"/login"==i.path()&&i.path("/")):n.info=_.cloneDeep(r)},e=function(){t.get("/user/info").success(a)};return n.impersonate=function(e){a(null),t.get("/user/impersonate/"+e).success(a)},n.signout=function(){t.get("/auth/logout").success(function(){a(null),i.path("/login")})},n.getAllUsers=function(){t.get("/user/all").success(function(e){n.allusers=e})},n.reTry=function(){e()},a(null),e(),n}]),services.factory("EditCode",["$resource",function(e){return e("/edit/v1/code/:codeId",{codeId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("EditUser",["$resource",function(e){return e("/edit/v1/user/:userId",{userId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("EditEmailOrder",["$resource",function(e){return e("/edit/v1/emailOrder/:emailOrderId",{emailOrderId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("EditLeadAgency",["$resource",function(e){return e("/edit/v1/leadagency/:leadAgencyId",{leadAgencyId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("EiaPermitSearch",["$resource",function(e){return e("/search/v1/eiapermit")}]),services.factory("PermitLicenseSearch",["$resource",function(e){return e("/search/v1/permitlicense")}]),services.factory("ExternalAuditSearch",["$resource",function(e){return e("/search/v1/externalaudit")}]),services.factory("AuditInspectionSearch",["$resource",function(e){return e("/search/v1/auditinspection")}]),services.factory("ProjectSearch",["$resource",function(e){return e("/search/v1/project")}]),services.factory("ProjectStatistics",["$resource",function(e){return e("/statistics/v1/project")}]),services.factory("GeneralStatistics",["$resource",function(e){return e("/statistics/v1/general")}]),services.factory("EiaPermitSearchService",["EiaPermitSearch","$q",function(i,n){var r={criteria:{},allowCache:!0,rows:[],search:function(e){var t=n.defer();return _.isEqual(r.criteria,e)&&r.allowCache?t.resolve(r.rows):(r.criteria=_.clone(e),i.query(r.criteria,function(e){r.rows=e,t.resolve(r.rows),r.allowCache=!0})),t.promise}};return r}]),services.factory("PermitLicenseSearchService",["PermitLicenseSearch","$q",function(i,n){var r={criteria:{},allowCache:!0,rows:[],search:function(e){var t=n.defer();return _.isEqual(r.criteria,e)&&r.allowCache?t.resolve(r.rows):(r.criteria=_.clone(e),i.query(r.criteria,function(e){r.rows=e,t.resolve(r.rows),r.allowCache=!0})),t.promise}};return r}]),services.factory("ExternalAuditSearchService",["ExternalAuditSearch","$q",function(i,n){var r={criteria:{},allowCache:!0,rows:[],search:function(e){var t=n.defer();return _.isEqual(r.criteria,e)&&r.allowCache?t.resolve(r.rows):(r.criteria=_.clone(e),i.query(r.criteria,function(e){r.rows=e,t.resolve(r.rows),r.allowCache=!0})),t.promise}};return r}]),services.factory("SearchService",["AuditInspectionSearch","$q",function(i,n){var r={criteria:{},allowCache:!0,rows:[],search:function(e){var t=n.defer();return _.isEqual(r.criteria,e)&&r.allowCache?t.resolve(r.rows):(r.criteria=_.clone(e),i.query(r.criteria,function(e){r.rows=e,t.resolve(r.rows),r.allowCache=!0})),t.promise}};return r}]),services.factory("ProjectSearchService",["ProjectSearch","$q",function(i,n){var r={criteria:{},allowCache:!0,rows:[],search:function(e){var t=n.defer();return _.isEqual(r.criteria,e)&&r.allowCache?t.resolve(r.rows):(r.criteria=_.clone(e),i.query(r.criteria,function(e){r.rows=e,t.resolve(r.rows),r.allowCache=!0})),t.promise}};return r}]),services.factory("StatisticsService",["ProjectStatistics","$q",function(i,n){var r={allowCache:!0,projectData:{},getProjectData:function(e){var t=n.defer();return r.allowCache&&!_.isEmpty(r.projectData)?t.resolve(r.projectData):i.get({},function(e){r.projectData=e,t.resolve(e)}),t.promise}};return r}]);var data1={};services.factory("ProjectFactory",["$q","$filter","Project","Organisation","EiaPermit","Document","Hearing","ExternalAudit","DocumentEA","AuditInspection","Valuelists","UserInfo","PermitLicense",function(c,e,d,l,u,r,a,p,o,m,t,i,f){var h={project:{},organisation:{},eiaspermits:[],eiapermit:{},documents:[],document:{},hearings:[],hearing:{},permitslicenses:[],permitlicense:{},externalaudits:[],externalaudit:{},documents_ea:[],document_ea:{},auditsinspections:[],auditinspection:{}};return h.valuelists=t,h.userinfo=i,h.hasData={eiapermits:!1,eiapermit:!1,documents:!1,document:!1,hearings:!1,hearing:!1,permitslicenses:!1,permitlicense:!1,externalaudits:!1,externalaudit:!1,documents_ea:!1,document_ea:!1},h.retrieveProjectData=function(e){var t=c.defer(),i=c.defer(),n=c.defer(),r=c.defer(),a=c.defer(),o=c.defer();if(h.project.id!=e.projectId){var s=_.omit(e,["eiapermitId","externalauditId","documentId","hearingId","permitlicenseId","auditinspectionId"]);h.empty(),h.project=d.get(s,function(e){t.resolve(e),h.organisation=l.get({organisationId:e.organisation_id},function(e){i.resolve(e)})}),h.eiaspermits=u.query(s,function(e){n.resolve(e)}),h.permitslicenses=f.query(s,function(e){o.resolve(e)}),h.externalaudits=p.query(s,function(e){r.resolve(e)}),h.auditsinspections=m.query(s,function(e){a.resolve(e)})}else _.remove(h.permitslicenses,function(e){return e.is_new}),t.resolve(h.project),i.resolve(h.organisation),n.resolve(h.eiaspermits),o.resolve(h.permitslicenses),r.resolve(h.externalaudits),a.resolve(h.auditsinspections);return[t.promise,i.promise,n.promise,a.promise,o.promise,r.promise]},h.retrieveEiaPermit=function(t){var i=c.defer(),n=c.defer();if(h.eiapermit.id!=t.eiapermitId){h.emptyEiaPermit();var e=_.where(h.eiaspermits,{id:parseInt(t.eiapermitId)});1==e.length&&(h.eiapermit=e[0],h.eiapermit.$get(_.omit(t,["documentId","hearingId"]),function(e){i.resolve(e),h.documents=r.query(_.omit(t,["documentId","hearingId"]),function(e){n.resolve(e)})}))}else i.resolve(h.eiapermit),n.resolve(h.documents);return[i.promise,n.promise]},h.retrieveDocument=function(t){var i=c.defer(),n=c.defer();if(h.document.id!=t.documentId){h.emptyDocument();var e=_.where(h.documents,{id:parseInt(t.documentId)});1==e.length&&(h.document=e[0],h.document.$get(_.omit(t,["hearingId"]),function(e){h.hearings=a.query(_.omit(t,["hearingId"]),function(e){n.resolve(e)}),i.resolve(e)}))}else i.resolve(h.document),n.resolve(h.hearings);return[i.promise,n.promise]},h.retrieveHearing=function(e){var t=c.defer();if(h.hearing.id!=e.hearingId){h.emptyHearing();var i=_.where(h.hearings,{id:parseInt(e.hearingId)});1==i.length&&(h.hearing=i[0],h.hearing.$get(e,function(e){t.resolve(e)}))}else t.resolve(h.hearing);return[t.promise]},h.retrieveExternalAudit=function(t){var i=c.defer(),n=c.defer();h.emptyExternalAudit();var e=_.where(h.externalaudits,{id:parseInt(t.externalauditId)});return 1==e.length&&(h.externalaudit=e[0],h.externalaudit.$get(_.omit(t,["documentId"]),function(e){h.documents_ea=o.query(_.omit(t,["documentId"]),function(e){n.resolve(e)}),i.resolve(e)})),[i.promise,n.promise]},h.retrieveDocumentEA=function(e){var t=c.defer();if(h.document_ea.id!=e.documentId){h.emptyDocumentEA();var i=_.where(h.documents_ea,{id:parseInt(e.documentId)});1==i.length&&(h.document_ea=i[0],h.document_ea.$get(_.omit(e,["hearingId"]),function(e){t.resolve(e)}))}else t.resolve(h.document_ea);return[t.promise]},h.retrieveAuditInspection=function(e){var t=c.defer();if(e.auditinspectionId){var i=_.where(h.auditsinspections,{id:parseInt(e.auditinspectionId)});1==i.length&&(h.auditinspection=i[0],h.auditinspection.$get(e,function(e){t.resolve(e)}))}return[t.promise]},h.retrievePermitLicense=function(e){data1=h.permitslicenses;var t=c.defer();if(e.permitlicenseId){var i=_.where(h.permitslicenses,{id:parseInt(e.permitlicenseId)});1==i.length&&(h.permitlicense=i[0],h.permitlicense.$get(e,function(e){t.resolve(e)}))}return[t.promise]},h.getProjectSummary=function(e){var t=h.project;return t.title?t.title:""},h.getCodeFromValuelist=function(e,t){"string"==typeof t&&(t=parseInt(t));var i=_.find(h.valuelists[e],{id:t});return i?i.description1:""},h.setOrganisation=function(e){var t=c.defer();return e=new l(e),(h.organisation=e).$get({},function(e){t.resolve(e)}),t.promise},h.setEiaPermit=function(e){var t=c.defer();return h.eiapermit=e,t.resolve(e),t.promise},h.setAuditInspection=function(e){var t=c.defer();return h.auditinspection=e,t.resolve(e),t.promise},h.empty=function(){h.project={},h.organisation={},h.eiaspermits=[],h.emptyEiaPermit(),h.emptyExternalAudit(),h.auditsinspections=[],h.auditinspection={}},h.emptyEiaPermit=function(){h.eiapermit={},h.documents=[],h.emptyDocument()},h.emptyDocument=function(){h.document={},h.hearings=[],h.emptyHearing()},h.emptyHearing=function(){h.hearing={}},h.emptyExternalAudit=function(){h.externalaudit={},h.documents_ea=[],h.emptyDocumentEA()},h.emptyDocumentEA=function(){h.document_ea={}},h.createNewProject=function(e){var t={has_industrial_waste_water:42,organisation_id:e.id,risk_level:null,is_new:!0};h.project=new d(t)},h.createNewOrganisation=function(){h.organisation=new l({is_new:!0})},h.createNewEiaPermit=function(e){var t={project_id:e.id,inspection_recommended:42,is_new:!0};h.eiapermit=new u(t),h.eiaspermits.push(h.eiapermit),h.documents=[]},h.createNewDocument=function(e){var t={eia_permit_id:e.id,director_copy_no:1,is_new:!0};h.document=new r(t),h.documents.unshift(h.document),h.hearings=[]},h.createNewHearing=function(e){var t={document_id:e.id,is_new:!0};h.hearing=new a(t),h.hearings.unshift(h.hearing)},h.deleteEiaPermit=function(e){var t=_.findIndex(h.eiaspermits,{id:h.eiapermit.id}),i=function(e){h.eiaspermits.splice(e,1),h.eiapermit={}};h.eiapermit.is_new?i(t):h.eiapermit.$delete(e,function(){i(t)})},h.deleteDocument=function(e){var t=c.defer(),i=function(e){h.documents.splice(e,1),h.document={}};if(h.document.is_new)i(0);else{var n=_.findIndex(h.documents,{id:h.document.id});h.document.$delete(e,function(){i(n),t.resolve()})}return t.promise},h.moveDocument=function(e,t){var i=c.defer(),n=_.findIndex(h.documents,{id:h.document.id});return h.document.eia_permit_id=t,h.document.$update(e,function(e){!function(e){h.documents.splice(e,1),h.document={}}(n),i.resolve(e)},function(){i.reject("Moving failed")}),i.promise},h.moveDocumentEA=function(e,t){var i=c.defer(),n=_.findIndex(h.documents_ea,{id:h.document_ea.id});return h.document_ea.external_audit_id=t,h.document_ea.$update(e,function(e){!function(e){h.documents_ea.splice(e,1),h.document_ea={}}(n),i.resolve(e)},function(){i.reject("Moving failed")}),i.promise},h.deleteHearing=function(e){var t=c.defer(),i=function(e){h.hearings.splice(e,1),h.hearing={}};if(h.hearing.is_new)i(0);else{var n=_.findIndex(h.hearings,{id:h.hearing.id});h.hearing.$delete(e,function(){i(n),t.resolve()})}return t.promise},h.createNewExternalAudit=function(e){var t={project_id:e.id,is_new:!0};h.externalaudit=new p(t),h.externalaudits.push(h.externalaudit),h.documents_ea=[]},h.createNewDocumentEA=function(e){var t={external_audit_id:e.id,director_copy_no:1,is_new:!0};h.document_ea=new o(t),h.documents_ea.unshift(h.document_ea)},h.deleteExternalAudit=function(e){var t=_.findIndex(h.externalaudits,{id:h.externalaudit.id}),i=function(e){h.externalaudits.splice(e,1),h.externalaudit={}};h.externalaudit.is_new?i(t):h.externalaudit.$delete(e,function(){i(t)})},h.deleteDocumentEA=function(e){var t=c.defer(),i=function(e){h.documents_ea.splice(e,1),h.document_ea={}};if(h.document_ea.is_new)i(0);else{var n=_.findIndex(h.documents_ea,{id:h.document_ea.id});h.document_ea.$delete(e,function(){i(n),t.resolve()})}return t.promise},h.createNewAuditInspection=function(e,t,i,n,r){var a={project_id:e.id,year:t,type:i,reason:n,date_carried_out:r,days:1,status:70,performance_level:47,lead_officer:h.userinfo.info.id,is_new:!0};h.auditinspection=new m(a),h.auditsinspections.push(h.auditinspection)},h.deleteAuditInspection=function(e){var t=_.findIndex(h.auditsinspections,{id:h.auditinspection.id}),i=function(e){h.auditsinspections.splice(e,1),0<h.auditsinspections.length?h.auditinspection=h.auditinspection[0]:h.auditinspection={}};h.auditinspection.is_new?i(t):h.auditinspection.$delete(e,function(){i(t)})},h.createNewPermitLicense=function(e,t,i,n,r,a,o,s,c){var d={project_id:e.id,regulation:t,ecosystem:i,regulation_activity:n,area:r,unit:a,approved_by_the_lc1:o,approved_by_the_dec:s,waste_license_type:c,is_new:!0};h.permitlicense=new f(d),h.permitslicenses.push(h.permitlicense)},h.deletePermitLicense=function(e){var t=_.findIndex(h.permitslicenses,{id:h.permitlicense.id}),i=function(e){h.permitslicenses.splice(e,1),h.permitlicense={}};h.permitlicense.is_new?i(t):h.permitlicense.$delete(e,function(){i(t)})},h.deleteProject=function(e){var t=c.defer(),i=function(){h.project={},t.resolve()};return h.project.is_new?i():h.project.$delete(e,function(){i()}),t.promise},h.save=function(e,t){var i=c.defer();if(t.is_new){var n=_.omit(e,function(e){return"new"==e});t.$save(n,function(e){i.resolve(e)},function(){i.reject("Saving new failed")})}else t.$update(e,function(e){i.resolve(e)},function(){i.reject("Saving exisiting failed")});return i.promise},h}]);var validations=angular.module("pax.validations");function isNumberInRange(e,t,i){return!(null!==e&&i<e)&&!(null!==t&&t<i)}function getColumns(e){var n=[];return $.each(e[0],function(e,t){var i={};i.headertext=e,i.datatype="string",i.datafield=e,n.push(i)}),n}validations.directive("decimal",function(){return{require:"ngModel",link:function(e,t,i,r){var n=i.min?parseFloat(i.min):null,a=i.max?parseFloat(i.max):null,o=i.decimal?"{0,"+parseInt(i.decimal)+"}":"+",s=i.negativeNumber?"\\-?":"",c=new RegExp("^"+s+"\\d+((\\.|\\,)\\d"+o+")?$");r.$parsers.push(function(e,t){if(r.$isEmpty(e))return null;var i=e.toString().trim().replace(",","."),n=parseFloat(i);return r.$isEmpty(n)?void 0:n}),r.$formatters.push(function(e){if(r.$isEmpty(e)||!i.decimal)return e;var t=parseInt(i.decimal);return _.round(parseFloat(e),t).toFixed(t)}),r.$validators.decimalInRange=function(e,t){return!!r.$isEmpty(e)||!!c.test(t)&&isNumberInRange(n,a,t)}}}}),validations.directive("integer",function(){return{require:"ngModel",link:function(e,t,i,n){var r=i.min?parseInt(i.min):null,a=i.max?parseInt(i.max):null,o=i.negativeNumber?"\\-?":"",s=new RegExp("^"+o+"\\d+$");n.$validators.integerInRange=function(e,t){return!!n.$isEmpty(e)||!!s.test(t)&&isNumberInRange(r,a,t)}}}}),validations.directive("certificateNumber",function(){return{require:"ngModel",link:function(e,t,i,n){var r=new RegExp("^CC/(EIA|EA|EP|FP)/[0-9]{3}/[0-9]{2}$");n.$validators.certificateNumber=function(e,t){return!!n.$isEmpty(e)||r.test(t)}}}}),function(o){var s={containerid:null,datatype:"table",dataset:null,columns:null,returnUri:!0,locale:"en-US",worksheetName:"My Worksheet",encoding:"utf-8"},c=s;o.fn.excelexportjs=function(e){c=o.extend({},s,e);var t,r=[];return function(){var e=c.datatype.toLowerCase();switch(function(e){switch(e){case"table":break;case"json":r=c.dataset;break;case"xml":o(c.dataset).find("row").each(function(e,t){var i={};null!=this.attributes&&0<this.attributes.length&&(o(this.attributes).each(function(){i[this.name]=this.value}),r.push(i))});break;case"jqgrid":o(c.dataset).find("rows > row").each(function(e,t){var i={};null!=this.children&&0<this.children.length&&(o(this.children).each(function(){i[this.tagName]=o(this).text()}),r.push(i))})}}(e),e){case"table":t=n(o("<div>").append(o("#"+c.containerid).clone()).html());break;case"json":case"xml":case"jqgrid":t=n(i())}{if(c.returnUri)return t;a()||window.open(t)}}();function i(){var n="<table id='tabledata' style='table-layout:inherit;white-space: nowrap;'>";return n+="<thead><tr>",o(c.columns).each(function(e,t){1!=this.ishidden&&(n+="<th",this.width,n+=">",n+=this.headertext,n+="</th>")}),n+="</tr></thead>",n+="<tbody>",o(r).each(function(e,i){n+="<tr>",o(c.columns).each(function(e,t){i.hasOwnProperty(this.datafield)&&1!=this.ishidden&&(n+="<td",n+=">",n+=i[this.datafield],n+="</td>")}),n+="</tr>"}),n+="</tbody>",n+="</table>"}function n(e){if(!a()){var t="<html xml:lang="+s.locale+" xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:excel' xmlns='http://www.w3.org/TR/REC-html40'>";t+="<head>",t+='<meta http-equiv="Content-type" content="text/html;charset='+s.encoding+'" />',t+="\x3c!--[if gte mso 9]>",t+="<xml>",t+="<x:ExcelWorkbook>",t+="<x:ExcelWorksheets>",t+="<x:ExcelWorksheet>",t+="<x:Name>",t+="{worksheet}",t+="</x:Name>",t+="<x:WorksheetOptions>",t+="<x:DisplayGridlines/>",t+="</x:WorksheetOptions>",t+="</x:ExcelWorksheet>",t+="</x:ExcelWorksheets>",t+="</x:ExcelWorkbook>",t+="</xml>",t+="<![endif]--\x3e",t+="</head>",t+="<body>",t+=e.replace(/"/g,"'"),t+="</body>";return function(e){return window.btoa(unescape(encodeURIComponent(e)))}(function(e,i){return e.replace(/{(\w+)}/g,function(e,t){return i[t]})}(t+="</html>",{worksheet:c.worksheetName,table:e}))}!function(e){var t=document.createElement("div");t.innerHTML=e;var i,n="<table border='2px'><tr bgcolor='#87AFC6'>",r=0;i="table"==c.datatype.toLowerCase()?document.getElementById(c.containerid):t.children[0];for(r=0;r<i.rows.length;r++)n=n+i.rows[r].innerHTML+"</tr>";n=(n=(n=(n+="</table>").replace(/<A[^>]*>|<\/A>/g,"")).replace(/<img[^>]*>/gi,"")).replace(/<input[^>]*>|<\/input>/gi,""),0<window.navigator.userAgent.indexOf("MSIE ")||navigator.userAgent.match(/Trident.*rv\:11\./)?(txtArea1.document.open("txt/html","replace"),txtArea1.document.write(n),txtArea1.document.close(),txtArea1.focus(),sa=txtArea1.document.execCommand("SaveAs",!0,c.worksheetName+".xlsx")):sa=window.open("data:application/vnd.ms-excel,"+encodeURIComponent(n));sa}(e)}function a(){return 0<(!!navigator.userAgent.match(/Trident/g)||!!navigator.userAgent.match(/MSIE/g))}}}(jQuery);var excelExport=function(e,t,i){e=exportHelpers.reformatDateFields(e,t.dateFields),e=exportHelpers.renameFields(e,t.fieldmap),e=exportHelpers.sortObj(e,Object.values(t.fieldmap)),e=exportHelpers.replaceNullValues(e);var n=$("#dvjson").excelexportjs({containerid:"dvjson",datatype:"json",dataset:e,columns:getColumns(e),worksheetName:""}),r=new Date,a=r.getDate()+"."+(r.getMonth()+1)+"."+r.getFullYear()+"_"+r.getHours()+"."+r.getMinutes(),o=exportHelpers.b64toBlob(n,"application/vnd.ms-excel"),s=URL.createObjectURL(o),c=document.createElement("a"),d=document.body.appendChild(c);d.href=s,d.download=i+"_"+a+".xls",d.click()},exportHelpers={renameFields:function(e,t){var i=(e=JSON.parse(JSON.stringify(e))).length;for(var n in t)if(t.hasOwnProperty(n))for(var r=t[n],a=0;a<i;a++){var o=e[a][n];e[a][r]=o,delete e[a][n]}return e},removeFields:function(e,t){for(var i=(e=JSON.parse(JSON.stringify(e))).length,n=0;n<i;n++){var r=e[n];for(var a in r)r.hasOwnProperty(a)&&t.includes(a)&&delete e[n][a]}return e},reformatDateFields:function(e,t){for(var i,n=[],r=0;r<e.length;r++){var a=e[r];for(var o in a)a.hasOwnProperty(o)&&t.includes(o)&&(a[o]=(i=a[o])?i.split("-").reverse().join("-"):i);n.push(a)}return n},replaceNullValues:function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i];if("object"==typeof n){for(var r in n)if(n.hasOwnProperty(r)){var a=n[r];null==a||""==a?n[r]="NA":(n[r]=n[r]+"",n[r]=n[r].trim())}t.push(n)}}return t},sortObj:function(e,t){e=JSON.parse(JSON.stringify(e));for(var i=[],n=0;n<e.length;n++){for(var r=e[n],a={},o=0;o<t.length;o++){var s=t[o];a[s]=r[s]}i.push(a)}return i},b64toBlob:function(e,t){for(var i=atob(e),n=[],r=0;r<i.length;r+=512){for(var a=i.slice(r,r+512),o=new Array(a.length),s=0;s<a.length;s++)o[s]=a.charCodeAt(s);var c=new Uint8Array(o);n.push(c)}return new Blob(n,{type:t})}};if(window.interceptPageNavigation=function(){var e=document.getElementsByTagName("a");window.globalWordCount="",document.addEventListener("keypress",function(e){var t=e.which;(97<=parseInt(t)&&parseInt(t)<=122||65<=parseInt(t)&&parseInt(t)<=90||48<=parseInt(t)&&parseInt(t)<=57)&&(window.globalWordCount=t)});for(var t=e.length,i=0;i<t;i++);},window.interceptPageNavigation(),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");!function(e){var t=jQuery.fn.jquery.split(" ")[0].split(".");if(t[0]<2&&t[1]<9||1==t[0]&&9==t[1]&&t[2]<1||3<t[0])throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4")}(),function(n){n.fn.emulateTransitionEnd=function(e){var t=!1,i=this;return n(this).one("bsTransitionEnd",function(){t=!0}),setTimeout(function(){t||n(i).trigger(n.support.transition.end)},e),this},n(function(){n.support.transition=function(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in t)if(void 0!==e.style[i])return{end:t[i]};return!1}(),n.support.transition&&(n.event.special.bsTransitionEnd={bindType:n.support.transition.end,delegateType:n.support.transition.end,handle:function(e){if(n(e.target).is(this))return e.handleObj.handler.apply(this,arguments)}})})}(jQuery),function(a){var t='[data-dismiss="alert"]',o=function(e){a(e).on("click",t,this.close)};o.VERSION="3.4.1",o.TRANSITION_DURATION=150,o.prototype.close=function(e){var t=a(this),i=t.attr("data-target");i||(i=(i=t.attr("href"))&&i.replace(/.*(?=#[^\s]*$)/,"")),i="#"===i?[]:i;var n=a(document).find(i);function r(){n.detach().trigger("closed.bs.alert").remove()}e&&e.preventDefault(),n.length||(n=t.closest(".alert")),n.trigger(e=a.Event("close.bs.alert")),e.isDefaultPrevented()||(n.removeClass("in"),a.support.transition&&n.hasClass("fade")?n.one("bsTransitionEnd",r).emulateTransitionEnd(o.TRANSITION_DURATION):r())};var e=a.fn.alert;a.fn.alert=function(i){return this.each(function(){var e=a(this),t=e.data("bs.alert");t||e.data("bs.alert",t=new o(this)),"string"==typeof i&&t[i].call(e)})},a.fn.alert.Constructor=o,a.fn.alert.noConflict=function(){return a.fn.alert=e,this},a(document).on("click.bs.alert.data-api",t,o.prototype.close)}(jQuery),function(a){var r=function(e,t){this.$element=a(e),this.options=a.extend({},r.DEFAULTS,t),this.isLoading=!1};function i(n){return this.each(function(){var e=a(this),t=e.data("bs.button"),i="object"==typeof n&&n;t||e.data("bs.button",t=new r(this,i)),"toggle"==n?t.toggle():n&&t.setState(n)})}r.VERSION="3.4.1",r.DEFAULTS={loadingText:"loading..."},r.prototype.setState=function(e){var t="disabled",i=this.$element,n=i.is("input")?"val":"html",r=i.data();e+="Text",null==r.resetText&&i.data("resetText",i[n]()),setTimeout(a.proxy(function(){i[n](null==r[e]?this.options[e]:r[e]),"loadingText"==e?(this.isLoading=!0,i.addClass(t).attr(t,t).prop(t,!0)):this.isLoading&&(this.isLoading=!1,i.removeClass(t).removeAttr(t).prop(t,!1))},this),0)},r.prototype.toggle=function(){var e=!0,t=this.$element.closest('[data-toggle="buttons"]');if(t.length){var i=this.$element.find("input");"radio"==i.prop("type")?(i.prop("checked")&&(e=!1),t.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==i.prop("type")&&(i.prop("checked")!==this.$element.hasClass("active")&&(e=!1),this.$element.toggleClass("active")),i.prop("checked",this.$element.hasClass("active")),e&&i.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var e=a.fn.button;a.fn.button=i,a.fn.button.Constructor=r,a.fn.button.noConflict=function(){return a.fn.button=e,this},a(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(e){var t=a(e.target).closest(".btn");i.call(t,"toggle"),a(e.target).is('input[type="radio"], input[type="checkbox"]')||(e.preventDefault(),t.is("input,button")?t.trigger("focus"):t.find("input:visible,button:visible").first().trigger("focus"))}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(e){a(e.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(e.type))})}(jQuery),function(u){var p=function(e,t){this.$element=u(e),this.$indicators=this.$element.find(".carousel-indicators"),this.options=t,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",u.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",u.proxy(this.pause,this)).on("mouseleave.bs.carousel",u.proxy(this.cycle,this))};function s(r){return this.each(function(){var e=u(this),t=e.data("bs.carousel"),i=u.extend({},p.DEFAULTS,e.data(),"object"==typeof r&&r),n="string"==typeof r?r:i.slide;t||e.data("bs.carousel",t=new p(this,i)),"number"==typeof r?t.to(r):n?t[n]():i.interval&&t.pause().cycle()})}p.VERSION="3.4.1",p.TRANSITION_DURATION=600,p.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},p.prototype.keydown=function(e){if(!/input|textarea/i.test(e.target.tagName)){switch(e.which){case 37:this.prev();break;case 39:this.next();break;default:return}e.preventDefault()}},p.prototype.cycle=function(e){return e||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(u.proxy(this.next,this),this.options.interval)),this},p.prototype.getItemIndex=function(e){return this.$items=e.parent().children(".item"),this.$items.index(e||this.$active)},p.prototype.getItemForDirection=function(e,t){var i=this.getItemIndex(t);if(("prev"==e&&0===i||"next"==e&&i==this.$items.length-1)&&!this.options.wrap)return t;var n=(i+("prev"==e?-1:1))%this.$items.length;return this.$items.eq(n)},p.prototype.to=function(e){var t=this,i=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(!(e>this.$items.length-1||e<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){t.to(e)}):i==e?this.pause().cycle():this.slide(i<e?"next":"prev",this.$items.eq(e))},p.prototype.pause=function(e){return e||(this.paused=!0),this.$element.find(".next, .prev").length&&u.support.transition&&(this.$element.trigger(u.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},p.prototype.next=function(){if(!this.sliding)return this.slide("next")},p.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},p.prototype.slide=function(e,t){var i=this.$element.find(".item.active"),n=t||this.getItemForDirection(e,i),r=this.interval,a="next"==e?"left":"right",o=this;if(n.hasClass("active"))return this.sliding=!1;var s=n[0],c=u.Event("slide.bs.carousel",{relatedTarget:s,direction:a});if(this.$element.trigger(c),!c.isDefaultPrevented()){if(this.sliding=!0,r&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var d=u(this.$indicators.children()[this.getItemIndex(n)]);d&&d.addClass("active")}var l=u.Event("slid.bs.carousel",{relatedTarget:s,direction:a});return u.support.transition&&this.$element.hasClass("slide")?(n.addClass(e),"object"==typeof n&&n.length&&n[0].offsetWidth,i.addClass(a),n.addClass(a),i.one("bsTransitionEnd",function(){n.removeClass([e,a].join(" ")).addClass("active"),i.removeClass(["active",a].join(" ")),o.sliding=!1,setTimeout(function(){o.$element.trigger(l)},0)}).emulateTransitionEnd(p.TRANSITION_DURATION)):(i.removeClass("active"),n.addClass("active"),this.sliding=!1,this.$element.trigger(l)),r&&this.cycle(),this}};var e=u.fn.carousel;u.fn.carousel=s,u.fn.carousel.Constructor=p,u.fn.carousel.noConflict=function(){return u.fn.carousel=e,this};var t=function(e){var t=u(this),i=t.attr("href");i&&(i=i.replace(/.*(?=#[^\s]+$)/,""));var n=t.attr("data-target")||i,r=u(document).find(n);if(r.hasClass("carousel")){var a=u.extend({},r.data(),t.data()),o=t.attr("data-slide-to");o&&(a.interval=!1),s.call(r,a),o&&r.data("bs.carousel").to(o),e.preventDefault()}};u(document).on("click.bs.carousel.data-api","[data-slide]",t).on("click.bs.carousel.data-api","[data-slide-to]",t),u(window).on("load",function(){u('[data-ride="carousel"]').each(function(){var e=u(this);s.call(e,e.data())})})}(jQuery),function(o){var s=function(e,t){this.$element=o(e),this.options=o.extend({},s.DEFAULTS,t),this.$trigger=o('[data-toggle="collapse"][href="#'+e.id+'"],[data-toggle="collapse"][data-target="#'+e.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};function r(e){var t,i=e.attr("data-target")||(t=e.attr("href"))&&t.replace(/.*(?=#[^\s]+$)/,"");return o(document).find(i)}function c(n){return this.each(function(){var e=o(this),t=e.data("bs.collapse"),i=o.extend({},s.DEFAULTS,e.data(),"object"==typeof n&&n);!t&&i.toggle&&/show|hide/.test(n)&&(i.toggle=!1),t||e.data("bs.collapse",t=new s(this,i)),"string"==typeof n&&t[n]()})}s.VERSION="3.4.1",s.TRANSITION_DURATION=350,s.DEFAULTS={toggle:!0},s.prototype.dimension=function(){return this.$element.hasClass("width")?"width":"height"},s.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var e,t=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(t&&t.length&&(e=t.data("bs.collapse"))&&e.transitioning)){var i=o.Event("show.bs.collapse");if(this.$element.trigger(i),!i.isDefaultPrevented()){t&&t.length&&(c.call(t,"hide"),e||t.data("bs.collapse",null));var n=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[n](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var r=function(){this.$element.removeClass("collapsing").addClass("collapse in")[n](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!o.support.transition)return r.call(this);var a=o.camelCase(["scroll",n].join("-"));this.$element.one("bsTransitionEnd",o.proxy(r,this)).emulateTransitionEnd(s.TRANSITION_DURATION)[n](this.$element[0][a])}}}},s.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var e=o.Event("hide.bs.collapse");if(this.$element.trigger(e),!e.isDefaultPrevented()){var t=this.dimension();this.$element[t](this.$element[t]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var i=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};if(!o.support.transition)return i.call(this);this.$element[t](0).one("bsTransitionEnd",o.proxy(i,this)).emulateTransitionEnd(s.TRANSITION_DURATION)}}},s.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},s.prototype.getParent=function(){return o(document).find(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(o.proxy(function(e,t){var i=o(t);this.addAriaAndCollapsedClass(r(i),i)},this)).end()},s.prototype.addAriaAndCollapsedClass=function(e,t){var i=e.hasClass("in");e.attr("aria-expanded",i),t.toggleClass("collapsed",!i).attr("aria-expanded",i)};var e=o.fn.collapse;o.fn.collapse=c,o.fn.collapse.Constructor=s,o.fn.collapse.noConflict=function(){return o.fn.collapse=e,this},o(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(e){var t=o(this);t.attr("data-target")||e.preventDefault();var i=r(t),n=i.data("bs.collapse")?"toggle":t.data();c.call(i,n)})}(jQuery),function(o){var s='[data-toggle="dropdown"]',n=function(e){o(e).on("click.bs.dropdown",this.toggle)};function c(e){var t=e.attr("data-target");t||(t=(t=e.attr("href"))&&/#[A-Za-z]/.test(t)&&t.replace(/.*(?=#[^\s]*$)/,""));var i="#"!==t?o(document).find(t):null;return i&&i.length?i:e.parent()}function a(n){n&&3===n.which||(o(".dropdown-backdrop").remove(),o(s).each(function(){var e=o(this),t=c(e),i={relatedTarget:this};t.hasClass("open")&&(n&&"click"==n.type&&/input|textarea/i.test(n.target.tagName)&&o.contains(t[0],n.target)||(t.trigger(n=o.Event("hide.bs.dropdown",i)),n.isDefaultPrevented()||(e.attr("aria-expanded","false"),t.removeClass("open").trigger(o.Event("hidden.bs.dropdown",i)))))}))}n.VERSION="3.4.1",n.prototype.toggle=function(e){var t=o(this);if(!t.is(".disabled, :disabled")){var i=c(t),n=i.hasClass("open");if(a(),!n){"ontouchstart"in document.documentElement&&!i.closest(".navbar-nav").length&&o(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(o(this)).on("click",a);var r={relatedTarget:this};if(i.trigger(e=o.Event("show.bs.dropdown",r)),e.isDefaultPrevented())return;t.trigger("focus").attr("aria-expanded","true"),i.toggleClass("open").trigger(o.Event("shown.bs.dropdown",r))}return!1}},n.prototype.keydown=function(e){if(/(38|40|27|32)/.test(e.which)&&!/input|textarea/i.test(e.target.tagName)){var t=o(this);if(e.preventDefault(),e.stopPropagation(),!t.is(".disabled, :disabled")){var i=c(t),n=i.hasClass("open");if(!n&&27!=e.which||n&&27==e.which)return 27==e.which&&i.find(s).trigger("focus"),t.trigger("click");var r=i.find(".dropdown-menu li:not(.disabled):visible a");if(r.length){var a=r.index(e.target);38==e.which&&0<a&&a--,40==e.which&&a<r.length-1&&a++,~a||(a=0),r.eq(a).trigger("focus")}}}};var e=o.fn.dropdown;o.fn.dropdown=function(i){return this.each(function(){var e=o(this),t=e.data("bs.dropdown");t||e.data("bs.dropdown",t=new n(this)),"string"==typeof i&&t[i].call(e)})},o.fn.dropdown.Constructor=n,o.fn.dropdown.noConflict=function(){return o.fn.dropdown=e,this},o(document).on("click.bs.dropdown.data-api",a).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",s,n.prototype.toggle).on("keydown.bs.dropdown.data-api",s,n.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",n.prototype.keydown)}(jQuery),function(o){var a=function(e,t){this.options=t,this.$body=o(document.body),this.$element=o(e),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.fixedContent=".navbar-fixed-top, .navbar-fixed-bottom",this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,o.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};function s(n,r){return this.each(function(){var e=o(this),t=e.data("bs.modal"),i=o.extend({},a.DEFAULTS,e.data(),"object"==typeof n&&n);t||e.data("bs.modal",t=new a(this,i)),"string"==typeof n?t[n](r):i.show&&t.show(r)})}a.VERSION="3.4.1",a.TRANSITION_DURATION=300,a.BACKDROP_TRANSITION_DURATION=150,a.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},a.prototype.toggle=function(e){return this.isShown?this.hide():this.show(e)},a.prototype.show=function(i){var n=this,e=o.Event("show.bs.modal",{relatedTarget:i});this.$element.trigger(e),this.isShown||e.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',o.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){n.$element.one("mouseup.dismiss.bs.modal",function(e){o(e.target).is(n.$element)&&(n.ignoreBackdropClick=!0)})}),this.backdrop(function(){var e=o.support.transition&&n.$element.hasClass("fade");n.$element.parent().length||n.$element.appendTo(n.$body),n.$element.show().scrollTop(0),n.adjustDialog(),e&&n.$element[0].offsetWidth,n.$element.addClass("in"),n.enforceFocus();var t=o.Event("shown.bs.modal",{relatedTarget:i});e?n.$dialog.one("bsTransitionEnd",function(){n.$element.trigger("focus").trigger(t)}).emulateTransitionEnd(a.TRANSITION_DURATION):n.$element.trigger("focus").trigger(t)}))},a.prototype.hide=function(e){e&&e.preventDefault(),e=o.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),o(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),o.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",o.proxy(this.hideModal,this)).emulateTransitionEnd(a.TRANSITION_DURATION):this.hideModal())},a.prototype.enforceFocus=function(){o(document).off("focusin.bs.modal").on("focusin.bs.modal",o.proxy(function(e){document===e.target||this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.trigger("focus")},this))},a.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",o.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},a.prototype.resize=function(){this.isShown?o(window).on("resize.bs.modal",o.proxy(this.handleUpdate,this)):o(window).off("resize.bs.modal")},a.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.$body.removeClass("modal-open"),e.resetAdjustments(),e.resetScrollbar(),e.$element.trigger("hidden.bs.modal")})},a.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},a.prototype.backdrop=function(e){var t=this,i=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var n=o.support.transition&&i;if(this.$backdrop=o(document.createElement("div")).addClass("modal-backdrop "+i).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",o.proxy(function(e){this.ignoreBackdropClick?this.ignoreBackdropClick=!1:e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide())},this)),n&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!e)return;n?this.$backdrop.one("bsTransitionEnd",e).emulateTransitionEnd(a.BACKDROP_TRANSITION_DURATION):e()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var r=function(){t.removeBackdrop(),e&&e()};o.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",r).emulateTransitionEnd(a.BACKDROP_TRANSITION_DURATION):r()}else e&&e()},a.prototype.handleUpdate=function(){this.adjustDialog()},a.prototype.adjustDialog=function(){var e=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&e?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!e?this.scrollbarWidth:""})},a.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},a.prototype.checkScrollbar=function(){var e=window.innerWidth;if(!e){var t=document.documentElement.getBoundingClientRect();e=t.right-Math.abs(t.left)}this.bodyIsOverflowing=document.body.clientWidth<e,this.scrollbarWidth=this.measureScrollbar()},a.prototype.setScrollbar=function(){var e=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"";var r=this.scrollbarWidth;this.bodyIsOverflowing&&(this.$body.css("padding-right",e+r),o(this.fixedContent).each(function(e,t){var i=t.style.paddingRight,n=o(t).css("padding-right");o(t).data("padding-right",i).css("padding-right",parseFloat(n)+r+"px")}))},a.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad),o(this.fixedContent).each(function(e,t){var i=o(t).data("padding-right");o(t).removeData("padding-right"),t.style.paddingRight=i||""})},a.prototype.measureScrollbar=function(){var e=document.createElement("div");e.className="modal-scrollbar-measure",this.$body.append(e);var t=e.offsetWidth-e.clientWidth;return this.$body[0].removeChild(e),t};var e=o.fn.modal;o.fn.modal=s,o.fn.modal.Constructor=a,o.fn.modal.noConflict=function(){return o.fn.modal=e,this},o(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(e){var t=o(this),i=t.attr("href"),n=t.attr("data-target")||i&&i.replace(/.*(?=#[^\s]+$)/,""),r=o(document).find(n),a=r.data("bs.modal")?"toggle":o.extend({remote:!/#/.test(i)&&i},r.data(),t.data());t.is("a")&&e.preventDefault(),r.one("show.bs.modal",function(e){e.isDefaultPrevented()||r.one("hidden.bs.modal",function(){t.is(":visible")&&t.trigger("focus")})}),s.call(r,a,this)})}(jQuery),function(h){var n=["sanitize","whiteList","sanitizeFn"],o=["background","cite","href","itemtype","longdesc","poster","src","xlink:href"],s=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,c=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+/]+=*$/i;function f(e,t){var i=e.nodeName.toLowerCase();if(-1!==h.inArray(i,t))return-1===h.inArray(i,o)||Boolean(e.nodeValue.match(s)||e.nodeValue.match(c));for(var n=h(t).filter(function(e,t){return t instanceof RegExp}),r=0,a=n.length;r<a;r++)if(i.match(n[r]))return!0;return!1}function r(e,t,i){if(0===e.length)return e;if(i&&"function"==typeof i)return i(e);if(!document.implementation||!document.implementation.createHTMLDocument)return e;var n=document.implementation.createHTMLDocument("sanitization");n.body.innerHTML=e;for(var r=h.map(t,function(e,t){return t}),a=h(n.body).find("*"),o=0,s=a.length;o<s;o++){var c=a[o],d=c.nodeName.toLowerCase();if(-1!==h.inArray(d,r))for(var l=h.map(c.attributes,function(e){return e}),u=[].concat(t["*"]||[],t[d]||[]),p=0,m=l.length;p<m;p++)f(l[p],u)||c.removeAttribute(l[p].nodeName);else c.parentNode.removeChild(c)}return n.body.innerHTML}var g=function(e,t){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",e,t)};g.VERSION="3.4.1",g.TRANSITION_DURATION=150,g.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0},sanitize:!0,sanitizeFn:null,whiteList:{"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]}},g.prototype.init=function(e,t,i){if(this.enabled=!0,this.type=e,this.$element=h(t),this.options=this.getOptions(i),this.$viewport=this.options.viewport&&h(document).find(h.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var n=this.options.trigger.split(" "),r=n.length;r--;){var a=n[r];if("click"==a)this.$element.on("click."+this.type,this.options.selector,h.proxy(this.toggle,this));else if("manual"!=a){var o="hover"==a?"mouseenter":"focusin",s="hover"==a?"mouseleave":"focusout";this.$element.on(o+"."+this.type,this.options.selector,h.proxy(this.enter,this)),this.$element.on(s+"."+this.type,this.options.selector,h.proxy(this.leave,this))}}this.options.selector?this._options=h.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},g.prototype.getDefaults=function(){return g.DEFAULTS},g.prototype.getOptions=function(e){var t=this.$element.data();for(var i in t)t.hasOwnProperty(i)&&-1!==h.inArray(i,n)&&delete t[i];return(e=h.extend({},this.getDefaults(),t,e)).delay&&"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),e.sanitize&&(e.template=r(e.template,e.whiteList,e.sanitizeFn)),e},g.prototype.getDelegateOptions=function(){var i={},n=this.getDefaults();return this._options&&h.each(this._options,function(e,t){n[e]!=t&&(i[e]=t)}),i},g.prototype.enter=function(e){var t=e instanceof this.constructor?e:h(e.currentTarget).data("bs."+this.type);if(t||(t=new this.constructor(e.currentTarget,this.getDelegateOptions()),h(e.currentTarget).data("bs."+this.type,t)),e instanceof h.Event&&(t.inState["focusin"==e.type?"focus":"hover"]=!0),t.tip().hasClass("in")||"in"==t.hoverState)t.hoverState="in";else{if(clearTimeout(t.timeout),t.hoverState="in",!t.options.delay||!t.options.delay.show)return t.show();t.timeout=setTimeout(function(){"in"==t.hoverState&&t.show()},t.options.delay.show)}},g.prototype.isInStateTrue=function(){for(var e in this.inState)if(this.inState[e])return!0;return!1},g.prototype.leave=function(e){var t=e instanceof this.constructor?e:h(e.currentTarget).data("bs."+this.type);if(t||(t=new this.constructor(e.currentTarget,this.getDelegateOptions()),h(e.currentTarget).data("bs."+this.type,t)),e instanceof h.Event&&(t.inState["focusout"==e.type?"focus":"hover"]=!1),!t.isInStateTrue()){if(clearTimeout(t.timeout),t.hoverState="out",!t.options.delay||!t.options.delay.hide)return t.hide();t.timeout=setTimeout(function(){"out"==t.hoverState&&t.hide()},t.options.delay.hide)}},g.prototype.show=function(){var e=h.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);var t=h.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!t)return;var i=this,n=this.tip(),r=this.getUID(this.type);this.setContent(),n.attr("id",r),this.$element.attr("aria-describedby",r),this.options.animation&&n.addClass("fade");var a="function"==typeof this.options.placement?this.options.placement.call(this,n[0],this.$element[0]):this.options.placement,o=/\s?auto?\s?/i,s=o.test(a);s&&(a=a.replace(o,"")||"top"),n.detach().css({top:0,left:0,display:"block"}).addClass(a).data("bs."+this.type,this),this.options.container?n.appendTo(h(document).find(this.options.container)):n.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var c=this.getPosition(),d=n[0].offsetWidth,l=n[0].offsetHeight;if(s){var u=a,p=this.getPosition(this.$viewport);a="bottom"==a&&c.bottom+l>p.bottom?"top":"top"==a&&c.top-l<p.top?"bottom":"right"==a&&c.right+d>p.width?"left":"left"==a&&c.left-d<p.left?"right":a,n.removeClass(u).addClass(a)}var m=this.getCalculatedOffset(a,c,d,l);this.applyPlacement(m,a);var f=function(){var e=i.hoverState;i.$element.trigger("shown.bs."+i.type),i.hoverState=null,"out"==e&&i.leave(i)};h.support.transition&&this.$tip.hasClass("fade")?n.one("bsTransitionEnd",f).emulateTransitionEnd(g.TRANSITION_DURATION):f()}},g.prototype.applyPlacement=function(e,t){var i=this.tip(),n=i[0].offsetWidth,r=i[0].offsetHeight,a=parseInt(i.css("margin-top"),10),o=parseInt(i.css("margin-left"),10);isNaN(a)&&(a=0),isNaN(o)&&(o=0),e.top+=a,e.left+=o,h.offset.setOffset(i[0],h.extend({using:function(e){i.css({top:Math.round(e.top),left:Math.round(e.left)})}},e),0),i.addClass("in");var s=i[0].offsetWidth,c=i[0].offsetHeight;"top"==t&&c!=r&&(e.top=e.top+r-c);var d=this.getViewportAdjustedDelta(t,e,s,c);d.left?e.left+=d.left:e.top+=d.top;var l=/top|bottom/.test(t),u=l?2*d.left-n+s:2*d.top-r+c,p=l?"offsetWidth":"offsetHeight";i.offset(e),this.replaceArrow(u,i[0][p],l)},g.prototype.replaceArrow=function(e,t,i){this.arrow().css(i?"left":"top",50*(1-e/t)+"%").css(i?"top":"left","")},g.prototype.setContent=function(){var e=this.tip(),t=this.getTitle();this.options.html?(this.options.sanitize&&(t=r(t,this.options.whiteList,this.options.sanitizeFn)),e.find(".tooltip-inner").html(t)):e.find(".tooltip-inner").text(t),e.removeClass("fade in top bottom left right")},g.prototype.hide=function(e){var t=this,i=h(this.$tip),n=h.Event("hide.bs."+this.type);function r(){"in"!=t.hoverState&&i.detach(),t.$element&&t.$element.removeAttr("aria-describedby").trigger("hidden.bs."+t.type),e&&e()}if(this.$element.trigger(n),!n.isDefaultPrevented())return i.removeClass("in"),h.support.transition&&i.hasClass("fade")?i.one("bsTransitionEnd",r).emulateTransitionEnd(g.TRANSITION_DURATION):r(),this.hoverState=null,this},g.prototype.fixTitle=function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},g.prototype.hasContent=function(){return this.getTitle()},g.prototype.getPosition=function(e){var t=(e=e||this.$element)[0],i="BODY"==t.tagName,n=t.getBoundingClientRect();null==n.width&&(n=h.extend({},n,{width:n.right-n.left,height:n.bottom-n.top}));var r=window.SVGElement&&t instanceof window.SVGElement,a=i?{top:0,left:0}:r?null:e.offset(),o={scroll:i?document.documentElement.scrollTop||document.body.scrollTop:e.scrollTop()},s=i?{width:h(window).width(),height:h(window).height()}:null;return h.extend({},n,o,s,a)},g.prototype.getCalculatedOffset=function(e,t,i,n){return"bottom"==e?{top:t.top+t.height,left:t.left+t.width/2-i/2}:"top"==e?{top:t.top-n,left:t.left+t.width/2-i/2}:"left"==e?{top:t.top+t.height/2-n/2,left:t.left-i}:{top:t.top+t.height/2-n/2,left:t.left+t.width}},g.prototype.getViewportAdjustedDelta=function(e,t,i,n){var r={top:0,left:0};if(!this.$viewport)return r;var a=this.options.viewport&&this.options.viewport.padding||0,o=this.getPosition(this.$viewport);if(/right|left/.test(e)){var s=t.top-a-o.scroll,c=t.top+a-o.scroll+n;s<o.top?r.top=o.top-s:c>o.top+o.height&&(r.top=o.top+o.height-c)}else{var d=t.left-a,l=t.left+a+i;d<o.left?r.left=o.left-d:l>o.right&&(r.left=o.left+o.width-l)}return r},g.prototype.getTitle=function(){var e=this.$element,t=this.options;return e.attr("data-original-title")||("function"==typeof t.title?t.title.call(e[0]):t.title)},g.prototype.getUID=function(e){for(;e+=~~(1e6*Math.random()),document.getElementById(e););return e},g.prototype.tip=function(){if(!this.$tip&&(this.$tip=h(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},g.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},g.prototype.enable=function(){this.enabled=!0},g.prototype.disable=function(){this.enabled=!1},g.prototype.toggleEnabled=function(){this.enabled=!this.enabled},g.prototype.toggle=function(e){var t=this;e&&((t=h(e.currentTarget).data("bs."+this.type))||(t=new this.constructor(e.currentTarget,this.getDelegateOptions()),h(e.currentTarget).data("bs."+this.type,t))),e?(t.inState.click=!t.inState.click,t.isInStateTrue()?t.enter(t):t.leave(t)):t.tip().hasClass("in")?t.leave(t):t.enter(t)},g.prototype.destroy=function(){var e=this;clearTimeout(this.timeout),this.hide(function(){e.$element.off("."+e.type).removeData("bs."+e.type),e.$tip&&e.$tip.detach(),e.$tip=null,e.$arrow=null,e.$viewport=null,e.$element=null})},g.prototype.sanitizeHtml=function(e){return r(e,this.options.whiteList,this.options.sanitizeFn)};var e=h.fn.tooltip;h.fn.tooltip=function(n){return this.each(function(){var e=h(this),t=e.data("bs.tooltip"),i="object"==typeof n&&n;!t&&/destroy|hide/.test(n)||(t||e.data("bs.tooltip",t=new g(this,i)),"string"==typeof n&&t[n]())})},h.fn.tooltip.Constructor=g,h.fn.tooltip.noConflict=function(){return h.fn.tooltip=e,this}}(jQuery),function(r){var a=function(e,t){this.init("popover",e,t)};if(!r.fn.tooltip)throw new Error("Popover requires tooltip.js");a.VERSION="3.4.1",a.DEFAULTS=r.extend({},r.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),((a.prototype=r.extend({},r.fn.tooltip.Constructor.prototype)).constructor=a).prototype.getDefaults=function(){return a.DEFAULTS},a.prototype.setContent=function(){var e=this.tip(),t=this.getTitle(),i=this.getContent();if(this.options.html){var n=typeof i;this.options.sanitize&&(t=this.sanitizeHtml(t),"string"==n&&(i=this.sanitizeHtml(i))),e.find(".popover-title").html(t),e.find(".popover-content").children().detach().end()["string"==n?"html":"append"](i)}else e.find(".popover-title").text(t),e.find(".popover-content").children().detach().end().text(i);e.removeClass("fade top bottom left right in"),e.find(".popover-title").html()||e.find(".popover-title").hide()},a.prototype.hasContent=function(){return this.getTitle()||this.getContent()},a.prototype.getContent=function(){var e=this.$element,t=this.options;return e.attr("data-content")||("function"==typeof t.content?t.content.call(e[0]):t.content)},a.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var e=r.fn.popover;r.fn.popover=function(n){return this.each(function(){var e=r(this),t=e.data("bs.popover"),i="object"==typeof n&&n;!t&&/destroy|hide/.test(n)||(t||e.data("bs.popover",t=new a(this,i)),"string"==typeof n&&t[n]())})},r.fn.popover.Constructor=a,r.fn.popover.noConflict=function(){return r.fn.popover=e,this}}(jQuery),function(a){function r(e,t){this.$body=a(document.body),this.$scrollElement=a(e).is(document.body)?a(window):a(e),this.options=a.extend({},r.DEFAULTS,t),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",a.proxy(this.process,this)),this.refresh(),this.process()}function t(n){return this.each(function(){var e=a(this),t=e.data("bs.scrollspy"),i="object"==typeof n&&n;t||e.data("bs.scrollspy",t=new r(this,i)),"string"==typeof n&&t[n]()})}r.VERSION="3.4.1",r.DEFAULTS={offset:10},r.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},r.prototype.refresh=function(){var e=this,n="offset",r=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),a.isWindow(this.$scrollElement[0])||(n="position",r=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var e=a(this),t=e.data("target")||e.attr("href"),i=/^#./.test(t)&&a(t);return i&&i.length&&i.is(":visible")&&[[i[n]().top+r,t]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){e.offsets.push(this[0]),e.targets.push(this[1])})},r.prototype.process=function(){var e,t=this.$scrollElement.scrollTop()+this.options.offset,i=this.getScrollHeight(),n=this.options.offset+i-this.$scrollElement.height(),r=this.offsets,a=this.targets,o=this.activeTarget;if(this.scrollHeight!=i&&this.refresh(),n<=t)return o!=(e=a[a.length-1])&&this.activate(e);if(o&&t<r[0])return this.activeTarget=null,this.clear();for(e=r.length;e--;)o!=a[e]&&t>=r[e]&&(void 0===r[e+1]||t<r[e+1])&&this.activate(a[e])},r.prototype.activate=function(e){this.activeTarget=e,this.clear();var t=this.selector+'[data-target="'+e+'"],'+this.selector+'[href="'+e+'"]',i=a(t).parents("li").addClass("active");i.parent(".dropdown-menu").length&&(i=i.closest("li.dropdown").addClass("active")),i.trigger("activate.bs.scrollspy")},r.prototype.clear=function(){a(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var e=a.fn.scrollspy;a.fn.scrollspy=t,a.fn.scrollspy.Constructor=r,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=e,this},a(window).on("load.bs.scrollspy.data-api",function(){a('[data-spy="scroll"]').each(function(){var e=a(this);t.call(e,e.data())})})}(jQuery),function(s){var o=function(e){this.element=s(e)};function t(i){return this.each(function(){var e=s(this),t=e.data("bs.tab");t||e.data("bs.tab",t=new o(this)),"string"==typeof i&&t[i]()})}o.VERSION="3.4.1",o.TRANSITION_DURATION=150,o.prototype.show=function(){var e=this.element,t=e.closest("ul:not(.dropdown-menu)"),i=e.data("target");if(i||(i=(i=e.attr("href"))&&i.replace(/.*(?=#[^\s]*$)/,"")),!e.parent("li").hasClass("active")){var n=t.find(".active:last a"),r=s.Event("hide.bs.tab",{relatedTarget:e[0]}),a=s.Event("show.bs.tab",{relatedTarget:n[0]});if(n.trigger(r),e.trigger(a),!a.isDefaultPrevented()&&!r.isDefaultPrevented()){var o=s(document).find(i);this.activate(e.closest("li"),t),this.activate(o,o.parent(),function(){n.trigger({type:"hidden.bs.tab",relatedTarget:e[0]}),e.trigger({type:"shown.bs.tab",relatedTarget:n[0]})})}}},o.prototype.activate=function(e,t,i){var n=t.find("> .active"),r=i&&s.support.transition&&(n.length&&n.hasClass("fade")||!!t.find("> .fade").length);function a(){n.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),e.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),r?(e[0].offsetWidth,e.addClass("in")):e.removeClass("fade"),e.parent(".dropdown-menu").length&&e.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),i&&i()}n.length&&r?n.one("bsTransitionEnd",a).emulateTransitionEnd(o.TRANSITION_DURATION):a(),n.removeClass("in")};var e=s.fn.tab;s.fn.tab=t,s.fn.tab.Constructor=o,s.fn.tab.noConflict=function(){return s.fn.tab=e,this};var i=function(e){e.preventDefault(),t.call(s(this),"show")};s(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',i).on("click.bs.tab.data-api",'[data-toggle="pill"]',i)}(jQuery),function(c){var d=function(e,t){this.options=c.extend({},d.DEFAULTS,t);var i=this.options.target===d.DEFAULTS.target?c(this.options.target):c(document).find(this.options.target);this.$target=i.on("scroll.bs.affix.data-api",c.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",c.proxy(this.checkPositionWithEventLoop,this)),this.$element=c(e),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};function i(n){return this.each(function(){var e=c(this),t=e.data("bs.affix"),i="object"==typeof n&&n;t||e.data("bs.affix",t=new d(this,i)),"string"==typeof n&&t[n]()})}d.VERSION="3.4.1",d.RESET="affix affix-top affix-bottom",d.DEFAULTS={offset:0,target:window},d.prototype.getState=function(e,t,i,n){var r=this.$target.scrollTop(),a=this.$element.offset(),o=this.$target.height();if(null!=i&&"top"==this.affixed)return r<i&&"top";if("bottom"==this.affixed)return null!=i?!(r+this.unpin<=a.top)&&"bottom":!(r+o<=e-n)&&"bottom";var s=null==this.affixed,c=s?r:a.top;return null!=i&&r<=i?"top":null!=n&&e-n<=c+(s?o:t)&&"bottom"},d.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(d.RESET).addClass("affix");var e=this.$target.scrollTop(),t=this.$element.offset();return this.pinnedOffset=t.top-e},d.prototype.checkPositionWithEventLoop=function(){setTimeout(c.proxy(this.checkPosition,this),1)},d.prototype.checkPosition=function(){if(this.$element.is(":visible")){var e=this.$element.height(),t=this.options.offset,i=t.top,n=t.bottom,r=Math.max(c(document).height(),c(document.body).height());"object"!=typeof t&&(n=i=t),"function"==typeof i&&(i=t.top(this.$element)),"function"==typeof n&&(n=t.bottom(this.$element));var a=this.getState(r,e,i,n);if(this.affixed!=a){null!=this.unpin&&this.$element.css("top","");var o="affix"+(a?"-"+a:""),s=c.Event(o+".bs.affix");if(this.$element.trigger(s),s.isDefaultPrevented())return;this.affixed=a,this.unpin="bottom"==a?this.getPinnedOffset():null,this.$element.removeClass(d.RESET).addClass(o).trigger(o.replace("affix","affixed")+".bs.affix")}"bottom"==a&&this.$element.offset({top:r-e-n})}};var e=c.fn.affix;c.fn.affix=i,c.fn.affix.Constructor=d,c.fn.affix.noConflict=function(){return c.fn.affix=e,this},c(window).on("load",function(){c('[data-spy="affix"]').each(function(){var e=c(this),t=e.data();t.offset=t.offset||{},null!=t.offsetBottom&&(t.offset.bottom=t.offsetBottom),null!=t.offsetTop&&(t.offset.top=t.offsetTop),i.call(e,t)})})}(jQuery);
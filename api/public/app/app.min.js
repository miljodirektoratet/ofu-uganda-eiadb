// Generated with grunt. Do not edit!

"use strict";function convertDateStringsToDates(a){if("object"!=typeof a)return a;for(var b in a)if(a.hasOwnProperty(b)){var c,d=a[b];if("string"==typeof d&&(c=d.match(regexIso8601))){var e=c[0].replace(" ","T");e+="Z",a[b]=new Date(e)}else"object"==typeof d&&convertDateStringsToDates(d)}}function addDays(a,b){var c=new Date(a);return c.setDate(c.getDate()+b),c}function updateEiaPermitStatus(a,b){var c=a.status,d=null;if(a.date_cancelled)d=37;else if(a.certificate_no)d=36;else if(a.fee_receipt_no)d=35;else if(a.date_fee_notification)d=34;else if(a.date_decision)d=33;else if(a.date_sent_ded_approval)d=32;else{var e=_.groupBy(b,function(a){return a.type}),f=0,g=[13,10,9,8],h={13:{conclusion:59,date_dispatched:58,date_sent_officer:57,date_sent_from_dep:56,date_sent_director:55,date_submitted:54},10:{date_dispatched:31,date_sent_officer:30,date_sent_from_dep:29,date_sent_director:28,date_submitted:27},9:{conclusion:26,date_dispatched:25,date_sent_officer:24,date_sent_from_dep:23,date_sent_director:22,date_submitted:21},8:{conclusion:20,date_dispatched:19,date_sent_officer:18,date_sent_from_dep:17,date_sent_director:16,date_submitted:15}};_.forEach(g,function(a){var b=e[a];if(b){var c=0;return _.forEach(b,function(b){b.conclusion&&_.includes([78,79],b.conclusion)&&h[a].conclusion?c=h[a].conclusion:b.date_sent_officer?c=h[a].date_sent_officer:b.date_sent_from_dep?c=h[a].date_sent_from_dep:b.date_sent_director?c=h[a].date_sent_director:b.date_submitted&&(c=h[a].date_submitted),c>f&&(f=c)}),!1}}),f>0&&(d=f)}return c!=d?(a.status=d,!0):!1}function isNumberInRange(a,b,c){return null!==a&&a>c?!1:null!==b&&c>b?!1:!0}angular.$=angular.element,angular.$.prototype.parent=function(a){if(!a)return angular.$(this[0].parentNode);for(var b,c=[].slice.call(document.querySelectorAll(a)),d=this[0];"HTML"!==d.nodeName;){d=d.parentNode;var e=c.indexOf(d);-1===e||(b=d,d=document.documentElement)}return angular.$(b)};var debug=!0;angular.module("seroApp.services",[]),angular.module("seroApp.directives",[]),angular.module("seroApp.controllers",[]),angular.module("pax.validations",[]);var seroApp=angular.module("seroApp",["ngRoute","ngResource","ngAnimate","ngMessages","ngSanitize","ui.bootstrap","ui.select2","ngFileUpload","ui.grid","ui.grid.edit","ui.grid.rowEdit","ui.grid.cellNav","ui.grid.resizeColumns","ui.grid.moveColumns","ui.grid.selection","seroApp.services","seroApp.directives","seroApp.controllers","pax.validations"]).config(["$routeProvider",function(a){var b={templateUrl:"partials/projectTabs.html",controller:"ProjectTabsController"};a.when("/",{templateUrl:"partials/home.html",controller:"HomeController"}),a.when("/projects",{templateUrl:"partials/projects.html",controller:"ProjectsController"}),a.when("/projects/:projectId",b),a.when("/projects/:projectId/eiaspermits",b),a.when("/projects/:projectId/eiaspermits/:eiapermitId",b),a.when("/projects/:projectId/eiaspermits/:eiapermitId/documents",b),a.when("/projects/:projectId/eiaspermits/:eiapermitId/documents/:documentId",b),a.when("/projects/:projectId/eiaspermits/:eiapermitId/documents/:documentId/hearings",b),a.when("/projects/:projectId/eiaspermits/:eiapermitId/documents/:documentId/hearings/:hearingId",b),a.when("/projects/:projectId/externalaudits",b),a.when("/projects/:projectId/externalaudits/:externalauditId",b),a.when("/projects/:projectId/externalaudits/:externalauditId/documents",b),a.when("/projects/:projectId/externalaudits/:externalauditId/documents/:documentId",b),a.when("/projects/:projectId/auditsinspections",b),a.when("/projects/:projectId/auditsinspections/:auditinspectionId",b),a.when("/projects/:projectId/permitslicenses",b),a.when("/projects/:projectId/permitslicenses/:permitlicenseId",b);var c={templateUrl:"partials/searchTabs.html",controller:"SearchTabsController"};a.when("/search",{redirectTo:"/search/projects"}),a.when("/search/projects",c),a.when("/search/eiaspermits",c),a.when("/search/permitslicenses",c),a.when("/search/auditsinspections",c),a.when("/search/externalaudits",c);var d={templateUrl:"partials/statisticsTabs.html",controller:"StatisticsTabsController"};a.when("/statistics",{redirectTo:"/statistics/projects"}),a.when("/statistics/projects",d),a.when("/advanced/codes",{templateUrl:"partials/advancedCodes.html",controller:"AdvancedCodesController"}),a.when("/advanced/users",{templateUrl:"partials/advancedUsers.html",controller:"AdvancedUsersController"}),a.when("/advanced/leadagencies",{templateUrl:"partials/advancedLeadAgency.html",controller:"AdvancedLeadAgenciesController"}),a.when("/pirking",{templateUrl:"partials/pirking.html",controller:"PirkingController"}),a.when("/about",{templateUrl:"partials/about.html"}),a.when("/login",{templateUrl:"partials/login.html",controller:"UserController"}),a.when("/password/send",{templateUrl:"partials/passwordSend.html",controller:"LoginController"}),a.when("/password/reset/:token",{templateUrl:"partials/passwordReset.html",controller:"LoginController"}),a.when("/user",{templateUrl:"partials/user.html",controller:"UserController"}),a.when("/practitioners",{templateUrl:"partials/practitioners.html",controller:"PractitionersController"}),a.otherwise({redirectTo:"/"})}]).factory("authHttpResponseInterceptor",["$q","$location",function(a,b){return{responseError:function(c){return 0==b.path().indexOf("/password/reset/")||401===c.status&&b.path("/login"),a.reject(c)}}}]).config(["$httpProvider",function(a){a.interceptors.push("authHttpResponseInterceptor")}]),SavingStateEnum={None:"None",LoadingNew:"Loading new",Loading:"Loading",Loaded:"Loaded",SavingStarted:"Saving started",SavingFinished:"Saving finished",SavingFailed:"Saving failed",Invalid:"Form not valid",MissingDependency:"Missing dependency in other form"},ProjectTabEnum={Project:"Project",EiasPermits:"EIAS",PermitsLicenses:"Permits and Licenses",AuditsInspections:"Audits and Inspections",ExternalAudits:"External audits"},EiasPermitsTabEnum={EiaPermit:"EIA",Documents:"Documents",Hearings:"Hearings"},ExternalAuditsTabEnum={ExternalAudit:"External audit",Documents:"Documents",Hearings:"Hearings"},SearchTabEnum={Projects:"Projects",EiasPermits:"EIAS",PermitsLicenses:"Permits and Licenses",AuditsInspections:"Audits and Inspections",ExternalAudits:"External audits"},StatisticsTabEnum={Projects:"Projects",EiasPermits:"EIAS",AuditsInspections:"Audits and Inspections"},DocumentTagEnum={PermitLicenseApplicationForm:"Application form",PermitLicensePermitLicense:"Permit or license",PermitLicenseAttachments:"Attachment to the application"},fileUploadPattern="image/*,application/pdf,application/vnd.openxmlformats*,application/msword,text/plain,text/csv,application/octet-stream,binary/octet-stream",fileUploadNgfPattern="'image/*,application/pdf,application/vnd.openxmlformats*,application/msword,text/plain,text/csv,application/octet-stream,binary/octet-stream'",fileUploadMaxSize="20MB",regexIso8601=/^(\d{4}-\d{2}-\d{2} \d{2}\:\d{2}\:\d{2})$/;seroApp.config(["$httpProvider",function(a){a.defaults.transformResponse.push(function(a){return convertDateStringsToDates(a),a})}]);var uploadFile=function(a,b,c,d,e,f){d.$setValidity("serverError",!0);var g=a.defer();return e&&!e.$error?(e.upload=c.upload({url:"/file/v1/upload",file:e,fields:{tag:f}}),e.upload.then(function(a){b(function(){e.result=a.data,g.resolve(e)})},function(a){a.status>0&&(d.$setValidity("serverError",!1),e.progress=0,e.error=a.status+": "+a.data.message,g.reject(e.error))}),e.upload.progress(function(a){e.progress=Math.min(100,parseInt(100*a.loaded/a.total))})):g.reject("Validation error."),g.promise},controllers=angular.module("seroApp.controllers");controllers.controller("DatePickerController",["$scope",function(a){a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.datepickerOptions={startingDay:1}}]),controllers.controller("DatePickerSearchController",["$scope",function(a){a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.datepickerOptions={startingDay:1}}]),controllers.controller("NavBarController",["$scope","$location","UserInfo",function(a,b,c){a.userinfo=c,a.isActive=function(a){return a===b.path()},a.isAdvancedActive=function(a){return 0==b.path().indexOf(a)}}]),controllers.controller("HomeController",["$scope","GeneralStatistics",function(a,b){a.counts={},b.get({},function(b){a.counts=b.counts})}]),controllers.controller("UserController",["$scope","UserInfo",function(a,b){a.userinfo=b,a.userid_to_impersonate=null,a.impersonate=function(){a.userinfo.impersonate(a.userid_to_impersonate)}}]),controllers.controller("PirkingController",["$scope","$http","EiaPermit","Document","Valuelists","$q",function(a,b,c,d,e,f){a.lastId="..",a.criteria={},a.dryrun=!0,a.eiaspermits=[],a.working=!1,a.info={error:0,nochange:0,changed:0,finished:function(){return this.error+this.nochange+this.changed},progress:function(){return 0==a.eiaspermits.length?0:Math.round(100*this.finished()/a.eiaspermits.length)}},a.beginPirking=function(){a.info.error=0,a.info.nochange=0,a.info.changed=0,console.log("beginPirking"),console.log("dryrun:",a.dryrun),a.working=!0,b({method:"GET",url:"/pirking/v1/eiaspermits",params:a.criteria}).then(function(b){a.eiaspermits=b.data,console.log("beginPirking finished"),a.beginUpdate()},function(){console.log("oh noes")})};var g=function(a){var b=_.find(e.eiastatus,{id:a});return b?b.description1:""};a.beginUpdate=function(){function b(b){b.updating=!0;var e={projectId:b.project_id,eiapermitId:b.eiapermit_id},h=c.get(e).$promise,i=d.query(e).$promise,j=f.defer();return f.all([h,i]).then(function(c){var d=c[0],f=c[1],h=updateEiaPermitStatus(d,f);b.status_id_new=d.status,b.status_description_new=g(d.status),h?a.dryrun?(b.changed=!0,b.result="CHANGED",a.info.changed+=1,b.updating=!1,j.resolve()):(d.pirking=!0,d.$update(e,function(c){b.changed=!0,b.result="CHANGED",a.info.changed+=1,b.updating=!1,b.eiapermit_updated_at=c.updated_at,j.resolve()})):(b.nochange=!0,b.result="NO CHANGE",a.info.nochange+=1,b.updating=!1,j.resolve())},function(){b.updating=!1,b.error=!0,b.result="ERROR",a.info.error+=1,j.reject("Server Error")}),j.promise}function e(a){return a.reduce(function(a,c){return a.then(function(){return b(c)})["catch"](function(a){console.log("ERROR:",a)})},f.when())}console.log("beginUpdate"),e(a.eiaspermits).then(function(){console.log("beginUpdate finished"),a.working=!1})}}]),controllers.controller("PractitionersController",["$scope","$filter","$animate","UserInfo","Practitioner","Valuelists",function(a,b,c,d,e,f){function g(a){}a.certificateYearMin=2e3,a.certificateYearMax=(new Date).getFullYear()+1,a.certificateYearValid=(new Date).getFullYear(),a.current=null,a.currentForm=null,a.userinfo=d,a.valuelists=f,a.practitioners=e.query();var h=function(a,c,d,e){if(!a)return!1;var f=function(a){return a.cert_type!=c?!1:a.year!==d?!1:e>0&&a.conditions!=e?!1:a.is_deleted?!1:a.is_cancelled?!1:!0};return b("filter")(a,f,!0).length>0};a.hasEiaTL=function(b){var c=h(b.practitioner_certificates,50,a.certificateYearValid,38);return b.cert_eia=c?"eia":null,c},a.hasEiaTM=function(b){var c=h(b.practitioner_certificates,50,a.certificateYearValid,39);return b.cert_eia=c?"eia":null,c},a.hasAuditTL=function(b){var c=h(b.practitioner_certificates,51,a.certificateYearValid,38);return b.cert_au=c?"audit":null,c},a.hasAuditTM=function(b){var c=h(b.practitioner_certificates,51,a.certificateYearValid,39);return b.cert_au=c?"audit":null,c},a.hasPartnershipEia=function(b){var c=h(b.practitioner_certificates,52,a.certificateYearValid,53);return b.cert_ep=c?"partnership":null,c},a.hasPartnershipEa=function(b){var c=h(b.practitioner_certificates,52,a.certificateYearValid,97);return b.cert_ep=c?"partnership":null,c},a.newPractitioner=function(){if(a.currentForm&&a.currentForm.$invalid)return void alert("Current form not valid. Can't create new practitioner.");var b={practitioner_certificates:[],is_new:!0},c=new e(b);a.practitioners.unshift(c),a.toggleRow(c)},a.deletePractitioner=function(b,c){a.current=null,c.is_new||c.$delete(),a.practitioners.splice(b,1)},a.deleteCertificate=function(b,c,d){d.is_new?c.practitioner_certificates.splice(b,1):(d.is_deleted=!0,a.currentForm.$setDirty())},a.newCertificate=function(b){var c={year:a.certificateYearValid,date_of_entry:new Date,is_new:!0};c.cert_no=a.certificateNumber(c),b.practitioner_certificates.unshift(c)},a.calculateCertificateNumber=function(b){b.cert_no=a.certificateNumber(b)},a.canSave=function(){return a.userinfo.info.role_6};var i=function(b){a.canSave()&&(b.is_new?b.$save({},function(a){g(a),j()}):b.$update({},function(a){g(a),j()}))};a.toggleRow=function(b){if(!a.loading){if(a.canSave()&&a.current){var c=a.current,d=a.currentForm;if(d.$invalid)return void alert("Form not valid. Can't save.");d.$dirty&&(i(c),d.$setPristine())}a.current==b?a.current=null:b.is_new?a.current=b:(a.loading=b,b.$get({},function(c){g(c),a.loading=null,a.current=b}))}},a.setCurrentForm=function(b){a.currentForm=b},a.certificateNumber=function(b){var c="E",d=_.find(a.valuelists.practitionertype,{id:+b.cert_type});d&&(c=d.description1);var e=b.number?("00"+b.number).slice(-3):"000",f=b.year?b.year.toString().substr(2):"00",g="CC/"+c+"/"+e+"/"+f;return g},a.changeNumericBoolean=function(a){return 0===a?1:0};var j=function(){};a.practitionerOrderBy=function(a){var b=a.person.trim().substring(a.person.trim().lastIndexOf(" "));return b}}]);var testy1="x";controllers.controller("ProjectsController",["$scope","$location","$filter","Project","UserInfo",function(a,b,c,d,e){a.showFilter=!1,a.projects=d.query({count:50}),a.projectsCount=0,d.query({countOnly:1},function(b){a.projectsCount=b[0]}),a.userinfo=e,a["goto"]=function(a){b.path(a)},a.canSave=function(){return a.userinfo.info.role_1},a.getAllProjects=function(){a.projects=d.query(),a.showFilter=!0}}]),controllers.controller("ProjectTabsController",["$scope","$routeParams","$location","$q","$timeout","ProjectFactory","UserInfo","Valuelists",function(a,b,c,d,e,f,g,h){a.SavingStateEnum=SavingStateEnum,a.ProjectTabEnum=ProjectTabEnum,a.routeParams=b,a.userinfo=g,a.valuelists=h,a.data=f;var i=function(a){return _.contains(a,"eiaspermits")?ProjectTabEnum.EiasPermits:_.contains(a,"auditsinspections")?ProjectTabEnum.AuditsInspections:_.contains(a,"externalaudits")?ProjectTabEnum.ExternalAudits:_.contains(a,"permitslicenses")?ProjectTabEnum.PermitsLicenses:ProjectTabEnum.Project};a.tab=i(c.path()),a["goto"]=function(a){e(function(){c.path(a)})},a.auth={},a.auth.canSave=function(){return!1},a.saveCurrent=function(b,c,e){if(e="undefined"!=typeof e?e:!1,b.saveInProgress&&b.isNew){var g=d.defer();return g.reject(),g.promise}b.saveInProgress=!0;var g=d.defer();if(b.form.$pristine&&!e)b.saveInProgress=!1,g.reject();else if(!b.form.$invalid||b.isNew&&e){b.state=b.isNew?SavingStateEnum.LoadingNew:SavingStateEnum.SavingStarted;var h=a.routeParams;e&&(h=_.omit(h,"auditinspectionId"),h=_.omit(h,"eiapermitId"),h=_.omit(h,"externalauditId")),f.save(h,c).then(function(a){_.isUndefined(b.form)||(b.state=b.isNew?SavingStateEnum.LoadingNew:SavingStateEnum.SavingFinished,b.form.$setPristine(),b.saveInProgress=!1,g.resolve(a))},function(a){console&&console.log("Error on server:",a),b.state=SavingStateEnum.SavingFailed,b.saveInProgress=!1})}else b.state=SavingStateEnum.Invalid,b.saveInProgress=!1,g.reject();return g.promise}}]),controllers.controller("ProjectController",["$scope","$q","ProjectFactory","Organisation","$timeout",function(a,b,c,d,e){if(a.selectOrganisationMode=!1,a.isNewProject=!1,a.parts={project:{form:null,state:SavingStateEnum.Loading},organisation:{form:null,state:SavingStateEnum.Loading}},a.newProjectExisitingOrganisation=function(b){a.selectOrganisationMode=!1,c.setOrganisation(b).then(function(){a.parts.organisation.state=SavingStateEnum.Loaded}),c.project.id>0?(c.project.organisation_id=b.id,e(function(){a.saveCurrentProject(!0)})):c.createNewProject(b),a.parts.project.state=SavingStateEnum.Loaded},a.newProjectNewOganisation=function(){a.selectOrganisationMode=!1,c.createNewOrganisation(),c.project.id>0||c.createNewProject(a.data.organisation),a.parts.project.state=SavingStateEnum.Loaded,a.parts.organisation.state=SavingStateEnum.Loaded,a.parts.organisation.isNew=!0},a.saveCurrentProject=function(b){if(b="undefined"!=typeof b?b:!1,a.isNewProject)return void a.saveNewProjectAndNewOrganisation();var c=a.data.project;a.saveCurrent(a.parts.project,c,b).then(function(){})},a.saveCurrentOrganisation=function(){if(a.isNewProject)return void a.saveNewProjectAndNewOrganisation();var b=a.data.project,c=a.data.organisation;a.saveCurrent(a.parts.organisation,c).then(function(c){c.id!==b.organisation_id&&(b.organisation_id=c.id,a.saveCurrentProject(!0))})},a.saveNewProjectAndNewOrganisation=function(){var b=a.parts.project,c=a.parts.organisation;if(b.form.$invalid)return a.parts.project.state=SavingStateEnum.Invalid,void(c.form.$dirty&&(a.parts.organisation.state=SavingStateEnum.MissingDependency));if(b.form.$valid&&c.form.$invalid)return a.parts.project.state=SavingStateEnum.MissingDependency,void(a.parts.organisation.state=SavingStateEnum.Invalid);if(b.form.$valid&&c.form.$valid){var d=a.data.project,e=a.data.organisation;c.form.$pristine?(d.organisation_id=e.id,a.saveCurrent(b,d).then(function(b){a["goto"]("/projects/"+b.id)})):a.saveCurrent(c,e).then(function(c){d.organisation_id=c.id,a.saveCurrent(b,d).then(function(b){a["goto"]("/projects/"+b.id)})})}},a.auth.canSave=function(b){switch(b){case"has_industrial_waste_water":return a.userinfo.info.role_3;default:return a.userinfo.info.role_1}},a.auth.canDelete=function(){return a.isNewProject?!1:a.parts.project.state==SavingStateEnum.Loading?!1:a.data.eiaspermits.length>0||a.data.auditsinspections.length>0?!1:a.auth.canSave()},a.deleteProject=function(){c.deleteProject(a.routeParams).then(function(){a["goto"]("/projects")})},a.changeDeveloper=function(){a.selectOrganisationMode=!0,a.organisations=d.query()},a.checkInputForGoogleMaps=function(b){var c=b.$viewValue;if(c&&-1!==c.indexOf(", ")){var d=c.split(", "),e=d[0],f=d[1];a.data.project.latitude=e,a.data.project.longitude=f}},"new"==a.routeParams.projectId)a.selectOrganisationMode=!0,a.isNewProject=!0,a.parts.project.isNew=!0,c.empty(),a.organisations=d.query();else{var f=c.retrieveProjectData(a.routeParams);f[0].then(function(){a.parts.project.state=SavingStateEnum.Loaded}),f[1].then(function(){a.parts.organisation.state=SavingStateEnum.Loaded})}}]),controllers.controller("EiasPermitsTabsController",["$scope","$location","ProjectFactory",function(a,b,c){a.fileUploadPattern=fileUploadPattern,a.fileUploadNgfPattern=fileUploadNgfPattern,a.fileUploadMaxSize=fileUploadMaxSize,a.EiasPermitsTabEnum=EiasPermitsTabEnum,a.parts={eiapermits:{state:SavingStateEnum.None},eiapermit:{form:null,state:SavingStateEnum.None},documents:{state:SavingStateEnum.None},document:{form:null,state:SavingStateEnum.None},hearings:{state:SavingStateEnum.None},hearing:{form:null,state:SavingStateEnum.None}};var d=function(a){return _.contains(a,"hearings")?EiasPermitsTabEnum.Hearings:_.contains(a,"documents")?EiasPermitsTabEnum.Documents:EiasPermitsTabEnum.EiaPermit};a.eptab=d(b.path()),a.preventClickIfDisabled=function(a,b){a&&b.preventDefault()},a.stopPropagation=function(a){a.stopPropagation()},a.openEiapermit=function(b){a.routeParams.eiapermitId==b?a["goto"]("/projects/"+a.data.project.id+"/eiaspermits"):a.routeParams.eiapermitId||a["goto"]("/projects/"+a.data.project.id+"/eiaspermits/"+b)},a.openEiapermitDocument=function(b){a.routeParams.documentId==b?a["goto"]("/projects/"+a.data.project.id+"/eiaspermits/"+a.data.eiapermit.id+"/documents"):a.routeParams.documentId||a["goto"]("/projects/"+a.data.project.id+"/eiaspermits/"+a.data.eiapermit.id+"/documents/"+b)},a.openEiapermitDocumentHearing=function(b){a.routeParams.hearingId==b?a["goto"]("/projects/"+a.data.project.id+"/eiaspermits/"+a.data.eiapermit.id+"/documents/"+a.data.document.id+"/hearings"):a.routeParams.hearingId||a["goto"]("/projects/"+a.data.project.id+"/eiaspermits/"+a.data.eiapermit.id+"/documents/"+a.data.document.id+"/hearings/"+b)},a.isDocumentsDisabled=function(b){return a.isDisabled(b)?!0:a.parts.documents.state==SavingStateEnum.Loading?!0:!1},a.isHearingsDisabled=function(b){return a.isDisabled(b)?!0:a.parts.hearings.state==SavingStateEnum.Loading?!0:!1},a.isDisabled=function(a){return _.isUndefined(a)},a.downloadFileUrl=function(a){return"/file/v1/download/"+a},a.updateStatus=function(b){var c=updateEiaPermitStatus(b,a.data.documents);return c&&a.parts.eiapermit.form&&a.parts.eiapermit.form.$setDirty(),c},a.loadEiaPermitWithDocuments=function(){a.parts.eiapermit.state=SavingStateEnum.Loading,a.parts.documents.state=SavingStateEnum.Loading;var b=c.retrieveEiaPermit(a.routeParams);b[0].then(function(){a.parts.eiapermit.state=SavingStateEnum.Loaded}),b[1].then(function(){a.parts.documents.state=SavingStateEnum.Loaded})},a.parts.eiapermits.state=SavingStateEnum.Loading;var e=c.retrieveProjectData(a.routeParams);e[2].then(function(){a.parts.eiapermits.state=SavingStateEnum.Loaded,_.isUndefined(a.routeParams.eiapermitId)||a.loadEiaPermitWithDocuments()})}]),controllers.controller("EiasPermitsController",["$scope","ProjectFactory","$timeout","Upload","$q","$location",function(a,b,c,d,e){a.showUploadingCertificate=!1,a.shouldShowEiaPermit=function(b){return a.parts.eiapermit.state==SavingStateEnum.Loading?!1:a.routeParams.eiapermitId==b.id?!0:!1},a.saveCurrentEiaPermit=function(b){var c=b.is_new;c||a.updateStatus(b),a.saveCurrent(a.parts.eiapermit,b,c).then(function(b){c&&a["goto"]("/projects/"+a.data.project.id+"/eiaspermits/"+b.id)})},a.newEiaPermit=function(){a.parts.eiapermit.state=SavingStateEnum.LoadingNew,b.createNewEiaPermit(a.data.project)},a.deleteEiaPermit=function(){b.deleteEiaPermit(a.routeParams),a["goto"]("/projects/"+a.data.project.id+"/eiaspermits")},a.uploadCertificate=function(b){if(b){a.showUploadingCertificate=!0,a.certificateFile=b[0];var f=uploadFile(e,c,d,a.parts.eiapermit.form.certificate,a.certificateFile);f.then(function(b){a.data.eiapermit.file_metadata_id=b.result.id,a.parts.eiapermit.form.certificate.$setDirty(),a.saveCurrentEiaPermit(a.data.eiapermit)},function(){})}},a.deleteCertificate=function(){a.showUploadingCertificate=!1,a.data.eiapermit.file_metadata_id=null,a.parts.eiapermit.form.certificate.$setDirty(),a.saveCurrentEiaPermit(a.data.eiapermit)},a.criteriaMatchOfficer1=function(a){return function(b){return b.passive&&a?b.id===a:b.passive===!1}},a.criteriaMatchOfficer=function(a){return function(b){if(b.passive&&a)for(var c=0;c<a.length;c++){var d=a[c];return b.id===d}return b.passive===!1}},a.auth.canSave=function(b){if(a.data.eiapermit.is_new&&a.parts.eiapermit.state==SavingStateEnum.SavingStarted)return!1;switch(b){case"new":case"delete":return a.userinfo.info.role_1;case"teamleader_id":case"practitioner_id":case"cost":case"cost_currency":case"expected_jobs_created":return a.userinfo.info.role_1;case"personnel":return a.userinfo.info.role_2;case"inspection_recommended":case"date_inspection":case"officer_recommend":case"fee":case"fee_currency":case"remarks":return a.userinfo.info.role_3;case"date_fee_notification":case"date_fee_payed":case"fee_receipt_no":return a.userinfo.info.role_4;case"decision":case"date_decision":case"designation":case"date_certificate":case"certificate_no":case"date_cancelled":case"user_id":case"date_sent_ded_approval":return a.userinfo.info.role_5;case"status":return!1;default:return!1}}}]),controllers.controller("EiasPermitsDocumentsController",["$scope","ProjectFactory","$timeout","Upload","$q","$location","EiaPermitSearchService",function(a,b,c,d,e,f,g){a.shouldShowDocument=function(b){return a.parts.document.state==SavingStateEnum.Loading?!1:a.routeParams.documentId==b.id?!0:!1},a.moveButton={},a.moveDocument=function(){a.moveButton.error="",g.search({eiapermit_id:a.moveButton.id}).then(function(c){if(c.length>=1){var d=c[0].project_id,e=c[0].eiapermit_id,f=a.data.document.id;b.moveDocument(a.routeParams,a.moveButton.id).then(function(){a.updateStatusBasedOnDocument(),a["goto"]("/projects/"+d+"/eiaspermits/"+e+"/documents/"+f)})}else a.moveButton.error="Not a valid EIA ID."})},a.updateStatusBasedOnDocument=function(){a.updateStatus(a.data.eiapermit)&&a.data.eiapermit.$update(a.routeParams,function(){},function(){})},a.saveCurrentDocument=function(b){var c=b.is_new;a.saveCurrent(a.parts.document,b).then(function(b){a.updateStatusBasedOnDocument(),c&&a["goto"]("/projects/"+a.data.project.id+"/eiaspermits/"+a.data.eiapermit.id+"/documents/"+b.id)})},a.newDocument=function(){a.parts.document.state=SavingStateEnum.LoadingNew,b.createNewDocument(a.data.eiapermit)},a.deleteDocument=function(){b.deleteDocument(a.routeParams).then(function(){a.updateStatusBasedOnDocument(),a["goto"]("/projects/"+a.data.project.id+"/eiaspermits/"+a.data.eiapermit.id+"/documents")})},a.uploadAttachment=function(b){if(b){a.showUploadingAttachment=!0,a.attachmentFile=b[0];var f=uploadFile(e,c,d,a.parts.document.form.attachment,a.attachmentFile);f.then(function(b){a.data.document.file_metadata_id=b.result.id,a.parts.document.form.attachment.$setDirty(),a.saveCurrentDocument(a.data.document)},function(){})}},a.uploadResponseDocument=function(b){if(b){a.showUploadingResponseDocument=!0,a.responseDocumentFile=b[0];var f=uploadFile(e,c,d,a.parts.document.form.response_document,a.responseDocumentFile);f.then(function(b){a.data.document.file_metadata_response_id=b.result.id,a.parts.document.form.response_document.$setDirty(),a.saveCurrentDocument(a.data.document)},function(){})}},a.deleteAttachment=function(){a.showUploadingAttachment=!1,a.data.document.file_metadata_id=null,a.parts.document.form.attachment.$setDirty(),a.saveCurrentDocument(a.data.document)},a.deleteResponseDocument=function(){a.showUploadingResponseDocument=!1,a.data.document.file_metadata_response_id=null,a.parts.document.form.response_document.$setDirty(),a.saveCurrentDocument(a.data.document)},a.calculateNumberOfCopiesOfDocument=function(){a.data.document.director_copy_no=1,a.data.document.coordinator_copy_no=a.data.document.sub_copy_no-1},a.calculateDocumentCode=function(){var b=_.find(a.valuelists.documenttype,{id:parseInt(a.data.document.type)}),c=b?b.description1:"",d=a.data.document.number?a.data.document.number:"";a.data.document.code=c+d},a.setDefaultDocumentConclusion=function(){a.data.document.conclusion=_.indexOf(["8","9"],a.data.document.type)>=0?80:81},a.isDisabledBasedOnRule=function(b){switch(b){case"document.conclusion":return 81==a.data.document.conclusion;default:return!1}},a.auth.canSave=function(b){if(a.data.document.is_new&&a.parts.document.state==SavingStateEnum.SavingStarted)return!1;switch(b){case"new":case"delete":return a.userinfo.info.role_1;case"document.date_submitted":case"document.sub_copy_no":case"document.title":case"document.type":case"document.number":case"document.code":case"document.consultent":case"document.director_copy_no":case"document.date_sent_director":case"document.coordinator_copy_no":case"document.date_copies_coordinator":case"document.date_next_appointment":case"document.folio_no":return a.userinfo.info.role_1;case"document.date_sent_officer":return a.userinfo.info.role_2;case"document.file_metadata_response_id":case"document.conclusion":case"document.date_conclusion":case"document.remarks":case"document.remarks_director":case"document.remarks_team_leader":return a.userinfo.info.role_3;case"document.date_sent_from_dep":return a.userinfo.info.role_5;case"move":return a.userinfo.info.role_8;default:return!1}},a.loadDocumentWithHearings=function(){a.parts.document.state=SavingStateEnum.Loading,a.parts.hearings.state=SavingStateEnum.Loading;var c=b.retrieveDocument(a.routeParams);c[0].then(function(){a.parts.document.state=SavingStateEnum.Loaded}),c[1].then(function(){a.parts.hearings.state=SavingStateEnum.Loaded})},a.parts.document==SavingStateEnum.Loading;var h=b.retrieveProjectData(a.routeParams);h[2].then(function(){var c=b.retrieveEiaPermit(a.routeParams);c[1].then(function(){a.parts.documents.state=SavingStateEnum.Loaded,_.isUndefined(a.routeParams.documentId)||a.loadDocumentWithHearings()})})}]),controllers.controller("EiasPermitsHearingsController",["$scope","ProjectFactory","$timeout","Upload","$q","$location",function(a,b,c,d,e){a.shouldShowHearing=function(b){return a.parts.hearing.state==SavingStateEnum.Loading?!1:a.routeParams.hearingId==b.id?!0:!1},a.saveCurrentHearing=function(b){var c=b.is_new;a.saveCurrent(a.parts.hearing,b).then(function(b){c&&a["goto"]("/projects/"+a.data.project.id+"/eiaspermits/"+a.data.eiapermit.id+"/documents/"+a.data.document.id+"/hearings/"+b.id)})},a.newHearing=function(){a.parts.hearing.state=SavingStateEnum.LoadingNew,b.createNewHearing(a.data.document)},a.deleteHearing=function(){b.deleteHearing(a.routeParams).then(function(){a["goto"]("/projects/"+a.data.project.id+"/eiaspermits/"+a.data.eiapermit.id+"/documents/"+a.data.document.id)})},a.uploadAttachment=function(b){if(b){a.showUploadingAttachment=!0,a.attachmentFile=b[0];var f=uploadFile(e,c,d,a.parts.hearing.form.attachment,a.attachmentFile);f.then(function(b){a.data.hearing.file_metadata_id=b.result.id,a.parts.hearing.form.attachment.$setDirty(),a.saveCurrentHearing(a.data.hearing)},function(){})}},a.deleteAttachment=function(){a.showUploadingAttachment=!1,a.data.hearing.file_metadata_id=null,a.parts.hearing.form.attachment.$setDirty(),a.saveCurrentHearing(a.data.hearing)},a.isDisabledBasedOnRule=function(b){switch(b){case"hearing.district_id":return 7!=a.data.hearing.lead_agency&&8!=a.data.hearing.lead_agency?(a.data.hearing.district_id=null,!0):!1;default:return!1}},a.auth.canSave=function(b){if(a.data.hearing.is_new&&a.parts.hearing.state==SavingStateEnum.SavingStarted)return!1;switch(b){case"new":case"delete":return a.userinfo.info.role_1;case"hearing.date_dispatched":return a.userinfo.info.role_1;case"hearing.lead_agency":return a.userinfo.info.role_1;case"hearing.district_id":return a.userinfo.info.role_1;case"hearing.date_expected":return a.userinfo.info.role_1;case"hearing.date_received":return a.userinfo.info.role_1;case"hearing.recommendations":return a.userinfo.info.role_1;case"hearing.document_id":return a.userinfo.info.role_1;case"hearing.remarks":return a.userinfo.info.role_3;default:return!1}},a.loadHearing=function(){a.parts.hearing.state=SavingStateEnum.Loading;var c=b.retrieveHearing(a.routeParams);c[0].then(function(){a.parts.hearing.state=SavingStateEnum.Loaded})},a.loadDocumentWithHearings=function(){a.parts.document.state=SavingStateEnum.Loading,a.parts.hearings.state=SavingStateEnum.Loading;var c=b.retrieveDocument(a.routeParams);c[0].then(function(){a.parts.document.state=SavingStateEnum.Loaded}),c[1].then(function(){a.parts.hearings.state=SavingStateEnum.Loaded,_.isUndefined(a.routeParams.hearingId)||a.loadHearing()})};var f=b.retrieveProjectData(a.routeParams);f[2].then(function(){var c=b.retrieveEiaPermit(a.routeParams);c[1].then(function(){a.parts.documents.state=SavingStateEnum.Loaded,_.isUndefined(a.routeParams.documentId)||a.loadDocumentWithHearings()})})}]),controllers.controller("ExternalAuditsTabsController",["$scope","$location","ProjectFactory",function(a,b,c){a.fileUploadPattern=fileUploadPattern,a.fileUploadNgfPattern=fileUploadNgfPattern,a.fileUploadMaxSize=fileUploadMaxSize,a.ExternalAuditsTabEnum=ExternalAuditsTabEnum,a.parts={externalaudits:{state:SavingStateEnum.None},externalaudit:{form:null,state:SavingStateEnum.None},documents:{state:SavingStateEnum.None},document:{form:null,state:SavingStateEnum.None},hearings:{state:SavingStateEnum.None},hearing:{form:null,state:SavingStateEnum.None}};var d=function(a){return _.contains(a,"hearings")?EiasPermitsTabEnum.Hearings:_.contains(a,"documents")?ExternalAuditsTabEnum.Documents:ExternalAuditsTabEnum.ExternalAudit};a.eatab=d(b.path()),a.openExternalaudit=function(b){a.routeParams.externalauditId==b?a["goto"]("/projects/"+a.data.project.id+"/externalaudits"):a.routeParams.externalauditId||a["goto"]("/projects/"+a.data.project.id+"/externalaudits/"+b);

},a.openExternalauditDocument=function(b){a.routeParams.documentId==b?a["goto"]("/projects/"+a.data.project.id+"/externalaudits/"+a.data.externalaudit.id+"/documents"):a.routeParams.documentId||a["goto"]("/projects/"+a.data.project.id+"/externalaudits/"+a.data.externalaudit.id+"/documents/"+b)},a.preventClickIfDisabled=function(a,b){a&&b.preventDefault()},a.stopPropagation=function(a){a.stopPropagation()},a.isDocumentsDisabled=function(b){return a.isDisabled(b)?!0:a.parts.documents.state==SavingStateEnum.Loading?!0:!1},a.isHearingsDisabled=function(b){return a.isDisabled(b)?!0:a.parts.hearings.state==SavingStateEnum.Loading?!0:!1},a.isDisabled=function(a){return _.isUndefined(a)},a.downloadFileUrl=function(a){return"/file/v1/download/"+a},a.updateStatus=function(){},a.loadExternalAuditWithDocuments=function(){a.parts.externalaudit.state=SavingStateEnum.Loading,a.parts.documents.state=SavingStateEnum.Loading;var b=c.retrieveExternalAudit(a.routeParams);b[0].then(function(){a.parts.externalaudit.state=SavingStateEnum.Loaded}),b[1].then(function(){a.parts.documents.state=SavingStateEnum.Loaded})},a.parts.externalaudits.state=SavingStateEnum.Loading;var e=c.retrieveProjectData(a.routeParams);e[5].then(function(){a.parts.externalaudits.state=SavingStateEnum.Loaded,_.isUndefined(a.routeParams.externalauditId)||a.loadExternalAuditWithDocuments()})}]),controllers.controller("ExternalAuditsController",["$scope","ProjectFactory","$timeout","Upload","$q","$location",function(a,b,c,d,e){a.showUploadingResponseDocument=!1,a.shouldShowExternalAudit=function(b){return a.parts.externalaudit.state==SavingStateEnum.Loading?!1:a.routeParams.externalauditId==b.id?!0:!1},a.saveCurrentExternalAudit=function(b){var c=b.is_new;c||a.updateStatus(b),a.saveCurrent(a.parts.externalaudit,b,c).then(function(b){c&&a["goto"]("/projects/"+a.data.project.id+"/externalaudits/"+b.id)})},a.newExternalAudit=function(){a.parts.externalaudit.state=SavingStateEnum.LoadingNew,b.createNewExternalAudit(a.data.project)},a.deleteExternalAudit=function(){b.deleteExternalAudit(a.routeParams),a["goto"]("/projects/"+a.data.project.id+"/externalaudits")},a.uploadResponseDocument=function(b){if(b){a.showUploadingResponseDocument=!0,a.responseDocumentFile=b[0];var f=uploadFile(e,c,d,a.parts.externalaudit.form.response_document,a.responseDocumentFile);f.then(function(b){a.data.externalaudit.file_metadata_response_id=b.result.id,a.parts.externalaudit.form.response_document.$setDirty(),a.saveCurrentExternalAudit(a.data.externalaudit)},function(){})}},a.deleteResponseDocument=function(){a.showUploadingResponseDocument=!1,a.data.externalaudit.file_metadata_response_id=null,a.parts.externalaudit.form.response_document.$setDirty(),a.saveCurrentExternalAudit(a.data.externalaudit)},a.criteriaMatchOfficer1=function(a){return function(b){return b.passive&&a?b.id===a:b.passive===!1}},a.criteriaMatchOfficer=function(a){return function(b){if(b.passive&&a)for(var c=0;c<a.length;c++){var d=a[c];return b.id===d}return b.passive===!1}},a.auth.canSave=function(b){if(a.data.externalaudit.is_new&&a.parts.externalaudit.state==SavingStateEnum.SavingStarted)return!1;switch(b){case"new":case"delete":return a.userinfo.info.role_1;case"teamleader_id":case"practitioner_id":case"type":return a.userinfo.info.role_1;case"personnel":return a.userinfo.info.role_2;case"verification_inspection":case"date_inspection":case"date_response":case"fee":case"fee_currency":case"remarks":return a.userinfo.info.role_3;case"response":case"review_findings":case"date_deadline_compliance":case"user_id":return a.userinfo.info.role_5;case"status":return!1;default:return!1}}}]),controllers.controller("ExternalAuditsDocumentsController",["$scope","ProjectFactory","$timeout","Upload","$q","$location","ExternalAuditSearchService",function(a,b,c,d,e,f,g){a.shouldShowDocument=function(b){return a.parts.document.state==SavingStateEnum.Loading?!1:a.routeParams.documentId==b.id?!0:!1},a.moveButton={},a.moveDocument=function(){a.moveButton.error="",g.search({externalaudit_id:a.moveButton.id}).then(function(c){if(c.length>=1){var d=c[0].project_id,e=c[0].externalaudit_id,f=a.data.document_ea.id;b.moveDocumentEA(a.routeParams,a.moveButton.id).then(function(){a.updateStatusBasedOnDocument(),a["goto"]("/projects/"+d+"/externalaudits/"+e+"/documents/"+f)})}else a.moveButton.error="Not a valid EA ID."})},a.updateStatusBasedOnDocument=function(){a.updateStatus(a.data.externalaudit)&&a.data.externalaudit.$update(a.routeParams,function(){},function(){})},a.saveCurrentDocument=function(b){var c=b.is_new;a.saveCurrent(a.parts.document,b).then(function(b){a.updateStatusBasedOnDocument(),c&&a["goto"]("/projects/"+a.data.project.id+"/externalaudits/"+a.data.externalaudit.id+"/documents/"+b.id)})},a.newDocument=function(){a.parts.document.state=SavingStateEnum.LoadingNew,b.createNewDocumentEA(a.data.externalaudit)},a.deleteDocument=function(){b.deleteDocumentEA(a.routeParams).then(function(){a.updateStatusBasedOnDocument(),a["goto"]("/projects/"+a.data.project.id+"/externalaudits/"+a.data.externalaudit.id+"/documents")})},a.uploadAttachment=function(b){if(b){a.showUploadingAttachment=!0,a.attachmentFile=b[0];var f=uploadFile(e,c,d,a.parts.document.form.attachment,a.attachmentFile);f.then(function(b){a.data.document_ea.file_metadata_id=b.result.id,a.parts.document.form.attachment.$setDirty(),a.saveCurrentDocument(a.data.document_ea)},function(){})}},a.uploadResponseDocument=function(b){if(b){a.showUploadingResponseDocument=!0,a.responseDocumentFile=b[0];var f=uploadFile(e,c,d,a.parts.document.form.response_document,a.responseDocumentFile);f.then(function(b){a.data.document_ea.file_metadata_response_id=b.result.id,a.parts.document.form.response_document.$setDirty(),a.saveCurrentDocument(a.data.document_ea)},function(){})}},a.deleteAttachment=function(){a.showUploadingAttachment=!1,a.data.document_ea.file_metadata_id=null,a.parts.document.form.attachment.$setDirty(),a.saveCurrentDocument(a.data.document_ea)},a.deleteResponseDocument=function(){a.showUploadingResponseDocument=!1,a.data.document_ea.file_metadata_response_id=null,a.parts.document.form.response_document.$setDirty(),a.saveCurrentDocument(a.data.document_ea)},a.calculateNumberOfCopiesOfDocument=function(){a.data.document_ea.director_copy_no=1,a.data.document_ea.coordinator_copy_no=a.data.document_ea.sub_copy_no-1},a.calculateDocumentCode=function(){var b=_.find(a.valuelists.documenttypeexternalaudits,{id:parseInt(a.data.document_ea.type)}),c=b?b.description1:"",d=a.data.document_ea.number?a.data.document_ea.number:"";a.data.document_ea.code=c+d},a.setDefaultDocumentConclusion=function(){a.data.document_ea.conclusion=_.indexOf(["11"],a.data.document_ea.type)>=0?80:81},a.isDisabledBasedOnRule=function(b){switch(b){case"document.conclusion":return 81==a.data.document_ea.conclusion;default:return!1}},a.auth.canSave=function(b){if(a.data.document_ea.is_new&&a.parts.document.state==SavingStateEnum.SavingStarted)return!1;switch(b){case"new":case"delete":return a.userinfo.info.role_1;case"document.date_submitted":case"document.sub_copy_no":case"document.title":case"document.type":case"document.number":case"document.code":case"document.consultent":case"document.director_copy_no":case"document.date_sent_director":case"document.coordinator_copy_no":case"document.date_copies_coordinator":case"document.date_next_appointment":case"document.folio_no":return a.userinfo.info.role_1;case"document.date_sent_officer":return a.userinfo.info.role_2;case"document.file_metadata_response_id":case"document.conclusion":case"document.date_conclusion":case"document.remarks":return a.userinfo.info.role_3;case"document.date_sent_from_dep":return a.userinfo.info.role_5;case"move":return a.userinfo.info.role_8;default:return!1}},a.loadDocument=function(){a.parts.document.state=SavingStateEnum.Loading;var c=b.retrieveDocumentEA(a.routeParams);c[0].then(function(){a.parts.document.state=SavingStateEnum.Loaded})},a.parts.document==SavingStateEnum.Loading;var h=b.retrieveProjectData(a.routeParams);h[5].then(function(){var c=b.retrieveExternalAudit(a.routeParams);c[1].then(function(){a.parts.documents.state=SavingStateEnum.Loaded,_.isUndefined(a.routeParams.documentId)||a.loadDocument()})})}]);var controllers=angular.module("seroApp.controllers");controllers.controller("AuditsInspectionsController",["$scope","ProjectFactory","$timeout","Upload","$q",function(a,b,c,d,e){a.parts={auditsinspections:{state:SavingStateEnum.None},auditinspection:{form:null,state:SavingStateEnum.None}},a.newButton={},a.newButton.year=(new Date).getFullYear(),a.fileUploadPattern=fileUploadPattern,a.fileUploadNgfPattern=fileUploadNgfPattern,a.fileUploadMaxSize=fileUploadMaxSize,a.shouldShowAuditInspection=function(b){return a.parts.auditinspection.state==SavingStateEnum.Loading?!1:a.routeParams.auditinspectionId==b.id?!0:!1},a.criteriaMatchOfficer1=function(a){return function(b){return b.passive&&a?b.id===a:b.passive===!1}},a.criteriaMatchOfficer=function(a){return function(b){if(b.passive&&a)for(var c=0;c<a.length;c++){var d=a[c];return b.id===d}return b.passive===!1}},a.isLoading=function(){return a.parts.auditinspection.state==SavingStateEnum.Loading?a.hasAuditInspection()?!0:!1:a.parts.auditinspection.state==SavingStateEnum.LoadingNew},a.hasAuditInspection=function(){return!_.isEmpty(a.data.auditinspection)},a.updateStatus=function(a){a.date_closing?a.status=75:a.date_received?a.status=74:a.date_deadline&&a.date_deadline<new Date?a.status=73:a.action_taken?a.status=72:a.date_carried_out&&(a.status=71)},a.openAuditInspection=function(b){a.routeParams.auditinspectionId==b?a["goto"]("/projects/"+a.data.project.id+"/auditsinspections"):a.routeParams.auditinspectionId||a["goto"]("/projects/"+a.data.project.id+"/auditsinspections/"+b)},a.stopPropagation=function(a){a.stopPropagation()},a.saveCurrentAuditInspection=function(){var b=a.data.auditinspection,c=b.is_new;c||a.updateStatus(b),a.saveCurrent(a.parts.auditinspection,b,c).then(function(b){c&&a["goto"]("/projects/"+a.data.project.id+"/auditsinspections/"+b.id)})},a.newAuditInspection=function(){a.parts.auditinspection.state=SavingStateEnum.LoadingNew,a.newButton.isopen=!1,b.createNewAuditInspection(a.data.project,a.newButton.year,a.newButton.type,a.newButton.reason,a.newButton.date_carried_out),a.parts.auditinspection.isNew=!0,a.saveCurrentAuditInspection()},a.deleteAuditInspection=function(){b.deleteAuditInspection(a.routeParams),a["goto"]("/projects/"+a.data.project.id+"/auditsinspections/")},a.auth.canSave=function(b){return"new"==b?a.userinfo.info.role_7:a.userinfo.info.role_8?!0:"lead_officer"==b?!1:a.userinfo.info.id===a.data.auditinspection.lead_officer},a.uploadActionTakenLetter=function(b){if(b){a.showUploadingFileActionTakenLetter=!0,a.actionTakenLetterFile=b[0];var f=uploadFile(e,c,d,a.parts.auditinspection.form.action_taken_letter,a.actionTakenLetterFile);f.then(function(b){a.data.auditinspection.file_metadata_id=b.result.id,a.parts.auditinspection.form.action_taken_letter.$setDirty(),a.saveCurrentAuditInspection(),c(function(){a.showUploadingFileActionTakenLetter=!1},3e3)},function(){})}},a.uploadReport=function(b){if(b){a.showUploadingFileReport=!0,a.reportFile=b[0];var f=uploadFile(e,c,d,a.parts.auditinspection.form.report,a.reportFile);f.then(function(b){a.data.auditinspection.file_metadata_report_id=b.result.id,a.parts.auditinspection.form.report.$setDirty(),a.saveCurrentAuditInspection(),c(function(){a.showUploadingFileReport=!1},3e3)},function(){})}},a.uploadDocumentation=function(b){if(b){a.showUploadingFileDocumentation=!0,a.documentationFile=b[0];var f=uploadFile(e,c,d,a.parts.auditinspection.form.documentation,a.documentationFile);f.then(function(b){a.data.auditinspection.documentation_ids.push(b.result.id),a.parts.auditinspection.form.documentation.$setDirty(),a.saveCurrentAuditInspection(),c(function(){a.showUploadingFileDocumentation=!1},3e3)},function(){})}},a.downloadFileUrl=function(a){return"/file/v1/download/"+a},a.deleteActionTakenLetter=function(){a.data.auditinspection.file_metadata_id=null,a.parts.auditinspection.form.action_taken_letter.$setDirty(),a.saveCurrentAuditInspection()},a.deleteReport=function(){a.data.auditinspection.file_metadata_report_id=null,a.parts.auditinspection.form.report.$setDirty(),a.saveCurrentAuditInspection()},a.deleteDocumentation=function(b){_.remove(a.data.auditinspection.documentation_ids,function(a){return a===b}),a.parts.auditinspection.form.documentation.$setDirty(),a.saveCurrentAuditInspection()},a.loadAuditInspection=function(){a.parts.auditinspection.state=SavingStateEnum.Loading;var c=b.retrieveAuditInspection(a.routeParams);c[0].then(function(){a.parts.auditinspection.state=SavingStateEnum.Loaded})},a.parts.auditinspection.state=SavingStateEnum.Loading;var f=b.retrieveProjectData(a.routeParams);f[3].then(function(){a.parts.auditsinspections.state=SavingStateEnum.Loaded,_.isUndefined(a.routeParams.auditinspectionId)||a.loadAuditInspection()})}]),controllers.controller("PermitsLicensesController",["$scope","ProjectFactory","$timeout","Upload","$q","$location",function(a,b,c,d,e){a.parts={permitslicenses:{state:SavingStateEnum.None},permitlicense:{form:null,state:SavingStateEnum.None}},a.newButton={},a.newButton.approved_by_the_lc1=!1,a.newButton.approved_by_the_dec=!1,a.fileUploadPattern=fileUploadPattern,a.fileUploadNgfPattern=fileUploadNgfPattern,a.fileUploadMaxSize=fileUploadMaxSize,a.DocumentTagEnum=DocumentTagEnum,a.documentationData={ApplicationForm:{formField:"documentation_applicationform",tag:DocumentTagEnum.PermitLicenseApplicationForm},PermitLicense:{formField:"documentation_permitlicense",tag:DocumentTagEnum.PermitLicensePermitLicense},Attachments:{formField:"documentation_attachments",tag:DocumentTagEnum.PermitLicenseAttachments}},a.idPermit=118,a.idLicense=119,a.idWetland=123,a.isEcosystemWetland=function(b){return b.ecosystem==a.idWetland},a.shouldShowPermitLicense=function(b){return a.parts.permitlicense.state==SavingStateEnum.Loading?!1:a.routeParams.permitlicenseId==b.id?!0:!1},a.notOkToEditOrCreateNew=function(){return a.routeParams.permitlicenseId?!0:a.data.permitlicense.is_new?!0:!1},a.preventClickIfDisabled=function(a,b){a&&b.preventDefault()},a.openPermitLicense=function(b){a.data.permitlicense.is_new||(a.routeParams.permitlicenseId==b?a["goto"]("/projects/"+a.data.project.id+"/permitslicenses"):a.routeParams.permitlicenseId||a["goto"]("/projects/"+a.data.project.id+"/permitslicenses/"+b))},a.saveCurrentPermitLicense=function(b){var c=b.is_new;a.isEcosystemWetland(b)||(b.regulation_activity=null),c||a.updateStatus(b),a.saveCurrent(a.parts.permitlicense,b,c).then(function(b){c&&a["goto"]("/projects/"+a.data.project.id+"/permitslicenses/"+b.id)})},a.updateStatus=function(){},a.newPermitLicense=function(){a.parts.permitlicense.state=SavingStateEnum.LoadingNew,a.newButton.isopen=!1;var c=null;a.isEcosystemWetland(a.newButton)&&(c=a.newButton.regulation_activity),b.createNewPermitLicense(a.data.project,a.newButton.regulation,a.newButton.ecosystem,c,a.newButton.area,a.newButton.unit,a.newButton.approved_by_the_lc1,a.newButton.approved_by_the_dec,a.newButton.waste_license_type)},a.deletePermitLicense=function(){b.deletePermitLicense(a.routeParams),a["goto"]("/projects/"+a.data.project.id+"/permitslicenses")},a.calculateDateFeedbackToApplicants=function(){a.data.permitlicense.date_feedback_to_applicants=addDays(a.data.permitlicense.date_submitted,21)},a.uploadDocumentation=function(b,f,g){if(g){f.showUploading=!0,f.file=g[0];var h=uploadFile(e,c,d,a.parts.permitlicense.form[f.formField],f.file,f.tag);h.then(function(d){b.documentation_ids.push(d.result.id),a.parts.permitlicense.form[f.formField].$setDirty(),a.saveCurrentPermitLicense(b),c(function(){f.showUploading=!1},3e3)},function(){})}},a.deleteDocumentation=function(b,c,d){_.remove(b.documentation_ids,function(a){return a===c}),a.parts.permitlicense.form[d.formField].$setDirty(),a.saveCurrentPermitLicense(b)},a.hasDocumentationTag=function(a,b){var c=!1;return _.forEach(a,function(a){a.tag==b&&(c=!0)}),c},a.downloadFileUrl=function(a){return"/file/v1/download/"+a},a.auth.canSave=function(b){if(a.data.permitlicense.is_new&&a.parts.permitlicense.state==SavingStateEnum.SavingStarted)return!1;switch(b){case"new":case"delete":case"regulation":case"date_submitted":case"waste_license_type":case"ecosystem":case"regulation_activity":case"area":case"unit":case"approved_by_the_lc1":case"approved_by_the_dec":case"application_number":case"application_fee_receipt_number":case"date_feedback_to_applicants":case"date_sent_to_director":case"date_sent_from_dep":case"date_sent_officer":case"user_id":case"application_evaluation_by_officer":case"date_of_evaluation":case"folio_no":case"inspection_recommended":case"date_inspection":case"officer_recommend":case"fee_receipt_no":case"date_fee_payed":case"date_sent_to_ed_for_decision":case"decision":case"date_decision":case"signature_on_permit_license":case"date_permit_license":case"permit_license_no":case"date_permit_license_expired":case"personnel":return a.userinfo.info.role_1;case"status":return!1;default:return!1}},a.loadPermitLicense=function(){a.parts.permitlicense.state=SavingStateEnum.Loading;var c=b.retrievePermitLicense(a.routeParams);c[0].then(function(){a.parts.permitlicense.state=SavingStateEnum.Loaded})},a.parts.permitlicense.state=SavingStateEnum.Loading;var f=b.retrieveProjectData(a.routeParams);f[4].then(function(){a.parts.permitslicenses.state=SavingStateEnum.Loaded,_.isUndefined(a.routeParams.permitlicenseId)||a.loadPermitLicense()})}]),controllers.controller("SearchTabsController",["$scope","$routeParams","$location","$q","$timeout","ProjectFactory","Valuelists","UserInfo",function(a,b,c,d,e,f,g,h){a.SearchTabEnum=SearchTabEnum,a.routeParams=b,a.userinfo=h,a.valuelists=g;var i=function(a){return _.contains(a,"projects")?SearchTabEnum.Projects:_.contains(a,"eiaspermits")?SearchTabEnum.EiasPermits:_.contains(a,"permitslicenses")?SearchTabEnum.PermitsLicenses:_.contains(a,"auditsinspections")?SearchTabEnum.AuditsInspections:_.contains(a,"externalaudits")?SearchTabEnum.ExternalAudits:null};a.tab=i(c.path()),a["goto"]=function(a){e(function(){c.path(a)})}}]),controllers.controller("SearchAuditsInspectionsController",["$scope","$routeParams","$location","$q","$timeout","AuditInspectionSearch","UserInfo","Valuelists","SearchService",function(a,b,c,d,e,f,g,h,i){a.isSearching=!1,a.showResultGrid=!1,a.gridOptions={},a.gridOptions.enableHorizontalScrollbar=0,a.gridOptions.showGridFooter=!0,a.gridOptions.minRowsToShow=10,a.gridOptions.enableColumnMenus=!1,a.gridOptions.enableRowSelection=!0,a.gridOptions.enableRowHeaderSelection=!1,a.gridOptions.multiSelect=!1,a.gridOptions.noUnselect=!0,a.gridOptions.enableFooterTotalSelected=!1,a.gridOptions.appScopeProvider={onDblClick:function(b){a["goto"]("/projects/"+b.project_id+"/auditsinspections/"+b.auditinspection_id)}},a.gridOptions.rowTemplate='<div ng-dblclick="grid.appScope.onDblClick(row.entity)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',a.gridOptions.columnDefs=[{name:"auditinspection_code",displayName:"Number",width:80,cellTooltip:!0,headerTooltip:!0},{name:"project_title",displayName:"Project name",cellTooltip:!0,headerTooltip:!0},{name:"developer_name",displayName:"Developer name",cellTooltip:!0,headerTooltip:!0},{name:"developer_tin",displayName:"TIN",type:"number",width:90,cellTooltip:!0,headerTooltip:!0},{name:"district_district",displayName:"District",cellTooltip:!0,headerTooltip:!0},{name:"auditinspection_type",displayName:"Activity",cellTooltip:!0,headerTooltip:!0},{name:"category_description",displayName:"Category of project",width:150,cellTooltip:!0,headerTooltip:!0},{name:"auditinspection_action_taken",displayName:"Response",cellTooltip:!0,headerTooltip:!0},{name:"auditinspection_performance_level",displayName:"Performance",width:110,cellTooltip:!0,headerTooltip:!0},{name:"auditinspection_date_deadline",displayName:"Deadline for complete compliance",width:90,type:"date",cellFilter:'date:"d MMM yyyy"',headerTooltip:!0}],a.gridOptions.onRegisterApi=function(b){a.gridApi=b},a.setSearchUrl=function(){if(!_.isEmpty(a.criteria)){var b=_.isEqual(i.criteria,a.criteria);b?(i.allowCache=!1,a.search()):c.search(a.criteria)}},a.search=function(){a.isSearching=!0,a.showResultGrid=!1,i.search(a.criteria).then(function(b){a.gridOptions.data=b,a.isSearching=!1,a.showResultGrid=!0})},a.reset=function(){a.criteria={},i.criteria={},a.gridOptions.data=[],a.showResultGrid=!1},a.criteria=c.search(),_.isEmpty(a.criteria)&&!_.isEmpty(i.criteria)?c.search(i.criteria):_.isEmpty(a.criteria)||a.search()}]),controllers.controller("SearchProjectsController",["$scope","$routeParams","$location","$q","$timeout","ProjectSearch","UserInfo","Valuelists","ProjectSearchService",function(a,b,c,d,e,f,g,h,i){a.isSearching=!1,a.showResultGrid=!1,a.gridOptions={},a.gridOptions.enableHorizontalScrollbar=0,a.gridOptions.showGridFooter=!0,a.gridOptions.minRowsToShow=10,a.gridOptions.enableColumnMenus=!1,a.gridOptions.enableRowSelection=!0,a.gridOptions.enableRowHeaderSelection=!1,a.gridOptions.multiSelect=!1,a.gridOptions.noUnselect=!0,a.gridOptions.enableFooterTotalSelected=!1,a.gridOptions.appScopeProvider={onDblClick:function(b){a["goto"]("/projects/"+b.project_id)}},a.gridOptions.rowTemplate='<div ng-dblclick="grid.appScope.onDblClick(row.entity)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',a.gridOptions.columnDefs=[{name:"project_id",displayName:"Id",type:"number",width:50,cellTooltip:!0,headerTooltip:!0},{name:"project_title",displayName:"Name",cellTooltip:!0,headerTooltip:!0},{name:"project_location",displayName:"Location",cellTooltip:!0,headerTooltip:!0},{name:"district_district",displayName:"District",cellTooltip:!0,headerTooltip:!0},{name:"category_description",displayName:"Category",cellTooltip:!0,headerTooltip:!0},{name:"developer_name",displayName:"Developer name",cellTooltip:!0,headerTooltip:!0},{name:"developer_tin",displayName:"TIN",type:"number",width:90,cellTooltip:!0,headerTooltip:!0}],a.gridOptions.onRegisterApi=function(b){a.gridApi=b},a.setSearchUrl=function(){if(!_.isEmpty(a.criteria)){var b=_.isEqual(i.criteria,a.criteria);b?(i.allowCache=!1,a.search()):c.search(a.criteria)}},a.search=function(){a.isSearching=!0,a.showResultGrid=!1,i.search(a.criteria).then(function(b){a.gridOptions.data=b,a.isSearching=!1,a.showResultGrid=!0})},a.reset=function(){a.criteria={},i.criteria={},a.gridOptions.data=[],a.showResultGrid=!1},a.criteria=c.search(),_.isEmpty(a.criteria)&&!_.isEmpty(i.criteria)?c.search(i.criteria):_.isEmpty(a.criteria)||a.search()}]),controllers.controller("SearchEiasPermitsController",["$scope","$routeParams","$location","$q","$timeout","EiaPermitSearch","UserInfo","Valuelists","EiaPermitSearchService",function(a,b,c,d,e,f,g,h,i){a.isSearching=!1,a.showResultGrid=!1,a.gridOptions={},a.gridOptions.enableHorizontalScrollbar=0,a.gridOptions.showGridFooter=!0,a.gridOptions.minRowsToShow=10,a.gridOptions.enableColumnMenus=!1,a.gridOptions.enableRowSelection=!0,a.gridOptions.enableRowHeaderSelection=!1,a.gridOptions.multiSelect=!1,a.gridOptions.noUnselect=!0,a.gridOptions.enableFooterTotalSelected=!1,a.gridOptions.appScopeProvider={onDblClick:function(b){a["goto"]("/projects/"+b.project_id+"/eiaspermits/"+b.eiapermit_id)}},a.gridOptions.rowTemplate='<div ng-dblclick="grid.appScope.onDblClick(row.entity)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',a.gridOptions.columnDefs=[{name:"eiapermit_id",displayName:"EIA Id",type:"number",width:80,cellTooltip:!0,headerTooltip:!0},{name:"eiapermit_status",displayName:"Status",cellTooltip:!0,headerTooltip:!0},{name:"eiapermit_officer_assigned",displayName:"Team leader",cellTooltip:!0,headerTooltip:!0},{name:"project_title",displayName:"Project name",cellTooltip:!0,headerTooltip:!0},{name:"eiapermit_certificate_no",displayName:"Certificate No.",cellTooltip:!0,headerTooltip:!0}],a.gridOptions.onRegisterApi=function(b){a.gridApi=b},a.setSearchUrl=function(){if(_.forOwn(a.dateCriteria,function(b,c){b instanceof Date&&(b.setHours(12),a.criteria[c]=b.toJSON().substr(0,10))}),!_.isEmpty(a.criteria)){var b=_.isEqual(i.criteria,a.criteria);b?(i.allowCache=!1,a.search()):c.search(a.criteria)}},a.search=function(){a.isSearching=!0,a.showResultGrid=!1,i.search(a.criteria).then(function(b){a.gridOptions.data=b,a.isSearching=!1,a.showResultGrid=!0})},a.reset=function(){a.criteria={},a.dateCriteria={},i.criteria={},a.gridOptions.data=[],a.showResultGrid=!1},a.criteria=c.search(),a.dateCriteria={},a.criteria.eiapermit_date_submission_from&&(a.dateCriteria.eiapermit_date_submission_from=new Date(a.criteria.eiapermit_date_submission_from)),a.criteria.eiapermit_date_submission_to&&(a.dateCriteria.eiapermit_date_submission_to=new Date(a.criteria.eiapermit_date_submission_to)),_.isEmpty(a.criteria)&&!_.isEmpty(i.criteria)?c.search(i.criteria):_.isEmpty(a.criteria)||a.search()}]),controllers.controller("SearchPermitsLicensesController",["$scope","$routeParams","$location","$q","$timeout","PermitLicenseSearch","UserInfo","Valuelists","PermitLicenseSearchService",function(a,b,c,d,e,f,g,h,i){a.isSearching=!1,a.showResultGrid=!1,a.gridOptions={},a.gridOptions.enableHorizontalScrollbar=0,a.gridOptions.showGridFooter=!0,a.gridOptions.minRowsToShow=10,a.gridOptions.enableColumnMenus=!1,a.gridOptions.enableRowSelection=!0,a.gridOptions.enableRowHeaderSelection=!1,a.gridOptions.multiSelect=!1,a.gridOptions.noUnselect=!0,a.gridOptions.enableFooterTotalSelected=!1,a.gridOptions.appScopeProvider={onDblClick:function(b){a["goto"]("/projects/"+b.project_id+"/permitslicenses/"+b.permitlicense_id)}},a.gridOptions.rowTemplate='<div ng-dblclick="grid.appScope.onDblClick(row.entity)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',a.gridOptions.columnDefs=[{name:"permitlicense_id",displayName:"PL Id",type:"number",width:80,cellTooltip:!0,headerTooltip:!0},{name:"permitlicense_date_submitted",displayName:"Date of submission",width:130,type:"date",cellFilter:'date:"d MMM yyyy"',headerTooltip:!0},{name:"permitlicense_regulation",displayName:"Regulation",width:80,cellTooltip:!0,headerTooltip:!0},{name:"permitlicense_officer_assigned",displayName:"Team leader",cellTooltip:!0,headerTooltip:!0},{name:"project_title",displayName:"Project name",cellTooltip:!0,headerTooltip:!0}],a.idPermit=118,a.idLicense=119,a.idWetland=123,a.idRB=124,a.idLS=125,a.isDisabled=function(b){switch(b){case"permitlicense_ecosystem":return a.criteria.permitlicense_regulation==a.idLicense;case"permitlicense_waste_license_type":return a.criteria.permitlicense_regulation==a.idPermit;case"permitlicense_regulation_activity":return a.criteria.permitlicense_regulation==a.idLicense||a.criteria.permitlicense_ecosystem==a.idRB||a.criteria.permitlicense_ecosystem==a.idLS;default:return!1}},a.gridOptions.onRegisterApi=function(b){a.gridApi=b},a.setSearchUrl=function(){if(a.removeDisabledSearchCriteria(),_.forOwn(a.dateCriteria,function(b,c){b instanceof Date&&(b.setHours(12),a.criteria[c]=b.toJSON().substr(0,10))}),!_.isEmpty(a.criteria)){var b=_.isEqual(i.criteria,a.criteria);b?(i.allowCache=!1,a.search()):c.search(a.criteria)}},a.removeDisabledSearchCriteria=function(){_.forOwn(a.criteria,function(b,c){a.isDisabled(c)&&(a.criteria[c]=null)})},a.search=function(){a.isSearching=!0,a.showResultGrid=!1,i.search(a.criteria).then(function(b){a.gridOptions.data=b,a.isSearching=!1,a.showResultGrid=!0})},a.reset=function(){a.criteria={},a.dateCriteria={},i.criteria={},a.gridOptions.data=[],a.showResultGrid=!1},a.criteria=c.search(),a.dateCriteria={},a.criteria.permitlicense_date_submission_from&&(a.dateCriteria.permitlicense_date_submission_from=new Date(a.criteria.permitlicense_date_submission_from)),a.criteria.permitlicense_date_submission_to&&(a.dateCriteria.permitlicense_date_submission_to=new Date(a.criteria.permitlicense_date_submission_to)),_.isEmpty(a.criteria)&&!_.isEmpty(i.criteria)?c.search(i.criteria):_.isEmpty(a.criteria)||a.search()}]),controllers.controller("StatisticsTabsController",["$scope","$routeParams","$location","$q","$timeout","ProjectFactory","Valuelists","StatisticsService",function(a,b,c,d,e,f,g,h){a.routeParams=b,a.valuelists=g,a.StatisticsService=h,a.StatisticsTabEnum=StatisticsTabEnum;var i=function(a){return _.contains(a,"projects")?StatisticsTabEnum.Projects:_.contains(a,"eiaspermits")?StatisticsTabEnum.EiasPermits:_.contains(a,"auditsinspections")?StatisticsTabEnum.AuditsInspections:null};a.tab=i(c.path()),a["goto"]=function(a){e(function(){c.path(a)})}}]),controllers.controller("StatisticsProjectsController",["$scope","$routeParams","$location","$q","$timeout","ProjectStatistics","UserInfo","Valuelists","StatisticsService",function(a,b,c,d,e,f,g,h,i){a.data={},a.isLoadingData=!0,i.getProjectData().then(function(b){a.data=b,a.isLoadingData=!1})}]),controllers.controller("SearchExternalAuditsController",["$scope","$routeParams","$location","$q","$timeout","ExternalAuditSearch","UserInfo","Valuelists","ExternalAuditSearchService",function(a,b,c,d,e,f,g,h,i){a.isSearching=!1,a.showResultGrid=!1,a.gridOptions={},a.gridOptions.enableHorizontalScrollbar=0,a.gridOptions.showGridFooter=!0,a.gridOptions.minRowsToShow=10,a.gridOptions.enableColumnMenus=!1,a.gridOptions.enableRowSelection=!0,a.gridOptions.enableRowHeaderSelection=!1,a.gridOptions.multiSelect=!1,a.gridOptions.noUnselect=!0,a.gridOptions.enableFooterTotalSelected=!1,a.gridOptions.appScopeProvider={onDblClick:function(b){a["goto"]("/projects/"+b.project_id+"/externalaudits/"+b.externalaudit_id)}},a.gridOptions.rowTemplate='<div ng-dblclick="grid.appScope.onDblClick(row.entity)" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }" ui-grid-cell ></div>',a.gridOptions.columnDefs=[{name:"externalaudit_id",displayName:"EA Id",type:"number",width:80,cellTooltip:!0,headerTooltip:!0},{name:"externalaudit_officer_assigned",displayName:"Officer assigned",cellTooltip:!0,headerTooltip:!0},{name:"project_title",displayName:"Project name",cellTooltip:!0,headerTooltip:!0}],a.gridOptions.onRegisterApi=function(b){a.gridApi=b},a.setSearchUrl=function(){if(_.forOwn(a.dateCriteria,function(b,c){b instanceof Date&&(b.setHours(12),a.criteria[c]=b.toJSON().substr(0,10))}),!_.isEmpty(a.criteria)){var b=_.isEqual(i.criteria,a.criteria);b?(i.allowCache=!1,a.search()):c.search(a.criteria)}},a.search=function(){a.isSearching=!0,a.showResultGrid=!1,i.search(a.criteria).then(function(b){a.gridOptions.data=b,a.isSearching=!1,a.showResultGrid=!0})},a.reset=function(){a.criteria={},a.dateCriteria={},i.criteria={},a.gridOptions.data=[],a.showResultGrid=!1},a.criteria=c.search(),a.dateCriteria={},a.criteria.externalaudit_date_submission_from&&(a.dateCriteria.externalaudit_date_submission_from=new Date(a.criteria.externalaudit_date_submission_from)),a.criteria.externalaudit_date_submission_to&&(a.dateCriteria.externalaudit_date_submission_to=new Date(a.criteria.externalaudit_date_submission_to)),_.isEmpty(a.criteria)&&!_.isEmpty(i.criteria)?c.search(i.criteria):_.isEmpty(a.criteria)||a.search()}]),controllers.controller("AdvancedCodesController",["$scope","$routeParams","EditCode","$timeout","$q","$interval","uiGridConstants",function(a,b,c,d){a.routeParams=b,a.parts={code:{form:null,state:SavingStateEnum.Loading}},a.gridOptions={},a.gridOptions.enableCellEditOnFocus=!0,
a.gridOptions.showGridFooter=!0,a.gridOptions.minRowsToShow=15,a.gridOptions.rowEditWaitInterval=1e3,a.gridOptions.enableFiltering=!0,a.gridOptions.columnDefs=[{name:"id",type:"number",enableCellEdit:!1,width:60},{name:"description1",cellTooltip:!0,width:"*"},{name:"description2",cellTooltip:!0,width:150},{name:"value1",type:"number",width:100},{name:"dropdown_list",cellTooltip:!0,width:150},{name:"updated_by",enableCellEdit:!1,width:120},{name:"updated_at",enableCellEdit:!1,enableFiltering:!1,type:"date",cellFilter:'date:"d MMM yyyy HH:mm:ss"',width:160},{name:"delete",displayName:"",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,enableColumnMenu:!1,width:80,cellTemplate:'<div><button ng-show="row.entity.deleted_at" ng-click="grid.appScope.undeleteRow(row.entity)" class="btn undelete btn-sm btn-link">undelete</button><button ng-hide="row.entity.deleted_at" ng-click="grid.appScope.deleteRow(row.entity)" class="btn delete btn-sm btn-link">delete</button></div>'}],a.saveRow=function(b){var c=b.$update();a.gridApi.rowEdit.setSavePromise(b,c)},a.deleteRow=function(b){var c=b.$delete({});a.gridApi.rowEdit.setSavePromise(b,c)},a.undeleteRow=function(b){b.deleted_at=null,a.saveRow(b)},a.addRow=function(){var b=new c,e=b.$save();e.then(function(b){a.gridOptions.data.push(b),d(function(){a.gridApi.cellNav.scrollToFocus(b,a.gridOptions.columnDefs[0])})})},a.gridOptions.onRegisterApi=function(b){a.gridApi=b,b.rowEdit.on.saveRow(a,a.saveRow)},c.query({},function(b){a.gridOptions.data=b})}]),controllers.controller("AdvancedUsersController",["$scope","$routeParams","EditUser","$timeout","$q","$interval","uiGridConstants",function(a,b,c,d){a.routeParams=b,a.parts={code:{form:null,state:SavingStateEnum.Loading}},a.gridOptions={},a.gridOptions.enableCellEditOnFocus=!0,a.gridOptions.showGridFooter=!0,a.gridOptions.minRowsToShow=15,a.gridOptions.rowEditWaitInterval=1e3,a.gridOptions.enableFiltering=!0,a.gridOptions.columnDefs=[{name:"id",type:"number",enableCellEdit:!1,width:60},{name:"initials",cellTooltip:!0,width:80},{name:"name",cellTooltip:!0,width:"*"},{name:"job_position_code",cellTooltip:!0,width:80},{name:"job_position_name",cellTooltip:!0,width:100},{name:"email",cellTooltip:!0,width:100},{name:"password",cellTooltip:!0,width:80},{name:"is_passive",type:"number",width:90},{name:"role_ids",enableCellEdit:!0,width:90},{name:"updated_by",enableCellEdit:!1,width:120},{name:"updated_at",enableCellEdit:!1,enableFiltering:!1,type:"date",cellFilter:'date:"d MMM yyyy HH:mm:ss"',width:160},{name:"delete",displayName:"",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,enableColumnMenu:!1,width:80,cellTemplate:'<div><button ng-show="row.entity.deleted_at" ng-click="grid.appScope.undeleteRow(row.entity)" class="btn undelete btn-sm btn-link">undelete</button><button ng-hide="row.entity.deleted_at" ng-click="grid.appScope.deleteRow(row.entity)" class="btn delete btn-sm btn-link">delete</button></div>'}],a.saveRow=function(b){var c=b.$update();a.gridApi.rowEdit.setSavePromise(b,c)},a.deleteRow=function(b){var c=b.$delete({});a.gridApi.rowEdit.setSavePromise(b,c)},a.undeleteRow=function(b){b.deleted_at=null,a.saveRow(b)},a.addRow=function(){var b=new c,e=b.$save();e.then(function(b){a.gridOptions.data.push(b),d(function(){a.gridApi.cellNav.scrollToFocus(b,a.gridOptions.columnDefs[0])})})},a.gridOptions.onRegisterApi=function(b){a.gridApi=b,b.rowEdit.on.saveRow(a,a.saveRow)},c.query({},function(b){a.gridOptions.data=b})}]),controllers.controller("AdvancedLeadAgenciesController",["$scope","$routeParams","EditLeadAgency","$timeout","$q","$interval","uiGridConstants",function(a,b,c,d){a.routeParams=b,a.parts={code:{form:null,state:SavingStateEnum.Loading}},a.gridOptions={},a.gridOptions.enableCellEditOnFocus=!0,a.gridOptions.showGridFooter=!0,a.gridOptions.minRowsToShow=15,a.gridOptions.rowEditWaitInterval=1e3,a.gridOptions.enableFiltering=!0,a.gridOptions.columnDefs=[{name:"id",type:"number",enableCellEdit:!1,width:60},{name:"short_name",cellTooltip:!0,width:150},{name:"long_name",cellTooltip:!0,width:"*"},{name:"updated_by",enableCellEdit:!1,width:120},{name:"updated_at",enableCellEdit:!1,enableFiltering:!1,type:"date",cellFilter:'date:"d MMM yyyy HH:mm:ss"',width:160},{name:"delete",displayName:"",enableSorting:!1,enableCellEdit:!1,enableFiltering:!1,enableColumnMenu:!1,width:80,cellTemplate:'<div><button ng-show="row.entity.deleted_at" ng-click="grid.appScope.undeleteRow(row.entity)" class="btn undelete btn-sm btn-link">undelete</button><button ng-hide="row.entity.deleted_at" ng-click="grid.appScope.deleteRow(row.entity)" class="btn delete btn-sm btn-link">delete</button></div>'}],a.saveRow=function(b){var c=b.$update();a.gridApi.rowEdit.setSavePromise(b,c)},a.deleteRow=function(b){var c=b.$delete({});a.gridApi.rowEdit.setSavePromise(b,c)},a.undeleteRow=function(b){b.deleted_at=null,a.saveRow(b)},a.addRow=function(){var b=new c,e=b.$save();e.then(function(b){a.gridOptions.data.push(b),d(function(){a.gridApi.cellNav.scrollToFocus(b,a.gridOptions.columnDefs[0])})})},a.gridOptions.onRegisterApi=function(b){a.gridApi=b,b.rowEdit.on.saveRow(a,a.saveRow)},c.query({},function(b){a.gridOptions.data=b})}]),controllers.controller("LoginController",["$scope","$http","$routeParams","$location","UserInfo","$timeout",function(a,b,c,d,e,f){a.loginData={},a.sendData={},a.resetData={},a.loginMessages=[],a.sendMessages=[],a.resetMessages=[],a.loginFormDisabled=!1,a.sendFormDisabled=!1,a.resetFormDisabled=!1,a.forgot=function(){console.debug("/password/email")};var g=function(a){return _.flatten(_.values(a))};a.login=function(){a.loginForm.$invalid||(a.loginFormDisabled=!0,b.post("/auth/login",a.loginData).success(function(b){a.loginMessages=g(b),e.reTry(),d.path("/")}).error(function(b){a.loginMessages=g(b),a.loginFormDisabled=!1}))},a.send=function(){a.sendForm.$invalid||(a.sendFormDisabled=!0,b.post("/password/email",a.sendData).success(function(b){a.sendMessages=g(b)}).error(function(b){a.sendMessages=g(b),a.sendFormDisabled=!1}))},a.reset=function(){a.resetForm.$invalid||(a.resetFormDisabled=!0,a.resetData.token=c.token,b.post("/password/reset",a.resetData).success(function(b){a.resetMessages=g(b),e.reTry(),d.path("/user")}).error(function(b){a.resetMessages=g(b),a.resetFormDisabled=!1}))},f(function(){})}]);var directives=angular.module("seroApp.directives").directive("appVersion",["version",function(a){return function(b,c){c.text(a.replace(/\.0$/,"").replace(/\.00$/,".0").replace(/\.([1-9])$/,".0$1"))}}]);directives.directive("addPractitionerButton",["Practitioner",function(a){return{restrict:"A",link:function(b,c){c.bind("click",function(){var b=new a({person:"Gunnar Nymann",city:"Oslo"});b.$save()})}}}]),directives.directive("animateNewElement",["$animate",function(a){return function(b,c,d){b.$watch(d.animateNewElement,function(b){if(b===!0){console.log(c);var d="new-element";a.addClass(c,d,function(){a.removeClass(c,d)})}})}}]),directives.directive("hoverOnParent",[function(){return{restrict:"A",link:function(a,b,c){var d=c.hoverOnParent;b.parent(d).bind("mouseenter",function(){b.addClass("btn-link-hover")}),b.parent(d).bind("mouseleave",function(){b.removeClass("btn-link-hover")})}}}]),directives.directive("coordinatePasting",function(){return{require:"ngModel",link:function(a,b,c,d){d.$setViewValue("0.12104"),d.$render()}}}),directives.directive("setFocus",["$timeout",function(a){return{restrict:"A",link:function(b,c){a(function(){a(function(){c[0].focus()})})}}}]),directives.directive("statisticsPanel",function(){return{restrict:"E",scope:{part:"="},templateUrl:"partials/statisticsTablePanel.html"}}),function(){function a(){return{restrict:"E",scope:{onYes:"&",text:"=",warning:"=",buttonClass:"="},templateUrl:"partials/directives.deleteButton.html"}}angular.module("seroApp.directives").directive("seroDeleteButton",["$sce",a])}(),seroApp.filter("myDateFormat",function(a){return function(b){if(!b)return"tom";var c=new Date(b.replace(/-/g,"/"));return a("date")(c,"MMM-dd-yyyy")}});var version={version:"3.74.0"},services=angular.module("seroApp.services");services.value("version",version.version),services.factory("Practitioner",["$resource",function(a){return a("/api/v1/practitioner/:id",{id:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Project",["$resource",function(a){return a("/api/v1/project/:projectId",{projectId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Organisation",["$resource",function(a){return a("/api/v1/organisation/:organisationId",{organisationId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("EiaPermit",["$resource",function(a){return a("/api/v1/project/:projectId/eiapermit/:eiapermitId",{eiapermitId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Document",["$resource",function(a){return a("/api/v1/project/:projectId/eiapermit/:eiapermitId/document/:documentId",{documentId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Hearing",["$resource",function(a){return a("/api/v1/project/:projectId/eiapermit/:eiapermitId/document/:documentId/hearing/:hearingId",{hearingId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("PermitLicense",["$resource",function(a){return a("/api/v1/project/:projectId/permitlicense/:permitlicenseId",{permitLicenseId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("ExternalAudit",["$resource",function(a){return a("/api/v1/project/:projectId/externalaudit/:externalauditId",{externalauditId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("DocumentEA",["$resource",function(a){return a("/api/v1/project/:projectId/externalaudit/:externalauditId/document/:documentId",{documentId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("AuditInspection",["$resource",function(a){return a("/api/v1/project/:projectId/auditinspection/:auditinspectionId",{auditinspectionId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Valuelist",["$resource",function(a){return a("/api/v1/valuelist/:id",{id:"@id"})}]),services.factory("Valuelists",["Valuelist",function(a){return a.get({id:"all"})}]),services.factory("UserInfo",["$http","$location",function(a,b){var c={info:{}},d={name:"Not signed in",role_1:!1,role_2:!1,role_3:!1,role_4:!1,role_5:!1,role_6:!1,role_7:!1,role_8:!1,roles:[],features:[]},e=function(a){a?(_.merge(c.info,a),"/login"==b.path()&&b.path("/")):c.info=_.cloneDeep(d)},f=function(){a.get("/user/info").success(e)};return c.impersonate=function(b){e(null),a.get("/user/impersonate/"+b).success(e)},c.signout=function(){a.get("/auth/logout").success(function(){e(null),b.path("/login")})},c.getAllUsers=function(){a.get("/user/all").success(function(a){c.allusers=a})},c.reTry=function(){f()},e(null),f(),c}]),services.factory("EditCode",["$resource",function(a){return a("/edit/v1/code/:codeId",{codeId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("EditUser",["$resource",function(a){return a("/edit/v1/user/:userId",{userId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("EditLeadAgency",["$resource",function(a){return a("/edit/v1/leadagency/:leadAgencyId",{leadAgencyId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("EiaPermitSearch",["$resource",function(a){return a("/search/v1/eiapermit")}]),services.factory("PermitLicenseSearch",["$resource",function(a){return a("/search/v1/permitlicense")}]),services.factory("ExternalAuditSearch",["$resource",function(a){return a("/search/v1/externalaudit")}]),services.factory("AuditInspectionSearch",["$resource",function(a){return a("/search/v1/auditinspection")}]),services.factory("ProjectSearch",["$resource",function(a){return a("/search/v1/project")}]),services.factory("ProjectStatistics",["$resource",function(a){return a("/statistics/v1/project")}]),services.factory("GeneralStatistics",["$resource",function(a){return a("/statistics/v1/general")}]),services.factory("EiaPermitSearchService",["EiaPermitSearch","$q",function(a,b){var c={};return c.criteria={},c.allowCache=!0,c.rows=[],c.search=function(d){var e=b.defer(),f=_.isEqual(c.criteria,d);return f&&c.allowCache?e.resolve(c.rows):(c.criteria=_.clone(d),a.query(c.criteria,function(a){c.rows=a,e.resolve(c.rows),c.allowCache=!0})),e.promise},c}]),services.factory("PermitLicenseSearchService",["PermitLicenseSearch","$q",function(a,b){var c={};return c.criteria={},c.allowCache=!0,c.rows=[],c.search=function(d){var e=b.defer(),f=_.isEqual(c.criteria,d);return f&&c.allowCache?e.resolve(c.rows):(c.criteria=_.clone(d),a.query(c.criteria,function(a){c.rows=a,e.resolve(c.rows),c.allowCache=!0})),e.promise},c}]),services.factory("ExternalAuditSearchService",["ExternalAuditSearch","$q",function(a,b){var c={};return c.criteria={},c.allowCache=!0,c.rows=[],c.search=function(d){var e=b.defer(),f=_.isEqual(c.criteria,d);return f&&c.allowCache?e.resolve(c.rows):(c.criteria=_.clone(d),a.query(c.criteria,function(a){c.rows=a,e.resolve(c.rows),c.allowCache=!0})),e.promise},c}]),services.factory("SearchService",["AuditInspectionSearch","$q",function(a,b){var c={};return c.criteria={},c.allowCache=!0,c.rows=[],c.search=function(d){var e=b.defer(),f=_.isEqual(c.criteria,d);return f&&c.allowCache?e.resolve(c.rows):(c.criteria=_.clone(d),a.query(c.criteria,function(a){c.rows=a,e.resolve(c.rows),c.allowCache=!0})),e.promise},c}]),services.factory("ProjectSearchService",["ProjectSearch","$q",function(a,b){var c={};return c.criteria={},c.allowCache=!0,c.rows=[],c.search=function(d){var e=b.defer(),f=_.isEqual(c.criteria,d);return f&&c.allowCache?e.resolve(c.rows):(c.criteria=_.clone(d),a.query(c.criteria,function(a){c.rows=a,e.resolve(c.rows),c.allowCache=!0})),e.promise},c}]),services.factory("StatisticsService",["ProjectStatistics","$q",function(a,b){var c={};return c.allowCache=!0,c.projectData={},c.getProjectData=function(){var d=b.defer();return c.allowCache&&!_.isEmpty(c.projectData)?d.resolve(c.projectData):a.get({},function(a){c.projectData=a,d.resolve(a)}),d.promise},c}]);var data1={};services.factory("ProjectFactory",["$q","$filter","Project","Organisation","EiaPermit","Document","Hearing","ExternalAudit","DocumentEA","AuditInspection","Valuelists","UserInfo","PermitLicense",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n={};return n.project={},n.organisation={},n.eiaspermits=[],n.eiapermit={},n.documents=[],n.document={},n.hearings=[],n.hearing={},n.permitslicenses=[],n.permitlicense={},n.externalaudits=[],n.externalaudit={},n.documents_ea=[],n.document_ea={},n.auditsinspections=[],n.auditinspection={},n.valuelists=k,n.userinfo=l,n.hasData={eiapermits:!1,eiapermit:!1,documents:!1,document:!1,hearings:!1,hearing:!1,permitslicenses:!1,permitlicense:!1,externalaudits:!1,externalaudit:!1,documents_ea:!1,document_ea:!1},n.retrieveProjectData=function(b){var f=a.defer(),g=a.defer(),i=a.defer(),k=a.defer(),l=a.defer(),o=a.defer();if(n.project.id!=b.projectId){var p=_.omit(b,["eiapermitId","externalauditId","documentId","hearingId","permitlicenseId","auditinspectionId"]);n.empty(),n.project=c.get(p,function(a){f.resolve(a),n.organisation=d.get({organisationId:a.organisation_id},function(a){g.resolve(a)})}),n.eiaspermits=e.query(p,function(a){i.resolve(a)}),n.permitslicenses=m.query(p,function(a){o.resolve(a)}),n.externalaudits=h.query(p,function(a){k.resolve(a)}),n.auditsinspections=j.query(p,function(a){l.resolve(a)})}else _.remove(n.permitslicenses,function(a){return a.is_new}),f.resolve(n.project),g.resolve(n.organisation),i.resolve(n.eiaspermits),o.resolve(n.permitslicenses),k.resolve(n.externalaudits),l.resolve(n.auditsinspections);return[f.promise,g.promise,i.promise,l.promise,o.promise,k.promise]},n.retrieveEiaPermit=function(b){var c=a.defer(),d=a.defer();if(n.eiapermit.id!=b.eiapermitId){n.emptyEiaPermit();var e=_.where(n.eiaspermits,{id:parseInt(b.eiapermitId)});1==e.length&&(n.eiapermit=e[0],n.eiapermit.$get(_.omit(b,["documentId","hearingId"]),function(a){c.resolve(a),n.documents=f.query(_.omit(b,["documentId","hearingId"]),function(a){d.resolve(a)})}))}else c.resolve(n.eiapermit),d.resolve(n.documents);return[c.promise,d.promise]},n.retrieveDocument=function(b){var c=a.defer(),d=a.defer();if(n.document.id!=b.documentId){n.emptyDocument();var e=_.where(n.documents,{id:parseInt(b.documentId)});1==e.length&&(n.document=e[0],n.document.$get(_.omit(b,["hearingId"]),function(a){n.hearings=g.query(_.omit(b,["hearingId"]),function(a){d.resolve(a)}),c.resolve(a)}))}else c.resolve(n.document),d.resolve(n.hearings);return[c.promise,d.promise]},n.retrieveHearing=function(b){var c=a.defer();if(n.hearing.id!=b.hearingId){n.emptyHearing();var d=_.where(n.hearings,{id:parseInt(b.hearingId)});1==d.length&&(n.hearing=d[0],n.hearing.$get(b,function(a){c.resolve(a)}))}else c.resolve(n.hearing);return[c.promise]},n.retrieveExternalAudit=function(b){var c=a.defer(),d=a.defer();if(n.externalaudit.id!=b.externalauditId){n.emptyExternalAudit();var e=_.where(n.externalaudits,{id:parseInt(b.externalauditId)});1==e.length&&(n.externalaudit=e[0],n.externalaudit.$get(_.omit(b,["documentId"]),function(a){n.documents_ea=i.query(_.omit(b,["documentId"]),function(a){d.resolve(a)}),c.resolve(a)}))}else c.resolve(n.eiapermit),d.resolve(n.documents);return[c.promise,d.promise]},n.retrieveDocumentEA=function(b){var c=a.defer();if(n.document_ea.id!=b.documentId){n.emptyDocumentEA();var d=_.where(n.documents_ea,{id:parseInt(b.documentId)});1==d.length&&(n.document_ea=d[0],n.document_ea.$get(_.omit(b,["hearingId"]),function(a){c.resolve(a)}))}else c.resolve(n.document_ea);return[c.promise]},n.retrieveAuditInspection=function(b){var c=a.defer();if(b.auditinspectionId){var d=_.where(n.auditsinspections,{id:parseInt(b.auditinspectionId)});1==d.length&&(n.auditinspection=d[0],n.auditinspection.$get(b,function(a){c.resolve(a)}))}return[c.promise]},n.retrievePermitLicense=function(b){data1=n.permitslicenses;var c=a.defer();if(b.permitlicenseId){var d=_.where(n.permitslicenses,{id:parseInt(b.permitlicenseId)});1==d.length&&(n.permitlicense=d[0],n.permitlicense.$get(b,function(a){c.resolve(a)}))}return[c.promise]},n.getProjectSummary=function(){var a=n.project;return a.title?a.title:""},n.getCodeFromValuelist=function(a,b){"string"==typeof b&&(b=parseInt(b));var c=_.find(n.valuelists[a],{id:b});return c?c.description1:""},n.setOrganisation=function(b){var c=a.defer();return n.organisation=b,b.$get({},function(a){c.resolve(a)}),c.promise},n.setEiaPermit=function(b){var c=a.defer();return n.eiapermit=b,c.resolve(b),c.promise},n.setAuditInspection=function(b){var c=a.defer();return n.auditinspection=b,c.resolve(b),c.promise},n.empty=function(){n.project={},n.organisation={},n.eiaspermits=[],n.emptyEiaPermit(),n.emptyExternalAudit(),n.auditsinspections=[],n.auditinspection={}},n.emptyEiaPermit=function(){n.eiapermit={},n.documents=[],n.emptyDocument()},n.emptyDocument=function(){n.document={},n.hearings=[],n.emptyHearing()},n.emptyHearing=function(){n.hearing={}},n.emptyExternalAudit=function(){n.externalaudit={},n.documents_ea=[],n.emptyDocumentEA()},n.emptyDocumentEA=function(){n.document_ea={}},n.createNewProject=function(a){var b={has_industrial_waste_water:42,organisation_id:a.id,risk_level:96,is_new:!0};n.project=new c(b)},n.createNewOrganisation=function(){var a={is_new:!0};n.organisation=new d(a)},n.createNewEiaPermit=function(a){var b={project_id:a.id,inspection_recommended:42,is_new:!0};n.eiapermit=new e(b),n.eiaspermits.push(n.eiapermit),n.documents=[]},n.createNewDocument=function(a){var b={eia_permit_id:a.id,director_copy_no:1,is_new:!0};n.document=new f(b),n.documents.unshift(n.document),n.hearings=[]},n.createNewHearing=function(a){var b={document_id:a.id,is_new:!0};n.hearing=new g(b),n.hearings.unshift(n.hearing)},n.deleteEiaPermit=function(a){var b=_.findIndex(n.eiaspermits,{id:n.eiapermit.id}),c=function(a){n.eiaspermits.splice(a,1),n.eiapermit={}};n.eiapermit.is_new?c(b):n.eiapermit.$delete(a,function(){c(b)})},n.deleteDocument=function(b){var c=a.defer(),d=function(a){n.documents.splice(a,1),n.document={}};if(n.document.is_new)d(0);else{var e=_.findIndex(n.documents,{id:n.document.id});n.document.$delete(b,function(){d(e),c.resolve()})}return c.promise},n.moveDocument=function(b,c){var d=a.defer(),e=function(a){n.documents.splice(a,1),n.document={}},f=_.findIndex(n.documents,{id:n.document.id});return n.document.eia_permit_id=c,n.document.$update(b,function(a){e(f),d.resolve(a)},function(){d.reject("Moving failed")}),d.promise},n.moveDocumentEA=function(b,c){var d=a.defer(),e=function(a){n.documents_ea.splice(a,1),n.document_ea={}},f=_.findIndex(n.documents_ea,{id:n.document_ea.id});return n.document_ea.external_audit_id=c,n.document_ea.$update(b,function(a){e(f),d.resolve(a)},function(){d.reject("Moving failed")}),d.promise},n.deleteHearing=function(b){var c=a.defer(),d=function(a){n.hearings.splice(a,1),n.hearing={}};if(n.hearing.is_new)d(0);else{var e=_.findIndex(n.hearings,{id:n.hearing.id});n.hearing.$delete(b,function(){d(e),c.resolve()})}return c.promise},n.createNewExternalAudit=function(a){var b={project_id:a.id,is_new:!0};n.externalaudit=new h(b),n.externalaudits.push(n.externalaudit),n.documents_ea=[]},n.createNewDocumentEA=function(a){var b={external_audit_id:a.id,director_copy_no:1,is_new:!0};n.document_ea=new i(b),n.documents_ea.unshift(n.document_ea)},n.deleteExternalAudit=function(a){var b=_.findIndex(n.externalaudits,{id:n.externalaudit.id}),c=function(a){n.externalaudits.splice(a,1),n.externalaudit={}};n.externalaudit.is_new?c(b):n.externalaudit.$delete(a,function(){c(b)})},n.deleteDocumentEA=function(b){var c=a.defer(),d=function(a){n.documents_ea.splice(a,1),n.document_ea={}};if(n.document_ea.is_new)d(0);else{var e=_.findIndex(n.documents_ea,{id:n.document_ea.id});n.document_ea.$delete(b,function(){d(e),c.resolve()})}return c.promise},n.createNewAuditInspection=function(a,b,c,d,e){var f={project_id:a.id,year:b,type:c,reason:d,date_carried_out:e,days:1,status:70,performance_level:47,lead_officer:n.userinfo.info.id,is_new:!0};n.auditinspection=new j(f),n.auditsinspections.push(n.auditinspection)},n.deleteAuditInspection=function(a){var b=_.findIndex(n.auditsinspections,{id:n.auditinspection.id}),c=function(a){n.auditsinspections.splice(a,1),n.auditinspection=n.auditsinspections.length>0?n.auditinspection[0]:{}};n.auditinspection.is_new?c(b):n.auditinspection.$delete(a,function(){c(b)})},n.createNewPermitLicense=function(a,b,c,d,e,f,g,h,i){var j={project_id:a.id,regulation:b,ecosystem:c,regulation_activity:d,area:e,unit:f,approved_by_the_lc1:g,approved_by_the_dec:h,waste_license_type:i,is_new:!0};n.permitlicense=new m(j),n.permitslicenses.push(n.permitlicense)},n.deletePermitLicense=function(a){var b=_.findIndex(n.permitslicenses,{id:n.permitlicense.id}),c=function(a){n.permitslicenses.splice(a,1),n.permitlicense={}};n.permitlicense.is_new?c(b):n.permitlicense.$delete(a,function(){c(b)})},n.deleteProject=function(b){var c=a.defer(),d=function(){n.project={},c.resolve()};return n.project.is_new?d():n.project.$delete(b,function(){d()}),c.promise},n.save=function(b,c){var d=a.defer();if(c.is_new){var e=_.omit(b,function(a){return"new"==a});c.$save(e,function(a){d.resolve(a)},function(){d.reject("Saving new failed")})}else c.$update(b,function(a){d.resolve(a)},function(){d.reject("Saving exisiting failed")});return d.promise},n}]);var validations=angular.module("pax.validations");validations.directive("decimal",function(){return{require:"ngModel",link:function(a,b,c,d){var e=c.min?parseFloat(c.min):null,f=c.max?parseFloat(c.max):null,g=c.decimal?"{0,"+parseInt(c.decimal)+"}":"+",h=c.negativeNumber?"\\-?":"",i=new RegExp("^"+h+"\\d+((\\.|\\,)\\d"+g+")?$");d.$parsers.push(function(a){if(d.$isEmpty(a))return null;var b=a.toString().trim().replace(",","."),c=parseFloat(b);return d.$isEmpty(c)?void 0:c}),d.$formatters.push(function(a){if(!d.$isEmpty(a)&&c.decimal){var b=parseInt(c.decimal);return _.round(parseFloat(a),b).toFixed(b)}return a}),d.$validators.decimalInRange=function(a,b){return d.$isEmpty(a)?!0:i.test(b)?isNumberInRange(e,f,b):!1}}}}),validations.directive("integer",function(){return{require:"ngModel",link:function(a,b,c,d){var e=c.min?parseInt(c.min):null,f=c.max?parseInt(c.max):null,g=c.negativeNumber?"\\-?":"",h=new RegExp("^"+g+"\\d+$");d.$validators.integerInRange=function(a,b){return d.$isEmpty(a)?!0:h.test(b)?isNumberInRange(e,f,b):!1}}}}),validations.directive("certificateNumber",function(){return{require:"ngModel",link:function(a,b,c,d){var e=new RegExp("^CC/(EIA|EA|EP)/[0-9]{3}/[0-9]{2}$");d.$validators.certificateNumber=function(a,b){return d.$isEmpty(a)?!0:e.test(b)}}}});
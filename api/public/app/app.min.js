// Generated with grunt. Do not edit!

"use strict";function convertDateStringsToDates(a){if("object"!=typeof a)return a;for(var b in a)if(a.hasOwnProperty(b)){var c,d=a[b];if("string"==typeof d&&(c=d.match(regexIso8601))){var e=c[0].split(" ");a[b]=new Date(e[0])}else"object"==typeof d&&convertDateStringsToDates(d)}}function isNumberInRange(a,b,c){return null!==a&&a>c?!1:null!==b&&c>b?!1:!0}angular.$=angular.element,angular.$.prototype.parent=function(a){if(!a)return angular.$(this[0].parentNode);for(var b,c=[].slice.call(document.querySelectorAll(a)),d=this[0];"HTML"!==d.nodeName;){d=d.parentNode;var e=c.indexOf(d);-1===e||(b=d,d=document.documentElement)}return angular.$(b)};var debug=!0;angular.module("seroApp.services",[]),angular.module("seroApp.directives",[]),angular.module("seroApp.controllers",[]),angular.module("pax.validations",[]);var seroApp=angular.module("seroApp",["ngRoute","ngResource","ngAnimate","ngMessages","ui.bootstrap","ui.select2","ngFileUpload","seroApp.services","seroApp.directives","seroApp.controllers","pax.validations"]).config(["$routeProvider",function(a){var b={templateUrl:"partials/projectTabs.html",controller:"ProjectTabsController"};a.when("/",{templateUrl:"partials/home.html"}),a.when("/projects",{templateUrl:"partials/projects.html",controller:"ProjectsController"}),a.when("/projects/:projectId",b),a.when("/projects/:projectId/eiaspermits",b),a.when("/projects/:projectId/eiaspermits/:eiapermitId",b),a.when("/projects/:projectId/auditsinspections",b),a.when("/projects/:projectId/auditsinspections/:auditinspectionId",b),a.when("/projects/:projectId/reports",b),a.when("/about",{templateUrl:"partials/about.html"}),a.when("/login",{templateUrl:"partials/login.html",controller:"UserController"}),a.when("/password/send",{templateUrl:"partials/passwordSend.html",controller:"LoginController"}),a.when("/password/reset/:token",{templateUrl:"partials/passwordReset.html",controller:"LoginController"}),a.when("/user",{templateUrl:"partials/user.html",controller:"UserController"}),a.when("/practitioners",{templateUrl:"partials/practitioners.html",controller:"PractitionersController"}),a.otherwise({redirectTo:"/"})}]).factory("authHttpResponseInterceptor",["$q","$location",function(a,b){return{responseError:function(c){return 0==b.path().indexOf("/password/reset/")||401===c.status&&b.path("/login"),a.reject(c)}}}]).config(["$httpProvider",function(a){a.interceptors.push("authHttpResponseInterceptor")}]),SavingStateEnum={None:"None",LoadingNew:"Loading new",Loading:"Loading",Loaded:"Loaded",SavingStarted:"Saving started",SavingFinished:"Saving finished",SavingFailed:"Saving failed",Invalid:"Form not valid",MissingDependency:"Missing dependency in other form"},ProjectTabEnum={Project:"Project",EiasPermits:"Eias and Permits",AuditsInspections:"Audits and Inspections",Reports:"Reports"},fileUploadPattern="image/*,application/pdf,application/vnd.openxmlformats*,application/msword,text/plain,text/csv",regexIso8601=/^(\d{4}-\d{2}-\d{2} \d{2}\:\d{2}\:\d{2})$/;seroApp.config(["$httpProvider",function(a){a.defaults.transformResponse.push(function(a){return convertDateStringsToDates(a),a})}]);var uploadFile=function(a,b,c,d,e){d.$setValidity("serverError",!0);var f=a.defer();return e&&!e.$error?(e.upload=c.upload({url:"/file/v1/upload",file:e}),e.upload.then(function(a){b(function(){e.result=a.data,f.resolve(e)})},function(a){a.status>0&&(d.$setValidity("serverError",!1),e.progress=0,e.error=a.status+": "+a.data.message,f.reject(e.error))}),e.upload.progress(function(a){e.progress=Math.min(100,parseInt(100*a.loaded/a.total))})):f.reject("Validation error."),f.promise},controllers=angular.module("seroApp.controllers");controllers.controller("DatePickerController",["$scope",function(a){a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.datepickerOptions={startingDay:1}}]),controllers.controller("NavBarController",["$scope","$location","UserInfo",function(a,b,c){a.isActive=function(a){return a===b.path()},a.isAdvancedActive=function(a){return 0==b.path().indexOf(a)},a.userinfo=c}]),controllers.controller("UserController",["$scope","UserInfo",function(a,b){a.userinfo=b,a.userid_to_impersonate=null,a.impersonate=function(){a.userinfo.impersonate(a.userid_to_impersonate)}}]),controllers.controller("PractitionersController",["$scope","$filter","$animate","UserInfo","Practitioner","Valuelists",function(a,b,c,d,e,f){function g(a){}a.certificateYearMin=2e3,a.certificateYearMax=(new Date).getFullYear()+1,a.certificateYearValid=(new Date).getFullYear(),a.current=null,a.currentForm=null,a.userinfo=d,a.valuelists=f,a.practitioners=e.query();var h=function(a,c,d){if(!a)return!1;var e=function(a){return a.cert_type!=c?!1:a.year!==d?!1:a.is_deleted?!1:a.is_cancelled?!1:!0};return b("filter")(a,e,!0).length>0};a.hasEia=function(b){var c=h(b.practitioner_certificates,50,a.certificateYearValid);return b.cert_eia=c?"eia":null,c},a.hasAudit=function(b){var c=h(b.practitioner_certificates,51,a.certificateYearValid);return b.cert_au=c?"audit":null,c},a.hasPartnership=function(b){var c=h(b.practitioner_certificates,52,a.certificateYearValid);return b.cert_ep=c?"partnership":null,c},a.newPractitioner=function(){if(a.currentForm&&a.currentForm.$invalid)return void alert("Current form not valid. Can't create new practitioner.");var b={practitioner_certificates:[],is_new:!0},c=new e(b);a.practitioners.unshift(c),a.toggleRow(c)},a.deletePractitioner=function(b,c){a.current=null,c.is_new||c.$delete(),a.practitioners.splice(b,1)},a.deleteCertificate=function(a,b,c){c.is_new?b.practitioner_certificates.splice(a,1):c.is_deleted=!0},a.newCertificate=function(b){var c={year:a.certificateYearValid,date_of_entry:new Date,is_new:!0};c.cert_no=a.certificateNumber(c),b.practitioner_certificates.unshift(c)},a.canSave=function(){return a.userinfo.info.role_6};var i=function(b){a.canSave()&&(b.is_new?b.$save({},function(a){g(a),j()}):b.$update({},function(a){g(a),j()}))};a.toggleRow=function(b){if(!a.loading){if(a.canSave()&&a.current){var c=a.current,d=a.currentForm;if(d.$invalid)return void alert("Form not valid. Can't save.");d.$dirty&&(i(c),d.$setPristine())}a.current==b?a.current=null:b.is_new?a.current=b:(a.loading=b,b.$get({},function(c){g(c),a.loading=null,a.current=b}))}},a.setCurrentForm=function(b){a.currentForm=b},a.certificateNumber=function(b){var c="E",d=_.find(a.valuelists.practitionertype,{id:b.cert_no});d&&(c=d.description1);var e="XXX",f=b.year.toString().substr(2),g="CC/"+c+"/"+e+"/"+f;return g},a.changeNumericBoolean=function(a){return 0===a?1:0};var j=function(){};a.practitionerOrderBy=function(a){var b=a.person.trim().substring(a.person.trim().lastIndexOf(" "));return b}}]);var testy1="x";controllers.controller("ProjectsController",["$scope","$location","$filter","Project","UserInfo",function(a,b,c,d,e){a.showFilter=!1,a.projects=d.query({count:20}),a.projectsCount=0,d.query({countOnly:1},function(b){a.projectsCount=b[0]}),a.userinfo=e,a["goto"]=function(a){b.path(a)},a.canSave=function(){return a.userinfo.info.role_1},a.getAllProjects=function(){a.projects=d.query(),a.showFilter=!0}}]),controllers.controller("ProjectTabsController",["$scope","$routeParams","$location","$q","$timeout","ProjectFactory","UserInfo","Valuelists",function(a,b,c,d,e,f,g,h){a.SavingStateEnum=SavingStateEnum,a.ProjectTabEnum=ProjectTabEnum,a.routeParams=b,a.userinfo=g,a.valuelists=h,a.data=f;var i=function(a){return _.contains(a,"eiaspermits")?ProjectTabEnum.EiasPermits:_.contains(a,"auditsinspections")?ProjectTabEnum.AuditsInspections:_.contains(a,"reports")?ProjectTabEnum.Reports:ProjectTabEnum.Project};a.tab=i(c.path()),a["goto"]=function(a){e(function(){c.path(a)})},a.auth={},a.auth.canSave=function(){return!1},a.saveCurrent=function(b,c,e){if(e="undefined"!=typeof e?e:!1,b.saveInProgress&&b.isNew){var g=d.defer();return g.reject(),g.promise}b.saveInProgress=!0;var g=d.defer();if(b.form.$pristine&&!e)b.saveInProgress=!1,g.reject();else if(!b.form.$invalid||b.isNew&&e){b.state=b.isNew?SavingStateEnum.LoadingNew:SavingStateEnum.SavingStarted;var h=a.routeParams;e&&(h=_.omit(h,"auditinspectionId"),h=_.omit(h,"eiapermitId")),f.save(h,b.form,c).then(function(a){b.state=b.isNew?SavingStateEnum.LoadingNew:SavingStateEnum.SavingFinished,b.form.$setPristine(),b.saveInProgress=!1,g.resolve(a)},function(){b.state=SavingStateEnum.SavingFailed,b.saveInProgress=!1})}else b.state=SavingStateEnum.Invalid,b.saveInProgress=!1,g.reject();return g.promise}}]),controllers.controller("ProjectController",["$scope","$q","ProjectFactory","Organisation",function(a,b,c,d){if(a.selectOrganisationMode=!1,a.isNewProject=!1,a.parts={project:{form:null,state:SavingStateEnum.Loading},organisation:{form:null,state:SavingStateEnum.Loading}},a.newProjectExisitingOrganisation=function(b){a.selectOrganisationMode=!1,c.setOrganisation(b).then(function(){a.parts.organisation.state=SavingStateEnum.Loaded}),c.createNewProject(b),a.parts.project.state=SavingStateEnum.Loaded},a.newProjectNewOganisation=function(){a.selectOrganisationMode=!1,c.createNewOrganisation(),c.createNewProject(a.data.organisation),a.parts.project.state=SavingStateEnum.Loaded,a.parts.organisation.state=SavingStateEnum.Loaded,a.parts.organisation.isNew=!0},a.saveCurrentProject=function(){if(a.isNewProject)return void a.saveNewProjectAndNewOrganisation();var b=a.data.project;a.saveCurrent(a.parts.project,b).then(function(){})},a.saveCurrentOrganisation=function(){if(a.isNewProject)return void a.saveNewProjectAndNewOrganisation();var b=(a.data.project,a.data.organisation);a.saveCurrent(a.parts.organisation,b).then(function(){})},a.saveNewProjectAndNewOrganisation=function(){var b=a.parts.project,c=a.parts.organisation;if(b.form.$invalid)return a.parts.project.state=SavingStateEnum.Invalid,void(c.form.$dirty&&(a.parts.organisation.state=SavingStateEnum.MissingDependency));if(b.form.$valid&&c.form.$invalid)return a.parts.project.state=SavingStateEnum.MissingDependency,void(a.parts.organisation.state=SavingStateEnum.Invalid);if(b.form.$valid&&c.form.$valid){var d=a.data.project,e=a.data.organisation;c.form.$pristine?(d.organisation_id=e.id,a.saveCurrent(b,d).then(function(b){a["goto"]("/projects/"+b.id)})):a.saveCurrent(c,e).then(function(c){d.organisation_id=c.id,a.saveCurrent(b,d).then(function(b){a["goto"]("/projects/"+b.id)})})}},a.auth.canSave=function(){return a.userinfo.info.role_1},a.auth.canSaveGrade=function(){return a.userinfo.info.role_7},"new"==a.routeParams.projectId)a.selectOrganisationMode=!0,a.isNewProject=!0,a.parts.project.isNew=!0,c.empty(),a.organisations=d.query();else{var e=c.retrieveProjectData(a.routeParams);e[0].then(function(){a.parts.project.state=SavingStateEnum.Loaded}),e[1].then(function(){a.parts.organisation.state=SavingStateEnum.Loaded})}}]),controllers.controller("EiasPermitsController",["$scope","ProjectFactory","$timeout","Upload","$q",function(a,b,c,d,e){a.parts={eiapermit:{form:null,state:SavingStateEnum.Loading},document:{form:null,state:SavingStateEnum.None}},a.fileUploadPattern=fileUploadPattern,a.isLoading=function(){return a.parts.eiapermit.state==SavingStateEnum.Loading?a.hasEiaPermit()?!0:!1:a.parts.eiapermit.state==SavingStateEnum.LoadingNew},a.hasEiaPermit=function(){return!_.isEmpty(a.data.eiapermit)},a.saveCurrentEiaPermit=function(){var b=a.data.eiapermit,c=b.is_new;a.saveCurrent(a.parts.eiapermit,b,c).then(function(b){c&&a["goto"]("/projects/"+a.data.project.id+"/eiaspermits/"+b.id)})},a.saveCurrentDocument=function(){var b=a.data.document;a.saveCurrent(a.parts.document,b).then(function(){})},a.newEiaPermit=function(){a.parts.eiapermit.state=SavingStateEnum.LoadingNew,b.createNewEiaPermit(a.data.project),a.parts.eiapermit.isNew=!0,a.saveCurrentEiaPermit()},a.newDocument=function(){b.createNewDocument(a.data.eiapermit)},a.deleteEiaPermit=function(){b.deleteEiaPermit(a.routeParams),a["goto"]("/projects/"+a.data.project.id)},a.toggleDocument=function(b){a.showUploadingAttachment=!1,a.data.document==b?(a.data.document={},a.parts.document.state=SavingStateEnum.None):b.is_new?a.data.document=b:b.$get(a.routeParams,function(b){a.data.document=b})},a.calculateNumberOfCopiesOfDocument=function(){a.data.document.director_copy_no=1,a.data.document.coordinator_copy_no=a.data.document.sub_copy_no-1},a.calculateDocumentCode=function(){var b=_.find(a.valuelists.documenttype,{id:parseInt(a.data.document.type)}),c=b?b.description1:"",d=a.data.document.number?a.data.document.number:"";a.data.document.code=c+d},a.setDefaultDocumentConclusion=function(){a.data.document.conclusion=_.indexOf(["8","9"],a.data.document.type)>=0?80:81},a.auth.canSave=function(b){switch(b){case"new":case"delete":return a.userinfo.info.role_1;case"teamleader_id":case"practitioner_id":case"cost":case"cost_currency":case"status":case"document.date_submitted":case"document.sub_copy_no":case"document.title":case"document.type":case"document.number":case"document.code":case"document.consultent":case"document.director_copy_no":case"document.date_sent_director":case"document.coordinator_copy_no":case"document.date_copies_coordinator":case"document.date_next_appointment":case"document.date_sent_from_dep":case"document.folio_no":case"document.remarks":return a.userinfo.info.role_1;case"user_id":return a.userinfo.info.role_2;case"inspection_recommended":case"date_inspection":case"officer_recommend":case"fee":case"fee_currency":case"remarks":case"date_sent_ded_approval":case"document.sub_final":case"document.date_sent_officer":return a.userinfo.info.role_3;case"date_fee_notification":case"date_fee_payed":case"fee_receipt_no":return a.userinfo.info.role_4;case"decision":case"date_decision":case"designation":case"date_certificate":case"certificate_no":case"date_cancelled":case"document.conclusion":return a.userinfo.info.role_5;default:return!1}},a.isDisabledBasedOnRule=function(b){switch(b){case"document.conclusion":return 81==a.data.document.conclusion;default:return!1}},a.uploadAttachment=function(b){if(b){a.showUploadingAttachment=!0,a.attachmentFile=b[0];var f=uploadFile(e,c,d,a.parts.document.form.attachment,a.attachmentFile);f.then(function(b){a.data.document.file_metadata_id=b.result.id,a.parts.document.form.attachment.$setDirty(),a.saveCurrentDocument()},function(){})}},a.downloadFileUrl=function(a){return"/file/v1/download/"+a},a.deleteAttachment=function(){a.showUploadingAttachment=!1,a.data.document.file_metadata_id=null,a.parts.document.form.attachment.$setDirty(),a.saveCurrentDocument()};var f=b.retrieveProjectData(a.routeParams);f[2].then(function(b){if(b.length>0&&!a.routeParams.eiapermitId){var c=b[0];a["goto"]("/projects/"+a.data.project.id+"/eiaspermits/"+c.id)}}),f[3].then(function(){a.parts.eiapermit.state=SavingStateEnum.Loaded})}]);var controllers=angular.module("seroApp.controllers");controllers.controller("AuditsInspectionsController",["$scope","ProjectFactory","$timeout","Upload","$q",function(a,b,c,d,e){a.parts={auditinspection:{form:null,state:SavingStateEnum.Loading}},a.newButton={},a.newButton.year=(new Date).getFullYear(),a.fileUploadPattern=fileUploadPattern,a.isLoading=function(){return a.parts.auditinspection.state==SavingStateEnum.Loading?a.hasAuditInspection()?!0:!1:a.parts.auditinspection.state==SavingStateEnum.LoadingNew},a.hasAuditInspection=function(){return!_.isEmpty(a.data.auditinspection)},a.saveCurrentAuditInspection=function(){var b=a.data.auditinspection,c=b.is_new;a.saveCurrent(a.parts.auditinspection,b,c).then(function(b){c&&a["goto"]("/projects/"+a.data.project.id+"/auditsinspections/"+b.id)})},a.newAuditInspection=function(){a.parts.auditinspection.state=SavingStateEnum.LoadingNew,a.newButton.isopen=!1,b.createNewAuditInspection(a.data.project,a.newButton.year,a.newButton.type),a.parts.auditinspection.isNew=!0,a.saveCurrentAuditInspection()},a.deleteAuditInspection=function(){b.deleteAuditInspection(a.routeParams),a["goto"]("/projects/"+a.data.project.id)},a.auth.canSave=function(){return a.userinfo.info.role_7},a.uploadActionTakenLetter=function(b){if(b){a.showUploadingFileActionTakenLetter=!0,a.actionTakenLetterFile=b[0];var f=uploadFile(e,c,d,a.parts.auditinspection.form.action_taken_letter,a.actionTakenLetterFile);f.then(function(b){a.data.auditinspection.file_metadata_id=b.result.id,a.parts.auditinspection.form.action_taken_letter.$setDirty(),a.saveCurrentAuditInspection(),c(function(){a.showUploadingFileActionTakenLetter=!1},3e3)},function(){})}},a.uploadDocumentation=function(b){if(b){a.showUploadingFileDocumentation=!0,a.documentationFile=b[0];var f=uploadFile(e,c,d,a.parts.auditinspection.form.documentation,a.documentationFile);f.then(function(b){a.data.auditinspection.documentation_ids.push(b.result.id),a.parts.auditinspection.form.documentation.$setDirty(),a.saveCurrentAuditInspection(),c(function(){a.showUploadingFileDocumentation=!1},3e3)},function(){})}},a.downloadFileUrl=function(a){return"/file/v1/download/"+a},a.deleteActionTakenLetter=function(){a.data.auditinspection.file_metadata_id=null,a.parts.auditinspection.form.action_taken_letter.$setDirty(),a.saveCurrentAuditInspection()},a.deleteDocumentation=function(b){_.remove(a.data.auditinspection.documentation_ids,function(a){return a===b}),a.parts.auditinspection.form.documentation.$setDirty(),a.saveCurrentAuditInspection()};var f=b.retrieveProjectData(a.routeParams);f[4].then(function(b){if(b.length>0&&!a.routeParams.auditinspectionId){var c=b[0];a["goto"]("/projects/"+a.data.project.id+"/auditsinspections/"+c.id)}}),f[5].then(function(){a.parts.auditinspection.state=SavingStateEnum.Loaded})}]),controllers.controller("LoginController",["$scope","$http","$routeParams","$location","UserInfo",function(a,b,c,d,e){a.loginData={},a.sendData={},a.resetData={},a.loginMessages=[],a.sendMessages=[],a.resetMessages=[],a.loginFormDisabled=!1,a.sendFormDisabled=!1,a.resetFormDisabled=!1,a.forgot=function(){console.debug("/password/email")};var f=function(a){return _.flatten(_.values(a))};a.login=function(){a.loginForm.$invalid||(a.loginFormDisabled=!0,b.post("/auth/login",a.loginData).success(function(b){a.loginMessages=f(b),e.reTry(),d.path("/")}).error(function(b){a.loginMessages=f(b),a.loginFormDisabled=!1}))},a.send=function(){a.sendForm.$invalid||(a.sendFormDisabled=!0,b.post("/password/email",a.sendData).success(function(b){a.sendMessages=f(b)}).error(function(b){a.sendMessages=f(b),a.sendFormDisabled=!1}))},a.reset=function(){a.resetForm.$invalid||(a.resetFormDisabled=!0,a.resetData.token=c.token,b.post("/password/reset",a.resetData).success(function(b){a.resetMessages=f(b),e.reTry(),d.path("/user")}).error(function(b){a.resetMessages=f(b),a.resetFormDisabled=!1}))}}]);var directives=angular.module("seroApp.directives").directive("appVersion",["version",function(a){return function(b,c){c.text(_.trimRight(a,".0"))}}]);directives.directive("addPractitionerButton",["Practitioner",function(a){return{restrict:"A",link:function(b,c){c.bind("click",function(){var b=new a({person:"Gunnar Nymann",city:"Oslo"});b.$save()})}}}]),directives.directive("animateNewElement",["$animate",function(a){return function(b,c,d){b.$watch(d.animateNewElement,function(b){if(b===!0){console.log(c);var d="new-element";a.addClass(c,d,function(){a.removeClass(c,d)})}})}}]),directives.directive("hoverOnParent",[function(){return{restrict:"A",link:function(a,b,c){var d=c.hoverOnParent;b.parent(d).bind("mouseenter",function(){b.addClass("btn-link-hover")}),b.parent(d).bind("mouseleave",function(){b.removeClass("btn-link-hover")})}}}]),directives.directive("coordinatePasting",function(){return{require:"ngModel",link:function(a,b,c,d){console.log("here"),d.$setViewValue("0.12104"),d.$render()}}}),directives.directive("focus",function(){return function(a,b,c){c.$observe("focus",function(a){"true"===a&&b[0].focus()})}}),seroApp.filter("myDateFormat",function(a){return function(b){if(!b)return"tom";var c=new Date(b.replace(/-/g,"/"));return a("date")(c,"MMM-dd-yyyy")}});var version={version:"1.36.0"},services=angular.module("seroApp.services");services.value("version",version.version),services.factory("Practitioner",["$resource",function(a){return a("/api/v1/practitioner/:id",{id:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Project",["$resource",function(a){return a("/api/v1/project/:projectId",{projectId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Organisation",["$resource",function(a){return a("/api/v1/organisation/:organisationId",{organisationId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("EiaPermit",["$resource",function(a){return a("/api/v1/project/:projectId/eiapermit/:eiapermitId",{eiapermitId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Document",["$resource",function(a){return a("/api/v1/project/:projectId/eiapermit/:eiapermitId/document/:documentId",{documentId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("AuditInspection",["$resource",function(a){return a("/api/v1/project/:projectId/auditinspection/:auditinspectionId",{auditinspectionId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Valuelist",["$resource",function(a){return a("/api/v1/valuelist/:id",{id:"@id"})}]),services.factory("Valuelists",["Valuelist",function(a){return a.get({id:"all"})}]),services.factory("UserInfo",["$http","$location",function(a,b){var c={info:{}},d={name:"Not signed in",role_1:!1,role_2:!1,role_3:!1,role_4:!1,role_5:!1,role_6:!1,role_7:!1,role_8:!1,roles:[]},e=function(a){a?(_.merge(c.info,a),"/login"==b.path()&&b.path("/")):c.info=_.cloneDeep(d)},f=function(){a.get("/user/info").success(e)};return c.impersonate=function(b){e(null),a.get("/user/impersonate/"+b).success(e)},c.signout=function(){a.get("/auth/logout").success(function(){e(null),b.path("/login")})},c.getAllUsers=function(){a.get("/user/all").success(function(a){c.allusers=a})},c.reTry=function(){f()},e(null),f(),c}]),services.factory("ProjectFactory",["$q","$filter","Project","Organisation","EiaPermit","Document","AuditInspection","Valuelists",function(a,b,c,d,e,f,g,h){var i={};return i.project={},i.organisation={},i.eiaspermits=[],i.eiapermit={},i.documents=[],i.document={},i.auditsinspections=[],i.auditinspection={},i.valuelists=h,i.retrieveProjectData=function(b){var f=a.defer(),h=a.defer(),j=a.defer(),k=a.defer(),l=a.defer(),m=a.defer();return i.project.id!=b.projectId?(i.empty(),i.project=c.get(b,function(a){f.resolve(a),i.organisation=d.get({organisationId:a.organisation_id},function(a){h.resolve(a)})}),i.eiaspermits=e.query(_.omit(b,"eiapermitId"),function(a){i.retrieveEiaPermit(b).then(function(a){k.resolve(a)}),j.resolve(a)}),i.auditsinspections=g.query(_.omit(b,"auditinspectionId"),function(a){i.retrieveAuditInspection(b).then(function(a){m.resolve(a)}),l.resolve(a)})):(f.resolve(i.project),h.resolve(i.organisation),i.retrieveEiaPermit(b).then(function(a){k.resolve(a)}),j.resolve(i.eiaspermits),i.retrieveAuditInspection(b).then(function(a){m.resolve(a)}),l.resolve(i.auditsinspections)),[f.promise,h.promise,j.promise,k.promise,l.promise,m.promise]},i.retrieveEiaPermit=function(c){var d=a.defer();if(c.eiapermitId){var e=b("filter")(i.eiaspermits,{id:c.eiapermitId});1==e.length&&(i.eiapermit=e[0],i.eiapermit.$get(c,function(a){i.documents=f.query(c,function(){}),d.resolve(a)}))}return d.promise},i.retrieveAuditInspection=function(c){var d=a.defer();if(c.auditinspectionId){var e=b("filter")(i.auditsinspections,{id:c.auditinspectionId});1==e.length&&(i.auditinspection=e[0],i.auditinspection.$get(c,function(a){d.resolve(a)}))}return d.promise},i.getProjectSummary=function(a){var b=i.project;return b.title?a==ProjectTabEnum.AuditsInspections?b.title+" (Grade: "+i.getCodeFromValuelist("grade",b.grade)+")":b.title:""},i.getEiaPermitSummary=function(a){var a=a||i.eiapermit;return _.isEmpty(a)?"":"Status: "+i.getCodeFromValuelist("eiastatus",a.status)},i.getAuditInspectionSummary=function(a){var a=a||i.auditinspection;return _.isEmpty(a)?"":"Number "+a.year+": "+i.getCodeFromValuelist("auditinspectionstatus",a.status)},i.getCodeFromValuelist=function(a,b){var c=_.find(i.valuelists[a],{id:b});return c?c.description1:""},i.setOrganisation=function(b){var c=a.defer();return i.organisation=b,b.$get({},function(a){c.resolve(a)}),c.promise},i.setEiaPermit=function(b){var c=a.defer();return i.eiapermit=b,c.resolve(b),c.promise},i.setAuditInspection=function(b){var c=a.defer();return i.auditinspection=b,c.resolve(b),c.promise},i.empty=function(){i.project={},i.organisation={},i.eiaspermits=[],i.eiapermit={},i.documents=[],i.document={},i.auditsinspections=[],i.auditinspection={}},i.createNewProject=function(a){var b={has_industrial_waste_water:41,grade:47,organisation_id:a.id,is_new:!0};i.project=new c(b)},i.createNewOrganisation=function(){var a={is_new:!0};i.organisation=new d(a)},i.createNewEiaPermit=function(a){var b={project_id:a.id,is_new:!0};i.eiapermit=new e(b),i.eiaspermits.push(i.eiapermit)},i.createNewDocument=function(a){var b={eia_permit_id:a.id,sub_final:42,director_copy_no:1,is_new:!0};i.document=new f(b),i.documents.unshift(i.document)},i.deleteEiaPermit=function(a){var b=_.findIndex(i.eiaspermits,{id:i.eiapermit.id}),c=function(a){i.eiaspermits.splice(a,1),i.eiapermit=i.eiaspermits.length>0?i.eiaspermits[0]:{}};i.eiapermit.is_new?c(b):i.eiapermit.$delete(a,function(){c(b)})},i.createNewAuditInspection=function(a,b,c){var d={project_id:a.id,year:b,type:c,days:1,status:70,is_new:!0};i.auditinspection=new g(d),i.auditsinspections.push(i.auditinspection)},i.deleteAuditInspection=function(a){var b=_.findIndex(i.auditsinspections,{id:i.auditinspection.id}),c=function(a){i.auditsinspections.splice(a,1),i.auditinspection=i.auditsinspections.length>0?i.auditinspection[0]:{}};i.auditinspection.is_new?c(b):i.auditinspection.$delete(a,function(){c(b)})},i.save=function(b,c,d){var e=a.defer();if(d.is_new){var f=_.omit(b,function(a){return"new"==a});d.$save(f,function(a){e.resolve(a)},function(){e.reject("Saving new failed")})}else d.$update(b,function(a){e.resolve(a)},function(){e.reject("Saving exisiting failed")});return e.promise},i}]);var validations=angular.module("pax.validations");validations.directive("decimal",function(){return{require:"ngModel",link:function(a,b,c,d){var e=c.min?parseFloat(c.min):null,f=c.max?parseFloat(c.max):null,g=c.decimal?"{0,"+parseInt(c.decimal)+"}":"+",h=c.negativeNumber?"\\-?":"",i=new RegExp("^"+h+"\\d+((\\.|\\,)\\d"+g+")?$");d.$parsers.push(function(a){if(d.$isEmpty(a))return null;var b=a.toString().trim().replace(",","."),c=parseFloat(b);return d.$isEmpty(c)?void 0:c}),d.$formatters.push(function(a){if(!d.$isEmpty(a)&&c.decimal){var b=parseInt(c.decimal);return _.round(parseFloat(a),b).toFixed(b)}return a}),d.$validators.decimalInRange=function(a,b){return d.$isEmpty(a)?!0:i.test(b)?isNumberInRange(e,f,b):!1}}}}),validations.directive("integer",function(){return{require:"ngModel",link:function(a,b,c,d){var e=c.min?parseInt(c.min):null,f=c.max?parseInt(c.max):null,g=c.negativeNumber?"\\-?":"",h=new RegExp("^"+g+"\\d+$");d.$validators.integerInRange=function(a,b){return d.$isEmpty(a)?!0:h.test(b)?isNumberInRange(e,f,b):!1}}}}),validations.directive("certificateNumber",function(){return{require:"ngModel",link:function(a,b,c,d){var e=new RegExp("^CC/(EIA|EA|EP)/[0-9]{3}/[0-9]{2}$");d.$validators.certificateNumber=function(a,b){return d.$isEmpty(a)?!0:e.test(b)}}}});
// Generated with grunt. Do not edit!

"use strict";function convertDateStringsToDates(a){if("object"!=typeof a)return a;for(var b in a)if(a.hasOwnProperty(b)){var c,d=a[b];if("string"==typeof d&&(c=d.match(regexIso8601))){var e=c[0].split(" ");a[b]=e[0]}else"object"==typeof d&&convertDateStringsToDates(d)}}function isNumberInRange(a,b,c){return null!==a&&a>c?!1:null!==b&&c>b?!1:!0}angular.$=angular.element,angular.$.prototype.parent=function(a){if(!a)return angular.$(this[0].parentNode);for(var b,c=[].slice.call(document.querySelectorAll(a)),d=this[0];"HTML"!==d.nodeName;){d=d.parentNode;var e=c.indexOf(d);-1===e||(b=d,d=document.documentElement)}return angular.$(b)};var debug=!0,seroApp=angular.module("seroApp",["ngRoute","ngResource","ngAnimate","ui.bootstrap","ui.select2","seroApp.services","seroApp.directives","seroApp.controllers","pax.validations"]).config(["$routeProvider",function(a){var b={templateUrl:"partials/projectTabs.html",controller:"ProjectTabsController"};a.when("/",{templateUrl:"partials/home.html"}),a.when("/projects",{templateUrl:"partials/projects.html",controller:"ProjectsController"}),a.when("/projects/:projectId",b),a.when("/projects/:projectId/eiaspermits",b),a.when("/projects/:projectId/eiaspermits/:eiapermitId",b),a.when("/projects/:projectId/auditsinspections",b),a.when("/projects/:projectId/reports",b),a.when("/about",{templateUrl:"partials/about.html"}),a.when("/login",{templateUrl:"partials/login.html",controller:"UserController"}),a.when("/password/send",{templateUrl:"partials/passwordSend.html",controller:"LoginController"}),a.when("/password/reset/:token",{templateUrl:"partials/passwordReset.html",controller:"LoginController"}),a.when("/user",{templateUrl:"partials/user.html",controller:"UserController"}),a.when("/practitioners",{templateUrl:"partials/practitioners.html",controller:"PractitionersController"}),a.otherwise({redirectTo:"/"})}]).factory("authHttpResponseInterceptor",["$q","$location",function(a,b){return{responseError:function(c){return b.path().startsWith("/password/reset/")||401===c.status&&b.path("/login"),a.reject(c)}}}]).config(["$httpProvider",function(a){a.interceptors.push("authHttpResponseInterceptor")}]),SavingStateEnum={None:"None",Loading:"Loading",Loaded:"Loaded",SavingStarted:"Saving started",SavingFinished:"Saving finished",SavingFailed:"Saving failed",Invalid:"Form not valid",MissingDependency:"Missing dependency in other form"},ProjectTabEnum={Project:"Project",EiasPermits:"Eias and Permits",AuditsInspections:"Audits and Inspections",Reports:"Reports"},regexIso8601=/^(\d{4}-\d{2}-\d{2} \d{2}\:\d{2}\:\d{2})$/;seroApp.config(["$httpProvider",function(a){a.defaults.transformResponse.push(function(a){return convertDateStringsToDates(a),a})}]);var controllers=angular.module("seroApp.controllers",[]);controllers.controller("DatePickerController",["$scope",function(a){a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.datepickerOptions={startingDay:1}}]),controllers.controller("NavBarController",["$scope","$location","UserInfo",function(a,b,c){a.isActive=function(a){return a===b.path()},a.isAdvancedActive=function(a){return 0==b.path().indexOf(a)},a.userinfo=c}]),controllers.controller("UserController",["$scope","UserInfo",function(a,b){a.userinfo=b,a.userid_to_impersonate=null,a.impersonate=function(){a.userinfo.impersonate(a.userid_to_impersonate)}}]),controllers.controller("PractitionersController",["$scope","$filter","$animate","UserInfo","Practitioner","Valuelists",function(a,b,c,d,e,f){function g(a){}a.certificateYearMin=2e3,a.certificateYearMax=(new Date).getFullYear()+1,a.certificateYearValid=(new Date).getFullYear(),a.current=null,a.currentForm=null,a.userinfo=d,a.valuelists=f,a.practitioners=e.query();var h=function(a,c,d){if(!a)return!1;var e=function(a){return a.cert_type!=c?!1:a.year!==d?!1:a.is_deleted?!1:a.is_cancelled?!1:!0};return b("filter")(a,e,!0).length>0};a.hasEia=function(b){var c=h(b.practitioner_certificates,50,a.certificateYearValid);return b.cert_eia=c?"eia":null,c},a.hasAudit=function(b){var c=h(b.practitioner_certificates,51,a.certificateYearValid);return b.cert_au=c?"audit":null,c},a.hasPartnership=function(b){var c=h(b.practitioner_certificates,52,a.certificateYearValid);return b.cert_ep=c?"partnership":null,c},a.newPractitioner=function(){if(a.currentForm&&a.currentForm.$invalid)return void alert("Current form not valid. Can't create new practitioner.");var b={practitioner_certificates:[],is_new:!0},c=new e(b);a.practitioners.unshift(c),a.toggleRow(c)},a.deletePractitioner=function(b,c){a.current=null,c.is_new||c.$delete(),a.practitioners.splice(b,1)},a.deleteCertificate=function(a,b,c){c.is_new?b.practitioner_certificates.splice(a,1):c.is_deleted=!0},a.newCertificate=function(b){var c={year:a.certificateYearValid,date_of_entry:new Date,is_new:!0};c.cert_no=a.certificateNumber(c),b.practitioner_certificates.unshift(c)},a.canSave=function(){return a.userinfo.info.role_6};var i=function(b){a.canSave()&&(b.is_new?b.$save({},function(a){g(a),j()}):b.$update({},function(a){g(a),j()}))};a.toggleRow=function(b){if(!a.loading){if(a.canSave()&&a.current){var c=a.current,d=a.currentForm;if(d.$invalid)return void alert("Form not valid. Can't save.");d.$dirty&&(i(c),d.$setPristine())}a.current==b?a.current=null:b.is_new?a.current=b:(a.loading=b,b.$get({},function(c){g(c),a.loading=null,a.current=b}))}},a.setCurrentForm=function(b){a.currentForm=b},a.certificateNumber=function(b){var c="E",d=_.find(a.valuelists.practitionertype,{id:b.cert_no});d&&(c=d.description1);var e="XXX",f=b.year.toString().substr(2),g="CC/"+c+"/"+e+"/"+f;return g},a.changeNumericBoolean=function(a){return 0===a?1:0};var j=function(){};a.practitionerOrderBy=function(a){var b=a.person.trim().substring(a.person.trim().lastIndexOf(" "));return b}}]);var testy1="x";controllers.controller("ProjectsController",["$scope","$location","$filter","Project","UserInfo",function(a,b,c,d,e){a.showFilter=!1,a.projects=d.query({count:20}),a.projectsCount=0,d.query({countOnly:1},function(b){a.projectsCount=b[0]}),a.userinfo=e,a["goto"]=function(a){b.path(a)},a.canSave=function(){return a.userinfo.info.role_1},a.getAllProjects=function(){a.projects=d.query(),a.showFilter=!0}}]),controllers.controller("ProjectTabsController",["$scope","$routeParams","$location","$q","$timeout","ProjectFactory","UserInfo","Valuelists",function(a,b,c,d,e,f,g,h){a.SavingStateEnum=SavingStateEnum,a.ProjectTabEnum=ProjectTabEnum,a.routeParams=b,a.userinfo=g,a.valuelists=h,a.data=f;var i=function(a){return _.contains(a,"eiaspermits")?ProjectTabEnum.EiasPermits:_.contains(a,"auditsinspections")?ProjectTabEnum.AuditsInspections:_.contains(a,"reports")?ProjectTabEnum.Reports:ProjectTabEnum.Project};a.tab=i(c.path()),a["goto"]=function(a){e(function(){c.path(a)})},a.auth={},a.auth.canSave=function(){return!1},a.saveCurrent=function(b,c){if(b.saveInProgress&&b.isNew){var e=d.defer();return e.reject(),e.promise}b.saveInProgress=!0;var e=d.defer();return b.form.$pristine?(b.saveInProgress=!1,e.reject()):b.form.$invalid?(b.state=SavingStateEnum.Invalid,b.saveInProgress=!1,e.reject()):(b.state=SavingStateEnum.SavingStarted,f.save(a.routeParams,b.form,c).then(function(a){b.state=SavingStateEnum.SavingFinished,b.form.$setPristine(),b.saveInProgress=!1,e.resolve(a)},function(){b.state=SavingStateEnum.SavingFailed,b.saveInProgress=!1})),e.promise}}]),controllers.controller("ProjectController",["$scope","$q","ProjectFactory","Organisation",function(a,b,c,d){if(a.selectOrganisationMode=!1,a.isNewProject=!1,a.parts={project:{form:null,state:SavingStateEnum.Loading},organisation:{form:null,state:SavingStateEnum.Loading}},a.newProjectExisitingOrganisation=function(b){a.selectOrganisationMode=!1,c.setOrganisation(b).then(function(){a.parts.organisation.state=SavingStateEnum.Loaded}),c.createNewProject(b),a.parts.project.state=SavingStateEnum.Loaded},a.newProjectNewOganisation=function(){a.selectOrganisationMode=!1,c.createNewOrganisation(),c.createNewProject(a.data.organisation),a.parts.project.state=SavingStateEnum.Loaded,a.parts.organisation.state=SavingStateEnum.Loaded,a.parts.organisation.isNew=!0},a.saveCurrentProject=function(){if(a.isNewProject)return void a.saveNewProjectAndNewOrganisation();var b=a.data.project;a.saveCurrent(a.parts.project,b).then(function(){})},a.saveCurrentOrganisation=function(){if(a.isNewProject)return void a.saveNewProjectAndNewOrganisation();var b=(a.data.project,a.data.organisation);a.saveCurrent(a.parts.organisation,b).then(function(){})},a.saveNewProjectAndNewOrganisation=function(){var b=a.parts.project,c=a.parts.organisation;if(b.form.$invalid)return a.parts.project.state=SavingStateEnum.Invalid,void(c.form.$dirty&&(a.parts.organisation.state=SavingStateEnum.MissingDependency));if(b.form.$valid&&c.form.$invalid)return a.parts.project.state=SavingStateEnum.MissingDependency,void(a.parts.organisation.state=SavingStateEnum.Invalid);if(b.form.$valid&&c.form.$valid){var d=a.data.project,e=a.data.organisation;c.form.$pristine?(d.organisation_id=e.id,a.saveCurrent(b,d).then(function(b){a["goto"]("/projects/"+b.id)})):a.saveCurrent(c,e).then(function(c){d.organisation_id=c.id,a.saveCurrent(b,d).then(function(b){a["goto"]("/projects/"+b.id)})})}},a.auth.canSave=function(){return a.userinfo.info.role_1},a.auth.canSaveGrade=function(){return a.userinfo.info.role_7},"new"==a.routeParams.projectId)a.selectOrganisationMode=!0,a.isNewProject=!0,a.parts.project.isNew=!0,c.empty(),a.organisations=d.query();else{var e=c.retrieveProjectData(a.routeParams);e[0].then(function(){a.parts.project.state=SavingStateEnum.Loaded}),e[1].then(function(){a.parts.organisation.state=SavingStateEnum.Loaded})}}]),controllers.controller("EiasPermitsController",["$scope","ProjectFactory",function(a,b){a.isNewEiaPermit=!1,a.parts={eiapermit:{form:null,state:SavingStateEnum.Loading},document:{form:null,state:SavingStateEnum.None}},a.hasEiaPermit=function(){return!_.isEmpty(a.data.eiapermit)},a.saveCurrentEiaPermit=function(){var b=a.data.eiapermit;a.saveCurrent(a.parts.eiapermit,b).then(function(b){a.isNewEiaPermit&&a["goto"]("/projects/"+a.data.project.id+"/eiaspermits/"+b.id)})},a.saveCurrentDocument=function(){var b=a.data.document;a.saveCurrent(a.parts.document,b).then(function(){})},a.newDocument=function(){b.createNewDocument(a.data.eiapermit)},a.deleteEiaPermit=function(){b.deleteEiaPermit(a.routeParams),a["goto"]("/projects/"+a.data.project.id)},a.toggleDocument=function(b){a.data.document==b?(a.data.document={},a.parts.document.state=SavingStateEnum.None):b.is_new?a.data.document=b:b.$get(a.routeParams,function(b){a.data.document=b})},a.calculateNumberOfCopiesOfDocument=function(){a.data.document.director_copy_no=1,a.data.document.coordinator_copy_no=a.data.document.sub_copy_no-1},a.calculateDocumentCode=function(){var b=_.find(a.valuelists.documenttype,{id:parseInt(a.data.document.type)}),c=b?b.description1:"",d=a.data.document.number?a.data.document.number:"";a.data.document.code=c+d},a.auth.canSave=function(b){switch(b){case"new":case"delete":return a.userinfo.info.role_1;case"teamleader_id":case"practitioner_id":case"cost":case"cost_currency":case"status":case"document.date_submitted":case"document.sub_copy_no":case"document.title":case"document.type":case"document.number":case"document.code":case"document.consultent":case"document.director_copy_no":case"document.date_sent_director":case"document.coordinator_copy_no":case"document.date_copies_coordinator":case"document.date_next_appointment":case"document.date_sent_from_dep":case"document.folio_no":case"document.remarks":return a.userinfo.info.role_1;case"user_id":return a.userinfo.info.role_2;case"inspection_recommended":case"date_inspection":case"officer_recommend":case"fee":case"fee_currency":case"remarks":case"date_sent_ded_approval":case"document.sub_final":case"document.date_sent_officer":return a.userinfo.info.role_3;case"date_fee_notification":case"date_fee_payed":case"fee_receipt_no":return a.userinfo.info.role_4;case"decision":case"date_decision":case"designation":case"date_certificate":case"certificate_no":case"date_cancelled":case"document.conclusion":return a.userinfo.info.role_5;default:return!1}};var c=b.retrieveProjectData(a.routeParams);c[3].then(function(){a.parts.eiapermit.state=SavingStateEnum.Loaded}),"new"==a.routeParams.eiapermitId&&(b.createNewEiaPermit(a.data.project),a.isNewEiaPermit=!0,a.parts.eiapermit.state=SavingStateEnum.Loaded,a.parts.eiapermit.isNew=!0)}]),controllers.controller("LoginController",["$scope","$http","$routeParams","$location","UserInfo",function(a,b,c,d,e){a.loginData={},a.sendData={},a.resetData={},a.loginMessages=[],a.sendMessages=[],a.resetMessages=[],a.loginFormDisabled=!1,a.sendFormDisabled=!1,a.resetFormDisabled=!1,a.forgot=function(){console.debug("/password/email")};var f=function(a){return _.flatten(_.values(a))};a.login=function(){a.loginForm.$invalid||(a.loginFormDisabled=!0,b.post("/auth/login",a.loginData).success(function(b){a.loginMessages=f(b),e.reTry(),d.path("/")}).error(function(b){a.loginMessages=f(b),a.loginFormDisabled=!1}))},a.send=function(){a.sendForm.$invalid||(a.sendFormDisabled=!0,b.post("/password/email",a.sendData).success(function(b){a.sendMessages=f(b)}).error(function(b){a.sendMessages=f(b),a.sendFormDisabled=!1}))},a.reset=function(){a.resetForm.$invalid||(a.resetFormDisabled=!0,a.resetData.token=c.token,b.post("/password/reset",a.resetData).success(function(b){a.resetMessages=f(b),e.reTry(),d.path("/user")}).error(function(b){a.resetMessages=f(b),a.resetFormDisabled=!1}))}}]);var directives=angular.module("seroApp.directives",[]).directive("appVersion",["version",function(a){return function(b,c){c.text(a)}}]);directives.directive("addPractitionerButton",["Practitioner",function(a){return{restrict:"A",link:function(b,c){c.bind("click",function(){var b=new a({person:"Gunnar Nymann",city:"Oslo"});b.$save()})}}}]),directives.directive("animateNewElement",["$animate",function(a){return function(b,c,d){b.$watch(d.animateNewElement,function(b){if(b===!0){console.log(c);var d="new-element";a.addClass(c,d,function(){a.removeClass(c,d)})}})}}]),directives.directive("hoverOnParent",[function(){return{restrict:"A",link:function(a,b,c){var d=c.hoverOnParent;b.parent(d).bind("mouseenter",function(){b.addClass("btn-link-hover")}),b.parent(d).bind("mouseleave",function(){b.removeClass("btn-link-hover")})}}}]),directives.directive("coordinatePasting",function(){return{require:"ngModel",link:function(a,b,c,d){console.log("here"),d.$setViewValue("0.12104"),d.$render()}}}),directives.directive("focus",function(){return function(a,b,c){c.$observe("focus",function(a){"true"===a&&b[0].focus()})}}),seroApp.filter("myDateFormat",function(a){return function(b){if(!b)return"tom";var c=new Date(b.replace(/-/g,"/"));return a("date")(c,"MMM-dd-yyyy")}});var version={version:"0.1.9"},services=angular.module("seroApp.services",[]);services.value("version",version.version),services.factory("Practitioner",["$resource",function(a){return a("/api/v1/practitioner/:id",{id:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Project",["$resource",function(a){return a("/api/v1/project/:projectId",{projectId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Organisation",["$resource",function(a){return a("/api/v1/organisation/:organisationId",{organisationId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("EiaPermit",["$resource",function(a){return a("/api/v1/project/:projectId/eiapermit/:eiapermitId",{eiapermitId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Document",["$resource",function(a){return a("/api/v1/project/:projectId/eiapermit/:eiapermitId/document/:documentId",{documentId:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Valuelist",["$resource",function(a){return a("/api/v1/valuelist/:id",{id:"@id"})}]),services.factory("Valuelists",["Valuelist",function(a){return a.get({id:"all"})}]),services.factory("UserInfo",["$http","$location",function(a,b){var c={info:{}},d={name:"Not signed in",role_1:!1,role_2:!1,role_3:!1,role_4:!1,role_5:!1,role_6:!1,role_7:!1,role_8:!1,roles:[]},e=function(a){a?(_.merge(c.info,a),"/login"==b.path()&&b.path("/")):c.info=_.cloneDeep(d)},f=function(){a.get("/user/info").success(e)};return c.impersonate=function(b){e(null),a.get("/user/impersonate/"+b).success(e)},c.signout=function(){a.get("/auth/logout").success(function(){e(null),b.path("/login")})},c.getAllUsers=function(){a.get("/user/all").success(function(a){c.allusers=a})},c.reTry=function(){f()},e(null),f(),c}]),services.factory("ProjectFactory",["$q","$filter","Project","Organisation","EiaPermit","Document","Valuelists",function(a,b,c,d,e,f,g){var h={};return h.project={},h.organisation={},h.eiaspermits=[],h.eiapermit={},h.documents=[],h.document={},h.valuelists=g,h.retrieveProjectData=function(b){var f=a.defer(),g=a.defer(),i=a.defer(),j=a.defer();return h.project.id!=b.projectId?(h.empty(),h.project=c.get(b,function(a){f.resolve(a),h.organisation=d.get({organisationId:a.organisation_id},function(a){g.resolve(a)})}),h.eiaspermits=e.query(_.omit(b,"eiapermitId"),function(a){h.retrieveEiaPermit(b).then(function(a){j.resolve(a)}),i.resolve(a)})):(f.resolve(h.project),g.resolve(h.organisation),h.retrieveEiaPermit(b).then(function(a){j.resolve(a)}),i.resolve(h.eiaspermits)),[f.promise,g.promise,i.promise,j.promise]},h.retrieveEiaPermit=function(c){var d=a.defer();if(c.eiapermitId){var e=b("filter")(h.eiaspermits,{id:c.eiapermitId});1==e.length&&(h.eiapermit=e[0],h.eiapermit.$get(c,function(a){h.documents=f.query(c,function(){}),d.resolve(a)}))}else h.eiaspermits.length>0&&_.isEmpty(h.eiapermit)&&(h.eiapermit=h.eiaspermits[0]);return d.promise},h.getEiapermitSummary=function(a){var a=a||h.eiapermit;if(_.isEmpty(a))return"";var b="",c=_.find(h.valuelists.status,{id:a.status});return c&&(b=c.description1),"Status: "+b},h.setOrganisation=function(b){var c=a.defer();return h.organisation=b,b.$get({},function(a){c.resolve(a)}),c.promise},h.setEiaPermit=function(b){var c=a.defer();return h.eiapermit=b,c.resolve(b),c.promise},h.empty=function(){h.project={},h.organisation={},h.eiaspermits=[],h.eiapermit={},h.documents=[],h.document={}},h.createNewProject=function(a){var b={has_industrial_waste_water:41,organisation_id:a.id,is_new:!0};h.project=new c(b)},h.createNewOrganisation=function(){var a={is_new:!0};h.organisation=new d(a)},h.createNewEiaPermit=function(a){var b={project_id:a.id,is_new:!0};h.eiapermit=new e(b),h.eiaspermits.push(h.eiapermit)},h.createNewDocument=function(a){var b={eia_permit_id:a.id,sub_final:42,director_copy_no:1,is_new:!0};h.document=new f(b),h.documents.unshift(h.document)},h.deleteEiaPermit=function(a){var b=_.findIndex(h.eiaspermits,{id:h.eiapermit.id});h.eiapermit.$delete(a,function(){h.eiaspermits.splice(b,1),h.eiapermit=h.eiaspermits.length>0?h.eiaspermits[0]:{}})},h.save=function(b,c,d){var e=a.defer();if(d.is_new){var f=_.omit(b,function(a){return"new"==a});d.$save(f,function(a){e.resolve(a)},function(){e.reject("Saving new failed")})}else d.$update(b,function(a){e.resolve(a)},function(){e.reject("Saving exisiting failed")});return e.promise},h}]);var validations=angular.module("pax.validations",[]);validations.directive("decimal",function(){return{require:"ngModel",link:function(a,b,c,d){var e=c.min?parseFloat(c.min):null,f=c.max?parseFloat(c.max):null,g=c.decimal?"{0,"+parseInt(c.decimal)+"}":"+",h=c.negativeNumber?"\\-?":"",i=new RegExp("^"+h+"\\d+((\\.|\\,)\\d"+g+")?$");d.$parsers.unshift(function(a){if(null==a||""===a)return void d.$setValidity("float",!0);if(i.test(a)){var b=a;if("number"!=typeof a&&(b=parseFloat(a.replace(",","."))),isNumberInRange(e,f,b))return d.$setValidity("float",!0),b}return void d.$setValidity("float",!1)}),d.$formatters.push(function(a){if(null==a||""===a)return void d.$setValidity("float",!0);if(i.test(a)){var b=a;if("number"!=typeof a&&(b=parseFloat(a.replace(",","."))),isNumberInRange(e,f,b))return d.$setValidity("float",!0),b}return d.$setValidity("float",!1),a})}}}),validations.directive("integer",function(){return{require:"ngModel",link:function(a,b,c,d){var e=c.min?parseInt(c.min):null,f=c.max?parseInt(c.max):null,g=c.negativeNumber?"\\-?":"",h=new RegExp("^"+g+"\\d+$");d.$parsers.unshift(function(a){if(null==a||""===a)return void d.$setValidity("integer",!0);if(h.test(a)){var b=parseInt(a);if(isNumberInRange(e,f,b))return d.$setValidity("integer",!0),b}return void d.$setValidity("integer",!1)}),d.$formatters.push(function(a){if(null==a||""===a)return void d.$setValidity("integer",!0);if(h.test(a)){var b=parseInt(a);if(isNumberInRange(e,f,b))return d.$setValidity("integer",!0),b}return d.$setValidity("integer",!1),a})}}}),validations.directive("certificateNumber",function(){return{require:"ngModel",link:function(a,b,c,d){var e=new RegExp("^CC/(EIA|EA|EP)/[0-9]{3}/[0-9]{2}$");d.$parsers.unshift(function(a){return null==a||""===a?void d.$setValidity("certificate-number",!0):e.test(a)?(d.$setValidity("certificate-number",!0),a):void d.$setValidity("certificate-number",!1)}),d.$formatters.push(function(a){return null==a||""===a?void d.$setValidity("certificate-number",!0):e.test(a)?(d.$setValidity("certificate-number",!0),a):(d.$setValidity("certificate-number",!1),a)})}}});
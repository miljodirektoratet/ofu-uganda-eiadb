<div class="project-permitslicenses">

    <div class="row">
        <div class="col-md-12">
            <div class="edit-container">
                <div class="row header visible-md visible-lg">
                    <div class="col-md-12">
                        <table class="table">
                            <thead>
                            <tr>
                                <th>Id</th>
                                <th>Status</th>
                                <th>Date of submission</th>
                                <th>Regulation</th>
                                <th>Team leader</th>
                                <th>Decision taken</th>
                                <th>Date on permit/license</th>
                                <th>
                                    <div class="btn-group new-button pull-right" dropdown auto-close="disabled" is-open="newButton.isopen" ng-hide="!auth.canSave('new')">
                                        <button type="button" class="btn btn-xs btn-success pull-right" dropdown-toggle ng-disabled="notOkToEditOrCreateNew()" ng-hide="!auth.canSave('new')">
                                            New<span class="caret"></span>
                                        </button>
                                        <ul class="dropdown-menu" role="menu">
                                            <li role="menuitem">
                                                <form role="form" name="parts.permitlicense.form" novalidation>
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label for="newButton.regulation">Regulation</label>
                                                                <select ui-select2 ng-disabled="!auth.canSave('regulation')" id="newButton.regulation" class="form-control input-sm" ng-model="newButton.regulation"  ng-required="true">
                                                                    <option ng-repeat="v in valuelists.permit_license_regulations" value="{{v.id}}">{{v.description1}}</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row" ng-if="newButton.regulation==idPermit">
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label for="newButton.ecosystem">Ecosystem</label>
                                                                <select ui-select2 ng-disabled="!auth.canSave('ecosystem')" id="newButton.ecosystem" class="form-control input-sm" ng-model="newButton.ecosystem" ng-required="true">
                                                                    <option ng-repeat="v in valuelists.permit_license_ecosystem" value="{{v.id}}">{{v.description1}}</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label for="newButton.regulation_activity">Regulation activities</label>
                                                                <select ui-select2 ng-disabled="!auth.canSave('regulation_activity') || !isEcosystemWetland(newButton)" id="newButton.regulation_activity" class="form-control input-sm"
                                                                        ng-model="newButton.regulation_activity" ng-required="isEcosystemWetland(newButton)">
                                                                    <option ng-repeat="v in valuelists.permit_license_regulation_activity_wetland" value="{{v.id}}">{{v.description1}}</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label for="newButton.area">Area</label>
                                                                <div class="row">
                                                                    <div class="col-md-6">
                                                                        <input type="text" decimal ng-readonly="!auth.canSave('area')" class="form-control input-sm" id="newButton.area" ng-model="newButton.area" ng-required="true"/>
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <select ui-select2 ng-disabled="!auth.canSave('unit')" id="newButton.unit" class="form-control input-sm" ng-model="newButton.unit" ng-required="true">
                                                                            <option ng-repeat="v in valuelists.permit_license_area_units" value="{{v.id}}">{{v.description1}}</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">

                                                                        <label for="newButton.approved_by_the_lc1">LC1 approved</label>
                                                                        <input type="checkbox" class="checkbox-small form-control input-sm" id="newButton.approved_by_the_lc1"
                                                                               ng-model="fake_approved_by_the_lc1" ng-checked="newButton.approved_by_the_lc1"
                                                                               ng-click="newButton.approved_by_the_lc1 = !newButton.approved_by_the_lc1"
                                                                               ng-disabled="!auth.canSave('approved_by_the_lc1')"/>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group">

                                                                        <label for="newButton.approved_by_the_dec">DEC approved</label>
                                                                        <input type="checkbox" class="checkbox-small form-control input-sm" id="newButton.approved_by_the_dec"
                                                                               ng-model="fake_approved_by_the_dec" ng-checked="newButton.approved_by_the_dec"
                                                                               ng-click="newButton.approved_by_the_dec = !newButton.approved_by_the_dec"
                                                                               ng-disabled="!auth.canSave('approved_by_the_dec')"/>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row" ng-if="newButton.regulation==idLicense">
                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <label for="newButton.waste_license_type">Waste license type</label>
                                                                <select ui-select2 ng-disabled="!auth.canSave('waste_license_type')" id="newButton.waste_license_type" class="form-control input-sm" ng-model="newButton.waste_license_type" ng-required="true">
                                                                    <option ng-repeat="v in valuelists.permit_license_waste_license_type" value="{{v.id}}">{{v.description1}}</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">

                                                                        <label for="newButton.approved_by_the_dec2">DEC approved</label>
                                                                        <input type="checkbox" class="checkbox-small form-control input-sm" id="newButton.approved_by_the_dec2"
                                                                               ng-model="fake_approved_by_the_dec" ng-checked="newButton.approved_by_the_dec"
                                                                               ng-click="newButton.approved_by_the_dec = !newButton.approved_by_the_dec"
                                                                               ng-disabled="!auth.canSave('approved_by_the_dec')"/>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <label for="newButton.create">&nbsp;</label><br>
                                                            <button type="button" class="btn btn-sm btn-primary use-button pull-right"
                                                                    id="newButton.create"
                                                                    ng-disabled="parts.permitlicense.form.$invalid"
                                                                    ng-click="newPermitLicense()">Create
                                                            </button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </li>
                                        </ul>
                                    </div>
                                </th>
                            </tr>
                            </thead>
                            <tbody class="edit-row" ng-repeat="pl in data.permitslicenses">
                            <tr class="master" ng-class="{selected: routeParams.permitlicenseId==pl.id, notvalid: routeParams.permitlicenseId==pl.id && parts.permitlicense.form.$invalid}"
                                ng-click="openPermitLicense(pl.id, $event)">
                                <td>{{pl.id}}</td>
                                <td>{{data.getCodeFromValuelist('permitlicencestatus', pl.status)}}</td>
                                <td>{{pl.date_submitted | date:'d MMM yyyy'}}</td>
                                <td>{{data.getCodeFromValuelist('permit_license_regulations', pl.regulation)}}</td>
                                <td>{{data.getCodeFromValuelist('team_leader_eia_permit', pl.user_id)}}</td>
                                <td>{{data.getCodeFromValuelist('decision', pl.decision)}}</td>
                                <td>{{pl.date_permit_license | date:'d MMM yyyy'}}</td>
                                <td>
                                    <div style="min-width:65px;">
                                        <a class="btn btn-xs btn-link pull-right text-right" ng-click="preventClickIfDisabled(notOkToEditOrCreateNew(), $event)" ng-disabled="notOkToEditOrCreateNew()" ng-show="routeParams.permitlicenseId!=pl.id" ng-href="#/projects/{{routeParams.projectId}}/permitslicenses/{{pl.id}}">{{auth.canSave('new') ? "Edit" : "Open"}}</a>
                                        <a class="btn btn-xs btn-link pull-right text-right" ng-click="preventClickIfDisabled(parts.permitlicense.state == SavingStateEnum.Loading, $event)" ng-disabled="parts.permitlicense.state == SavingStateEnum.Loading" ng-show="routeParams.permitlicenseId==pl.id && !data.permitlicense.is_new" ng-href="#/projects/{{routeParams.projectId}}/permitslicenses">Close</a>
                                        <span class="loader pull-right" ng-show="routeParams.permitlicenseId==pl.id && parts.permitlicense.state == SavingStateEnum.Loading"></span>
                                    </div>
                                </td>
                            </tr>
                            <tr ng-if="shouldShowPermitLicense(pl)" class="detail">
                                <td colspan="8">
                                    <form role="form" name="parts.permitlicense.form" novalidation>

                                        <!--<div class="row">-->
                                            <!--<div class="col-md-3">-->
                                                <!--<div class="form-group">-->
                                                    <!--<label for="pl.regulation">Regulation</label>-->
                                                    <!--<select ui-select2 ng-change="saveCurrentPermitLicense(pl)" ng-disabled="!auth.canSave('regulation')" id="pl.regulation" class="form-control input-sm" ng-model="pl.regulation">-->
                                                        <!--<option ng-repeat="v in valuelists.permit_license_regulations" value="{{v.id}}">{{v.description1}}</option>-->
                                                    <!--</select>-->
                                                <!--</div>-->
                                            <!--</div>-->
                                        <!--</div>-->

                                        <div class="row" ng-if="pl.regulation==idPermit">
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="ecosystem">Ecosystem</label>
                                                    <select ui-select2 ng-change="saveCurrentPermitLicense(pl)" ng-disabled="!auth.canSave('ecosystem')" id="ecosystem" class="form-control input-sm" ng-model="pl.ecosystem" ng-required="true">
                                                        <option ng-repeat="v in valuelists.permit_license_ecosystem" value="{{v.id}}">{{v.description1}}</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="regulation_activity">Regulation activities</label>
                                                    <select ui-select2 ng-change="saveCurrentPermitLicense(pl)" ng-disabled="!auth.canSave('regulation_activity') || !isEcosystemWetland(pl)" id="regulation_activity" class="form-control input-sm"
                                                            ng-model="pl.regulation_activity" ng-required="isEcosystemWetland(pl)">
                                                        <option ng-repeat="v in valuelists.permit_license_regulation_activity_wetland" value="{{v.id}}">{{v.description1}}</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="area">Area</label>
                                                    <div class="row">
                                                        <div class="col-md-6">
                                                            <input type="text" decimal ng-blur="saveCurrentPermitLicense(pl)" ng-readonly="!auth.canSave('area')" class="form-control input-sm" id="area" ng-model="pl.area" ng-required="true"/>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <select ui-select2 ng-change="saveCurrentPermitLicense(pl)" ng-disabled="!auth.canSave('unit')" id="unit" class="form-control input-sm" ng-model="pl.unit" ng-required="true">
                                                                <option ng-repeat="v in valuelists.permit_license_area_units" value="{{v.id}}">{{v.description1}}</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-group">

                                                            <label for="approved_by_the_lc1">LC1 approved</label>
                                                            <input type="checkbox" class="checkbox-small form-control input-sm" id="approved_by_the_lc1"
                                                                   ng-model="fake_approved_by_the_lc1" ng-checked="data.permitlicense.approved_by_the_lc1"
                                                                   ng-click="data.permitlicense.approved_by_the_lc1 = !data.permitlicense.approved_by_the_lc1; saveCurrentPermitLicense(pl)"
                                                                   ng-disabled="!auth.canSave('approved_by_the_lc1')"/>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-group">

                                                            <label for="approved_by_the_dec">DEC approved</label>
                                                            <input type="checkbox" class="checkbox-small form-control input-sm" id="approved_by_the_dec"
                                                                   ng-model="fake_approved_by_the_dec" ng-checked="data.permitlicense.approved_by_the_dec"
                                                                   ng-click="data.permitlicense.approved_by_the_dec = !data.permitlicense.approved_by_the_dec; saveCurrentPermitLicense(pl)"
                                                                   ng-disabled="!auth.canSave('approved_by_the_dec')"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row" ng-if="pl.regulation==idLicense">
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.waste_license_type">Waste license type</label>
                                                    <select ui-select2 ng-change="saveCurrentPermitLicense(pl)" ng-disabled="!auth.canSave('waste_license_type')" id="pl.waste_license_type" class="form-control input-sm" ng-model="pl.waste_license_type" ng-required="true">
                                                        <option ng-repeat="v in valuelists.permit_license_waste_license_type" value="{{v.id}}">{{v.description1}}</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-group">

                                                            <label for="approved_by_the_dec2">DEC approved</label>
                                                            <input type="checkbox" class="checkbox-small form-control input-sm" id="approved_by_the_dec2"
                                                                   ng-model="fake_approved_by_the_dec" ng-checked="data.permitlicense.approved_by_the_dec"
                                                                   ng-click="data.permitlicense.approved_by_the_dec = !data.permitlicense.approved_by_the_dec; saveCurrentPermitLicense(pl)"
                                                                   ng-disabled="!auth.canSave('approved_by_the_dec')"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.date_submitted">Date of submission</label>
                                                    <div class="input-group container-datepicker" ng-controller="DatePickerController">
                                                        <input type="text" ng-blur="saveCurrentPermitLicense(pl)" ng-required="true" ng-change="calculateDateFeedbackToApplicants()" ng-readonly="!auth.canSave('date_submitted')" id="pl.date_submitted" class="form-control input-sm input-date" ng-model="pl.date_submitted" datepicker-popup="d MMM yyyy" data-is-open="opened" data-datepicker-options="datepickerOptions" data-show-button-bar="false"/>
                                                        <span class="input-group-btn">
                                                            <button type="button" ng-disabled="!auth.canSave('date_submitted')" class="btn btn-default btn-sm" ng-click="open($event)">
                                                                <span class="glyphicon glyphicon-calendar"></span>
                                                            </button>
                                                          </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label>Application form</label>
                                                    <div class="uploaded-files">
                                                        <div class="file" ng-repeat="d in pl.documentation | filter:documentationData.ApplicationForm.tag">
                                                            <a ng-href="{{downloadFileUrl(d.id)}}">{{d.filename}}</a>
                                                            <sero-delete-button class="delete-button" 
                                                            text="'delete'"
                                                            warning="'NB! You are now going to delete this document. Do you want to proceed?'"
                                                            button-class="'delete btn btn-sm btn-link'"
                                                            ng-hide="!auth.canSave('delete')"
                                                            on-yes="deleteDocumentation(pl, d.id, documentationData.ApplicationForm)"></sero-delete-button>

                                                        </div>
                                                    </div>
                                                    <div>
                                                        <button class="btn btn-sm btn-default"
                                                                type="button"
                                                                ngf-select="uploadDocumentation(pl, documentationData.ApplicationForm, $files)"
                                                                accept="{{fileUploadPattern}}"
                                                                ngf-pattern="{{fileUploadNgfPattern}}"
                                                                ng-model="fake_documentation_applicationform"
                                                                name="documentation_applicationform"
                                                                ng-hide="hasDocumentationTag(pl.documentation, documentationData.ApplicationForm.tag)"
                                                                ng-disabled="!auth.canSave('new')"
                                                                ngf-max-size="{{fileUploadMaxSize}}">
                                                            Select File
                                                        </button>
                                                        <div class="uploading-file ng-hide cssSlideUp" ng-show="documentationData.ApplicationForm.showUploading">
                                                            <div class="file">{{documentationData.ApplicationForm.file.name}}<br/>
                                                                <div class="progress">
                                                                    <div class="progress-bar" role="progressbar" aria-valuenow="{{documentationData.ApplicationForm.file.progress}}" aria-valuemin="0" aria-valuemax="100"
                                                                         style="width: {{documentationData.ApplicationForm.file.progress}}%;">
                                                                        {{documentationData.ApplicationForm.file.progress}}%
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="errors" ng-messages="parts.permitlicense.form.documentation_applicationform.$error" role="alert">
                                                                <div ng-message="pattern">The file type is not supported.</div>
                                                                <div ng-message="serverError">Something went wrong on the server.</div>
                                                                <div ng-message="maxSize">The file is to big.</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.application_number">Application number</label>
                                                    <input type="text" integer ng-blur="saveCurrentPermitLicense(pl)" ng-required="true" ng-readonly="!auth.canSave('application_number')" class="form-control input-sm" id="pl.application_number" ng-model="pl.application_number"/>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.application_fee_receipt_number">Application fee receipt number</label>
                                                    <input type="text" ng-blur="saveCurrentPermitLicense(pl)" ng-required="false" ng-readonly="!auth.canSave('application_fee_receipt_number')" class="form-control input-sm" id="pl.application_fee_receipt_number" ng-model="pl.application_fee_receipt_number"/>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.date_feedback_to_applicants">Date feedback to applicants</label>
                                                    <div class="input-group container-datepicker" ng-controller="DatePickerController">
                                                        <input type="text" ng-readonly="true" id="pl.date_feedback_to_applicants" class="form-control input-sm input-date" ng-model="pl.date_feedback_to_applicants" datepicker-popup="d MMM yyyy" data-is-open="opened" data-datepicker-options="datepickerOptions" data-show-button-bar="false"/>
                                                        <span class="input-group-btn">
                                                            <button type="button" ng-disabled="true" class="btn btn-default btn-sm" ng-click="open($event)">
                                                                <span class="glyphicon glyphicon-calendar"></span>
                                                            </button>
                                                          </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.date_sent_to_director">Date sent to Director</label>
                                                    <div class="input-group container-datepicker" ng-controller="DatePickerController">
                                                        <input type="text" ng-blur="saveCurrentPermitLicense(pl)" ng-required="false" ng-readonly="!auth.canSave('date_sent_to_director')" id="pl.date_sent_to_director" class="form-control input-sm input-date" ng-model="pl.date_sent_to_director" datepicker-popup="d MMM yyyy" data-is-open="opened" data-datepicker-options="datepickerOptions" data-show-button-bar="false"/>
                                                        <span class="input-group-btn">
                                                            <button type="button" ng-disabled="!auth.canSave('date_sent_to_director')" class="btn btn-default btn-sm" ng-click="open($event)">
                                                                <span class="glyphicon glyphicon-calendar"></span>
                                                            </button>
                                                          </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.date_sent_from_dep">Date sent to team leader from dep</label>
                                                    <div class="input-group container-datepicker" ng-controller="DatePickerController">
                                                        <input type="text" ng-blur="saveCurrentPermitLicense(pl)" ng-required="false" ng-readonly="!auth.canSave('date_sent_from_dep')" id="pl.date_sent_from_dep" class="form-control input-sm input-date" ng-model="pl.date_sent_from_dep" datepicker-popup="d MMM yyyy" data-is-open="opened" data-datepicker-options="datepickerOptions" data-show-button-bar="false"/>
                                                        <span class="input-group-btn">
                                                            <button type="button" ng-disabled="!auth.canSave('date_sent_from_dep')" class="btn btn-default btn-sm" ng-click="open($event)">
                                                                <span class="glyphicon glyphicon-calendar"></span>
                                                            </button>
                                                          </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.date_sent_officer">Date sent to the officer</label>
                                                    <div class="input-group container-datepicker" ng-controller="DatePickerController">
                                                        <input type="text" ng-blur="saveCurrentPermitLicense(pl)" ng-required="false" ng-readonly="!auth.canSave('date_sent_officer')" id="pl.date_sent_officer" class="form-control input-sm input-date" ng-model="pl.date_sent_officer" datepicker-popup="d MMM yyyy" data-is-open="opened" data-datepicker-options="datepickerOptions" data-show-button-bar="false"/>
                                                        <span class="input-group-btn">
                                                            <button type="button" ng-disabled="!auth.canSave('date_sent_officer')" class="btn btn-default btn-sm" ng-click="open($event)">
                                                                <span class="glyphicon glyphicon-calendar"></span>
                                                            </button>
                                                          </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.folio_no">File and foliono.</label>
                                                    <input type="text" ng-blur="saveCurrentPermitLicense(pl)" ng-readonly="!auth.canSave('folio_no')" class="form-control input-sm" id="pl.folio_no" ng-model="pl.folio_no"/>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.application_evaluation_by_officer">Application evaluation by officer</label>
                                                    <select ui-select2="{allowClear:true}" ng-change="saveCurrentPermitLicense(pl)" ng-disabled="!auth.canSave('application_evaluation_by_officer')" id="pl.application_evaluation_by_officer" class="form-control input-sm" ng-model="pl.application_evaluation_by_officer" ng-required="false">
                                                        <option></option>
                                                        <option ng-repeat="v in valuelists.permit_license_application_evaluation" value="{{v.id}}">{{v.description1}}</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.date_of_evaluation">Date of evaluation</label>
                                                    <div class="input-group container-datepicker" ng-controller="DatePickerController">
                                                        <input type="text" ng-blur="saveCurrentPermitLicense(pl)" ng-required="false" ng-readonly="!auth.canSave('date_of_evaluation')" id="pl.date_of_evaluation" class="form-control input-sm input-date" ng-model="pl.date_of_evaluation" datepicker-popup="d MMM yyyy" data-is-open="opened" data-datepicker-options="datepickerOptions" data-show-button-bar="false"/>
                                                        <span class="input-group-btn">
                                                            <button type="button" ng-disabled="!auth.canSave('date_of_evaluation')" class="btn btn-default btn-sm" ng-click="open($event)">
                                                                <span class="glyphicon glyphicon-calendar"></span>
                                                            </button>
                                                          </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="user_id">Team leader</label>
                                                    <select ui-select2 ng-change="saveCurrentPermitLicense(pl)" ng-disabled="!auth.canSave('user_id')" id="user_id" class="form-control input-sm" ng-model="pl.user_id">
                                                        <option ng-repeat="v in valuelists.team_leader_eia_permit | filter:criteriaMatchOfficer1(pl.user_id)" ng-class="{'dropdown-partition-bar': v.id == false, 'dropdown-inactive-item': (v.is_passive == 1 && v.id != false) }"  ng-disabled="v.id == false" value="{{v.id}}">{{v.description1}}</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="users">Officers to handle</label>
                                                    <select ui-select2 multiple="true" placeholder="Click to pick"
                                                            ng-change="saveCurrentPermitLicense(pl)"
                                                            ng-disabled="!auth.canSave('personnel')" id="users"
                                                            class="form-control input-sm"
                                                            ng-model="pl.user_ids">
                                                        <option ng-repeat="v in valuelists.officer_eia_permit | filter:criteriaMatchOfficer(pl.user_ids)" value="{{v.id}}" ng-class="{'dropdown-partition-bar': v.id == false, 'dropdown-inactive-item': (v.is_passive == 1 && v.id != false) }" ng-disabled="v.id == false">
                                                            {{v.description1}}
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="inspection_recommended">Inspection before decision?</label>
                                                    <select ui-select2 ng-change="saveCurrentPermitLicense(pl)" ng-disabled="!auth.canSave('inspection_recommended')" id="inspection_recommended" class="form-control input-sm" ng-model="pl.inspection_recommended">
                                                        <option ng-repeat="v in valuelists.yesno" value="{{v.id}}">{{v.description1}}</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.date_inspection">Date of inspection</label>
                                                    <div class="input-group container-datepicker" ng-controller="DatePickerController">
                                                        <input type="text" ng-blur="saveCurrentPermitLicense(pl)" ng-required="false" ng-readonly="!auth.canSave('date_inspection')" id="pl.date_inspection" class="form-control input-sm input-date" ng-model="pl.date_inspection" datepicker-popup="d MMM yyyy" data-is-open="opened" data-datepicker-options="datepickerOptions" data-show-button-bar="false"/>
                                                        <span class="input-group-btn">
                                                            <button type="button" ng-disabled="!auth.canSave('date_inspection')" class="btn btn-default btn-sm" ng-click="open($event)">
                                                                <span class="glyphicon glyphicon-calendar"></span>
                                                            </button>
                                                          </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.officer_recommend">Recommendations by reviewer</label>
                                                    <input type="text" ng-blur="saveCurrentPermitLicense(pl)" ng-readonly="!auth.canSave('officer_recommend')" class="form-control input-sm" id="pl.officer_recommend" ng-model="pl.officer_recommend"/>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.date_sent_for_decision">Date to {{pl.regulation==idPermit ? "ED" : "committee"}} for decision</label>
                                                    <div class="input-group container-datepicker" ng-controller="DatePickerController">
                                                        <input type="text" ng-blur="saveCurrentPermitLicense(pl)" ng-required="false" ng-readonly="!auth.canSave('date_sent_for_decision')" id="pl.date_sent_for_decision" class="form-control input-sm input-date" ng-model="pl.date_sent_for_decision" datepicker-popup="d MMM yyyy" data-is-open="opened" data-datepicker-options="datepickerOptions" data-show-button-bar="false"/>
                                                        <span class="input-group-btn">
                                                            <button type="button" ng-disabled="!auth.canSave('date_sent_for_decision')" class="btn btn-default btn-sm" ng-click="open($event)">
                                                                <span class="glyphicon glyphicon-calendar"></span>
                                                            </button>
                                                          </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.decision">Decision taken</label>
                                                    <select ui-select2="{allowClear:true}" ng-change="saveCurrentPermitLicense(pl)" ng-disabled="!auth.canSave('decision')" id="pl.decision" class="form-control input-sm" ng-model="pl.decision" ng-required="false">
                                                        <option></option>
                                                        <option ng-repeat="v in valuelists.decision" value="{{v.id}}">{{v.description1}}</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.signature_on_permit_license">Signature on {{pl.regulation==idPermit ? "permit" : "license"}}</label>
                                                    <select ui-select2 ng-change="saveCurrentPermitLicense(pl)" ng-disabled="!auth.canSave('signature_on_permit_license')" id="pl.signature_on_permit_license" class="form-control input-sm" ng-model="pl.signature_on_permit_license">
                                                        <option ng-repeat="v in valuelists.executivedirector" value="{{v.id}}">{{v.description1}}</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.fee_receipt_no">{{pl.regulation==idPermit ? "Permit" : "License"}} fee receipt number</label>
                                                    <input type="text" decimal ng-blur="saveCurrentPermitLicense(pl)" ng-readonly="!auth.canSave('fee_receipt_no')" class="form-control input-sm" id="pl.fee_receipt_no" ng-model="pl.fee_receipt_no"/>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.date_fee_payed">Date {{pl.regulation==idPermit ? "permit" : "license"}} fee paid</label>
                                                    <div class="input-group container-datepicker" ng-controller="DatePickerController">
                                                        <input type="text" ng-blur="saveCurrentPermitLicense(pl)" ng-required="false" ng-readonly="!auth.canSave('date_fee_payed')" id="pl.date_fee_payed" class="form-control input-sm input-date" ng-model="pl.date_fee_payed" datepicker-popup="d MMM yyyy" data-is-open="opened" data-datepicker-options="datepickerOptions" data-show-button-bar="false"/>
                                                        <span class="input-group-btn">
                                                            <button type="button" ng-disabled="!auth.canSave('date_fee_payed')" class="btn btn-default btn-sm" ng-click="open($event)">
                                                                <span class="glyphicon glyphicon-calendar"></span>
                                                            </button>
                                                          </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.date_permit_license">Date on the {{pl.regulation==idPermit ? "permit" : "license"}}</label>
                                                    <div class="input-group container-datepicker" ng-controller="DatePickerController">
                                                        <input type="text" ng-blur="saveCurrentPermitLicense(pl)" ng-required="false" ng-readonly="!auth.canSave('date_permit_license')" id="pl.date_permit_license" class="form-control input-sm input-date" ng-model="pl.date_permit_license" datepicker-popup="d MMM yyyy" data-is-open="opened" data-datepicker-options="datepickerOptions" data-show-button-bar="false"/>
                                                        <span class="input-group-btn">
                                                            <button type="button" ng-disabled="!auth.canSave('date_permit_license')" class="btn btn-default btn-sm" ng-click="open($event)">
                                                                <span class="glyphicon glyphicon-calendar"></span>
                                                            </button>
                                                          </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.permit_license_no">{{pl.regulation==idPermit ? "Permit" : "License"}} number</label>
                                                    <input type="text" integer ng-blur="saveCurrentPermitLicense(pl)" ng-required="false" ng-readonly="!auth.canSave('permit_license_no')" class="form-control input-sm" id="pl.permit_license_no" ng-model="pl.permit_license_no"/>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="pl.date_permit_license_expired">Date {{pl.regulation==idPermit ? "permit" : "license"}} expire</label>
                                                    <div class="input-group container-datepicker" ng-controller="DatePickerController">
                                                        <input type="text" ng-blur="saveCurrentPermitLicense(pl)" ng-required="false" ng-readonly="!auth.canSave('date_permit_license_expired')" id="pl.date_permit_license_expired" class="form-control input-sm input-date" ng-model="pl.date_permit_license_expired" datepicker-popup="d MMM yyyy" data-is-open="opened" data-datepicker-options="datepickerOptions" data-show-button-bar="false"/>
                                                        <span class="input-group-btn">
                                                            <button type="button" ng-disabled="!auth.canSave('date_permit_license_expired')" class="btn btn-default btn-sm" ng-click="open($event)">
                                                                <span class="glyphicon glyphicon-calendar"></span>
                                                            </button>
                                                          </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label>{{pl.regulation==idPermit ? "Permit" : "License"}}</label>
                                                    <div class="uploaded-files">
                                                        <div class="file" ng-repeat="d in pl.documentation | filter:documentationData.PermitLicense.tag">
                                                            <a ng-href="{{downloadFileUrl(d.id)}}">{{d.filename}}</a>

                                                            <sero-delete-button class="delete-button" 
                                                            text="'delete'"
                                                            warning="'NB! You are now going to delete this document. Do you want to proceed?'"
                                                            button-class="'delete btn btn-sm btn-link'"
                                                            ng-hide="!auth.canSave('delete_documentation_permit_license')"
                                                            on-yes="deleteDocumentation(pl, d.id, documentationData.PermitLicense)"></sero-delete-button>
    
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <button class="btn btn-sm btn-default"
                                                                type="button"
                                                                ngf-select="uploadDocumentation(pl, documentationData.PermitLicense, $files)"
                                                                accept="{{fileUploadPattern}}"
                                                                ngf-pattern="{{fileUploadNgfPattern}}"
                                                                ng-model="fake_documentation_permitlicense"
                                                                name="documentation_permitlicense"
                                                                ng-hide="hasDocumentationTag(pl.documentation, documentationData.PermitLicense.tag)"
                                                                ng-disabled="!auth.canSave('upload_documentation_permit_license')"
                                                                ngf-max-size="{{fileUploadMaxSize}}">
                                                            Select File
                                                        </button>
                                                        <div class="uploading-file ng-hide cssSlideUp" ng-show="documentationData.PermitLicense.showUploading">
                                                            <div class="file">{{documentationData.PermitLicense.file.name}}<br/>
                                                                <div class="progress">
                                                                    <div class="progress-bar" role="progressbar" aria-valuenow="{{documentationData.PermitLicense.file.progress}}" aria-valuemin="0" aria-valuemax="100"
                                                                         style="width: {{documentationData.PermitLicense.file.progress}}%;">
                                                                        {{documentationData.PermitLicense.file.progress}}%
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="errors" ng-messages="parts.permitlicense.form.documentation_permitlicense.$error" role="alert">
                                                                <div ng-message="pattern">The file type is not supported.</div>
                                                                <div ng-message="serverError">Something went wrong on the server.</div>
                                                                <div ng-message="maxSize">The file is to big.</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label>Attachments to the application</label>
                                                    <div class="uploaded-files">
                                                        <div class="file" ng-repeat="d in pl.documentation | filter:documentationData.Attachments.tag">
                                                            <a ng-href="{{downloadFileUrl(d.id)}}">{{d.filename}}</a>

                                                            <sero-delete-button class="delete-button" 
                                                            text="'delete'"
                                                            warning="'NB! You are now going to delete this document. Do you want to proceed?'"
                                                            button-class="'delete btn btn-sm btn-link'"
                                                            ng-hide="!auth.canSave('delete')"
                                                            on-yes="deleteDocumentation(pl, d.id, documentationData.Attachments)"></sero-delete-button>
    
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <button class="btn btn-sm btn-default"
                                                                type="button"
                                                                ngf-select="uploadDocumentation(pl, documentationData.Attachments, $files)"
                                                                accept="{{fileUploadPattern}}"
                                                                ngf-pattern="{{fileUploadNgfPattern}}"
                                                                ng-model="fake_documentation_attachments"
                                                                name="documentation_attachments"
                                                                ng-disabled="!auth.canSave('new')"
                                                                ngf-max-size="{{fileUploadMaxSize}}">
                                                            Select File
                                                        </button>
                                                        <div class="uploading-file ng-hide cssSlideUp" ng-show="documentationData.Attachments.showUploading">
                                                            <div class="file">{{documentationData.Attachments.file.name}}<br/>
                                                                <div class="progress">
                                                                    <div class="progress-bar" role="progressbar" aria-valuenow="{{documentationData.Attachments.file.progress}}" aria-valuemin="0" aria-valuemax="100"
                                                                         style="width: {{documentationData.Attachments.file.progress}}%;">
                                                                        {{documentationData.Attachments.file.progress}}%
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="errors" ng-messages="parts.permitlicense.form.documentation_attachments.$error" role="alert">
                                                                <div ng-message="pattern">The file type is not supported.</div>
                                                                <div ng-message="serverError">Something went wrong on the server.</div>
                                                                <div ng-message="maxSize">The file is to big.</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group" ng-hide="!auth.canSave('recipient_email')" >
                                                    <label>Recipient Emails (;)</label>
                                                    <input type="text" class="form-control input-sm"
                                                    ng-blur="saveCurrentPermitLicense(pl)" id="email_contact" ng-model="pl.email_contact"/>
                                                    <span ng-show="invalidRecipients" class="text-danger">Invalid email format.Separate multiple emails with semicolons (;)</span>
                                                    </div>
                                            </div>
                                        </div>
<div class="row">
    <div class="col-md-10"></div>
    <div class="col-md-1">
        <button ng-hide="!auth.canSave('can_email')"
        ng-click="createEmailOrder('PL', pl.id, null, pl)"
        ng-disabled="!pl.email_contact || pl.email_order"
        class="btn btn-success pull-right"
        style="margin-top:35px;margin-right:20%"
        >{{(pl.id)?getEmailerObj(pl).btnMsg : 'Send email'}} </button>
    </div>
    <div class="col-md-1">
        <sero-delete-button ng-if="pl.regulation==idPermit" class="delete-button pull-right" ng-hide="!auth.canSave('delete')"
                text="'Delete permit'"
                warning="'Do you want to proceed?'"
                button-class="'btn-danger'"
                on-yes="deletePermitLicense()"></sero-delete-button>
        <sero-delete-button ng-if="pl.regulation==idLicense" class="delete-button pull-right" ng-hide="!auth.canSave('delete')"
                text="'Delete license'"
                warning="'Do you want to proceed?'"
                button-class="'btn-danger'"
                on-yes="deletePermitLicense()"></sero-delete-button>
    </div>
    <span ng-show="pl.email_order.order_status == 4" class="text-danger pull-right">
        Contact an admin to fix issue with email services
    </span>
    <span  ng-show="failedToSendMail" class="text-danger pull-right">
        We could not send the email because you havent added the email address or another mandatory information is missing
    </span>
</div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <p>(Dirty:{{parts.permitlicense.form.$dirty}}, valid:{{parts.permitlicense.form.$valid}})
                                                    <span class="saving-message-inline pull-right" ng-show="parts.permitlicense.state == SavingStateEnum.Loaded && !pl.is_new">Last changed by {{pl.updated_by}}</span>
                                                    <span class="saving-message-inline pull-right" ng-show="parts.permitlicense.state == SavingStateEnum.SavingStarted">Saving...</span>
                                                    <span class="saving-message-inline pull-right" ng-show="parts.permitlicense.state == SavingStateEnum.SavingFinished">All changes saved</span>
                                                    <span class="saving-message-inline pull-right color-error" ng-show="parts.permitlicense.state == SavingStateEnum.SavingFailed">Saving failed</span>
                                                    <span class="saving-message-inline pull-right color-error" ng-show="parts.permitlicense.state == SavingStateEnum.Invalid">All required fields must be filled out</span>
                                                </p>
                                            </div>
                                        </div>


                                    </form>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
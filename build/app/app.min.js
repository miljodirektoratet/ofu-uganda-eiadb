// Generated with grunt. Do not edit!

"use strict";function isNumberInRange(a,b,c){return null!==a&&a>c?!1:null!==b&&c>b?!1:!0}angular.$=angular.element,angular.$.prototype.parent=function(a){if(!a)return angular.$(this[0].parentNode);for(var b,c=[].slice.call(document.querySelectorAll(a)),d=this[0];"HTML"!==d.nodeName;){d=d.parentNode;var e=c.indexOf(d);-1===e||(b=d,d=document.documentElement)}return angular.$(b)};var seroApp=angular.module("seroApp",["ngRoute","ngResource","ngAnimate","ui.bootstrap","ui.select2","seroApp.services","seroApp.directives","seroApp.controllers","pax.validations"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"partials/home.html"}),a.when("/projects",{templateUrl:"partials/projects.html",controller:"ProjectsController"}),a.when("/projects/:id",{templateUrl:"partials/project.html",controller:"ProjectController"}),a.when("/about",{templateUrl:"partials/about.html"}),a.when("/notsignedin",{templateUrl:"partials/notsignedin.html",controller:"UserController"}),a.when("/user",{templateUrl:"partials/user.html",controller:"UserController"}),a.when("/advanced/practitioners",{templateUrl:"partials/practitioners.html",controller:"PractitionersController"}),a.otherwise({redirectTo:"/"})}]),SavingStateEnum={Loading:"Loading",Loaded:"Loaded",SavingStarted:"Saving started",SavingFinished:"Saving finished",SavingFailed:"Saving failed",Invalid:"Form not valid"},controllers=angular.module("seroApp.controllers",[]);controllers.controller("DatePickerController",["$scope",function(a){a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.datepickerOptions={startingDay:1}}]),controllers.controller("NavBarController",["$scope","$location","UserInfo",function(a,b,c){a.isActive=function(a){return a===b.path()},a.isAdvancedActive=function(a){return 0==b.path().indexOf(a)},a.userinfo=c}]),controllers.controller("UserController",["$scope","UserInfo",function(a,b){a.userinfo=b,a.userid_to_impersonate=null,a.impersonate=function(){a.userinfo.impersonate(a.userid_to_impersonate)}}]),controllers.controller("ProjectsController",["$scope","$location","$filter","Project","UserInfo",function(a,b,c,d,e){a.projects=d.query(),a.userinfo=e,a.goto=function(a){b.path(a)},a.canSave=function(){return a.userinfo.info.role_1}}]),controllers.controller("ProjectController",["$scope","$routeParams","$filter","$q","$animate","UserInfo","Project","Organisation","Valuelist",function(a,b,c,d,e,f,g,h,i){a.SavingStateEnum=SavingStateEnum,a.userinfo=f,a.params=b,a.projectTemplate="partials/projectProject.html",a.eiasAndPermitsTemplate="partials/projectEiasAndPermits.html",a.valuelists=i.get({id:"all"}),a.parts={project:{form:null,state:SavingStateEnum.Loading,resource:null},organisation:{form:null,state:SavingStateEnum.Loading,resource:null}},a.selectOrganisation=function(b){a.parts.organisation.resource=b,a.createNewProject(b),b.$get({},function(){a.parts.organisation.state=SavingStateEnum.Loaded})},a.hasSelectedOrganisation=function(){return null!=a.parts.organisation.resource},a.createNewOrganisation=function(){var b={is_new:!0};a.parts.organisation.resource=new h(b),a.parts.organisation.state=SavingStateEnum.Loaded,a.createNewProject(a.parts.organisation.resource)},a.createNewProject=function(b){var c={has_industrial_waste_water:41,organisation_id:b.id,is_new:!0};a.parts.project.resource=new g(c),a.parts.project.state=SavingStateEnum.Loaded},a.saveCurrentProject=function(){a.parts.project.resource.organisation_id&&a.saveCurrent(a.parts.project)},a.saveCurrentOrganisation=function(){a.saveCurrent(a.parts.organisation).then(function(b){a.parts.project.resource.organisation_id||(a.parts.project.resource.organisation_id=b.id,a.saveCurrentProject())})},a.saveCurrent=function(b){var c=d.defer(),e=b.form;return a.canSave()||a.canSaveGrade()?e.$invalid?(b.state=SavingStateEnum.Invalid,c.reject("Form is invalid")):e.$pristine?c.reject("Form is pristine"):(b.state=SavingStateEnum.SavingStarted,a.saveResource(b.resource).then(function(a){b.state=SavingStateEnum.SavingFinished,b.form.$setPristine(),c.resolve(a)},function(a){b.state=SavingStateEnum.SavingFailed,c.reject(a)})):c.reject("Not authorized to save"),c.promise},a.saveResource=function(a){var b=d.defer();return a.is_new?a.$save({},function(a){b.resolve(a)},function(){b.reject("Could not save new.")}):a.$update({},function(a){b.resolve(a)},function(){b.reject("Could not save existing.")}),b.promise},a.canSave=function(){return a.userinfo.info.role_1},a.canSaveGrade=function(){return a.userinfo.info.role_7},"new"==b.id?a.organisations=h.query():(a.parts.organisation.resource={},a.parts.project.resource=g.get({id:b.id},function(b){a.parts.project.state=SavingStateEnum.Loaded,a.parts.organisation.resource=h.get({id:b.organisation_id},function(){a.parts.organisation.state=SavingStateEnum.Loaded})}))}]),controllers.controller("PractitionersController",["$scope","$filter","$animate","UserInfo","Practitioner","Valuelist",function(a,b,c,d,e,f){function g(a){_.forEach(a.practitioner_certificates,function(a){a.date_of_entry=new Date(a.date_of_entry)})}a.certificateYearMin=2e3,a.certificateYearMax=(new Date).getFullYear()+1,a.certificateYearValid=2013,a.current=null,a.currentForm=null,a.userinfo=d,a.valuelists=f.get({id:"all"}),a.practitioners=e.query();var h=function(a,c,d){if(!a)return!1;var e=function(a){return a.cert_type!=c?!1:a.year!==d?!1:a.is_deleted?!1:a.is_cancelled?!1:!0};return b("filter")(a,e,!0).length>0};a.hasEia=function(b){var c=h(b.practitioner_certificates,10,a.certificateYearValid);return b.cert_eia=c?"eia":null,c},a.hasAudit=function(b){var c=h(b.practitioner_certificates,12,a.certificateYearValid);return b.cert_au=c?"audit":null,c},a.newPractitioner=function(){if(a.currentForm&&a.currentForm.$invalid)return void alert("Current form not valid. Can't create new practitioner.");var b={practitioner_certificates:[],is_new:!0},c=new e(b);a.practitioners.unshift(c),a.toggleRow(c)},a.deletePractitioner=function(b,c){a.current=null,c.is_new||c.$delete(),a.practitioners.splice(b,1)},a.deleteCertificate=function(a,b,c){c.is_new?b.practitioner_certificates.splice(a,1):c.is_deleted=!0},a.newCertificate=function(b){var c={year:a.certificateYearValid,date_of_entry:new Date,is_new:!0};c.cert_no=a.certificateNumber(c),b.practitioner_certificates.unshift(c)},a.canSave=function(){return a.userinfo.info.role_6};var i=function(b){a.canSave()&&(b.is_new?b.$save({},function(a){g(a),j()}):b.$update({},function(a){g(a),j()}))};a.toggleRow=function(b){if(!a.loading){if(a.canSave()&&a.current){var c=a.current,d=a.currentForm;if(d.$invalid)return void alert("Form not valid. Can't save.");d.$dirty&&(i(c),d.$setPristine())}a.current==b?a.current=null:b.is_new?a.current=b:(a.loading=b,b.$get({},function(c){g(c),a.loading=null,a.current=b}))}},a.setCurrentForm=function(b){a.currentForm=b},a.certificateNumber=function(b){var c="E",d=_.find(a.valuelists.practitionertype,{id:b.cert_no});d&&(c=d.description1);var e="XXX",f=b.year.toString().substr(2),g="CC/"+c+"/"+e+"/"+f;return g},a.changeNumericBoolean=function(a){return 0===a?1:0};var j=function(){};a.practitionerOrderBy=function(a){var b=a.person.trim().substring(a.person.trim().lastIndexOf(" "));return b}}]);var directives=angular.module("seroApp.directives",[]).directive("appVersion",["version",function(a){return function(b,c){c.text(a)}}]);directives.directive("addPractitionerButton",["Practitioner",function(a){return{restrict:"A",link:function(b,c){c.bind("click",function(){var b=new a({person:"Gunnar Nymann",city:"Oslo"});b.$save()})}}}]),directives.directive("animateNewElement",["$animate",function(a){return function(b,c,d){b.$watch(d.animateNewElement,function(b){if(b===!0){console.log(c);var d="new-element";a.addClass(c,d,function(){a.removeClass(c,d)})}})}}]),directives.directive("hoverOnParent",[function(){return{restrict:"A",link:function(a,b,c){var d=c.hoverOnParent;b.parent(d).bind("mouseenter",function(){b.addClass("btn-link-hover")}),b.parent(d).bind("mouseleave",function(){b.removeClass("btn-link-hover")})}}}]),directives.directive("coordinatePasting",function(){return{require:"ngModel",link:function(a,b,c,d){console.log("here"),d.$setViewValue("0.12104"),d.$render()}}}),directives.directive("focus",function(){return function(a,b,c){c.$observe("focus",function(a){"true"===a&&b[0].focus()})}});var version={version:"0.0.22"},services=angular.module("seroApp.services",[]).value("version",version.version);services.factory("Practitioner",["$resource",function(a){return a("/api/public/v1/practitioner/:id",{id:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Project",["$resource",function(a){return a("/api/public/v1/project/:id",{id:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Organisation",["$resource",function(a){return a("/api/public/v1/organisation/:id",{id:"@id"},{update:{method:"PUT",isArray:!1}})}]),services.factory("Valuelist",["$resource",function(a){return a("/api/public/v1/valuelist/:id",{id:"@id"})}]),services.service("UserInfo",["$http","$location",function(a,b){var c={info:{}},d={full_name:"Not signed in",role_1:!1,role_2:!1,role_3:!1,role_4:!1,role_5:!1,role_6:!1,role_7:!1,role_8:!1,roles:[]},e=function(){"/notsignedin"==b.path()&&b.path("/")},f=function(){b.path("/notsignedin")},g=function(a){a?(_.merge(c.info,a),e()):c.info=_.cloneDeep(d)},h=function(){a.get("/api/public/user/info").success(g).error(f)};return c.impersonate=function(b){g(null),a.get("/api/public/user/impersonate/"+b).success(g)},c.signout=function(){a.get("/api/public/signout").success(function(){g(null),b.path("/notsignedin")})},c.getAllUsers=function(){a.get("/api/public/user/all").success(function(a){c.allusers=a})},g(null),h(),c}]);var validations=angular.module("pax.validations",[]);validations.directive("decimal",function(){return{require:"ngModel",link:function(a,b,c,d){var e=c.min?parseFloat(c.min):null,f=c.max?parseFloat(c.max):null,g=c.decimal?"{0,"+parseInt(c.decimal)+"}":"+",h=c.negativeNumber?"\\-?":"",i=new RegExp("^"+h+"\\d+((\\.|\\,)\\d"+g+")?$");d.$parsers.unshift(function(a){if(null==a||""===a)return void d.$setValidity("float",!0);if(i.test(a)){var b=a;if("number"!=typeof a&&(b=parseFloat(a.replace(",","."))),isNumberInRange(e,f,b))return d.$setValidity("float",!0),b}return void d.$setValidity("float",!1)}),d.$formatters.push(function(a){if(null==a||""===a)return void d.$setValidity("float",!0);if(i.test(a)){var b=a;if("number"!=typeof a&&(b=parseFloat(a.replace(",","."))),isNumberInRange(e,f,b))return d.$setValidity("float",!0),b}return d.$setValidity("float",!1),a})}}}),validations.directive("integer",function(){return{require:"ngModel",link:function(a,b,c,d){var e=c.min?parseInt(c.min):null,f=c.max?parseInt(c.max):null,g=c.negativeNumber?"\\-?":"",h=new RegExp("^"+g+"\\d+$");d.$parsers.unshift(function(a){if(null==a||""===a)return void d.$setValidity("integer",!0);if(h.test(a)){var b=parseInt(a);if(isNumberInRange(e,f,b))return d.$setValidity("integer",!0),b}return void d.$setValidity("integer",!1)}),d.$formatters.push(function(a){if(null==a||""===a)return void d.$setValidity("integer",!0);if(h.test(a)){var b=parseInt(a);if(isNumberInRange(e,f,b))return d.$setValidity("integer",!0),b}return d.$setValidity("integer",!1),a})}}}),validations.directive("certificateNumber",function(){return{require:"ngModel",link:function(a,b,c,d){var e=new RegExp("^CC/(EIA|EA)/[0-9]{3}/[0-9]{2}$");d.$parsers.unshift(function(a){return null==a||""===a?void d.$setValidity("certificate-number",!0):e.test(a)?(d.$setValidity("certificate-number",!0),a):void d.$setValidity("certificate-number",!1)}),d.$formatters.push(function(a){return null==a||""===a?void d.$setValidity("certificate-number",!0):e.test(a)?(d.$setValidity("certificate-number",!0),a):(d.$setValidity("certificate-number",!1),a)})}}});
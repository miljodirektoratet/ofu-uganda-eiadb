<div class="row project-project">

  <div class="col-md-12 project-project-new" ng-if="!hasSelectedOrganisation()">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h2 class="panel-title">Select organisation for the new project</h2>
      </div>
      <div class="panel-body">
        <div class="row">
          <div class="col-md-8">
            <form class="form-inline" role="form">
              <div class="form-group">
                <label class="sr-only" for="filterText">Filter</label>
                <input type="text" focus="true" class="form-control input-filter" id="filterText" placeholder="Filter" ng-model="filterText">
              </div>
              <span>Count: {{(organisations | filter:filterText).length}}</span>
            </form>
          </div>
          <div class="col-md-4">
            <button type="button" class="btn btn-success pull-right" ng-click="createNewOrganisation()" ng-disabled="!canSave()">New organisation</button>
          </div>
          <div class="col-md-12"><hr/></div>
        </div>

        <div class="row header visible-md visible-lg">
          <div class="col-md-3">Name</div>
          <div class="col-md-3">Visiting address</div>
          <div class="col-md-3">City</div>
          <div class="col-md-2">Contact person</div>
          <div class="col-md-1"></div>
        </div>

        <div class="row project" ng-repeat="o in organisations | filter:filterText">
          <div class="col-md-12">
            <div class="row master" ng-click="selectOrganisation(o)">
              <div class="col-md-3" title="id={{o.id}}">{{o.name}}</div>
              <div class="col-md-3">{{o.visiting_address}}</div>
              <div class="col-md-3">{{o.city}}</div>
              <div class="col-md-2 hidden-xs">{{o.contact_person}}</div>
              <button type="button" class="btn btn-xs btn-link pull-right text-right" hover-on-parent=".master">Select</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-6 project-project-project" ng-if="hasSelectedOrganisation()">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h2 class="panel-title" title="id={{parts.project.resource.id}} oid={{parts.project.resource.organisation_id}}">Project (Dirty:{{parts.project.form.$dirty}}, valid:{{parts.project.form.$valid}})
          <span class="loader pull-right" ng-show="parts.project.state == SavingStateEnum.Loading"></span>
          <span class="saving-message-inline pull-right" ng-show="parts.project.state == SavingStateEnum.Loaded && !parts.project.resource.is_new">Last changed by {{parts.project.resource.updated_by}}</span>
          <span class="saving-message-inline pull-right" ng-show="parts.project.state == SavingStateEnum.SavingStarted">Saving...</span>
          <span class="saving-message-inline pull-right" ng-show="parts.project.state == SavingStateEnum.SavingFinished">All changes saved</span>
          <span class="saving-message-inline pull-right color-error" ng-show="parts.project.state == SavingStateEnum.SavingFailed">Saving failed</span>
          <span class="saving-message-inline pull-right color-error" ng-show="parts.project.state == SavingStateEnum.Invalid">All required fields must be filled out</span>
        </h2>
      </div>
      <div class="panel-body">
        <form role="form" name="parts.project.form" novalidation>
          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="title">Title</label>
                <input type="text" ng-blur="saveCurrentProject()" ng-readonly="!canSave()" ng-required="true" class="form-control input-sm" id="title" ng-model="parts.project.resource.title" />
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="category_id">Category of project</label>
                <select ui-select2="{allowClear:false}" ng-change="saveCurrentProject()" ng-disabled="!canSave()" id="category_id" ng-required="true" class="form-control input-sm" ng-model="parts.project.resource.category_id">
                  <option ng-repeat="v in valuelists.category" value="{{v.id}}">{{v.description1}}</option>
                </select>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="district_id">District</label>
                <select ui-select2="{allowClear:false}" ng-change="saveCurrentProject()" ng-disabled="!canSave()" id="district_id" ng-required="true" class="form-control input-sm" ng-model="parts.project.resource.district_id">
                  <option ng-repeat="v in valuelists.district" value="{{v.id}}">{{v.description1}}</option>
                </select>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="additional_districs">Additional districts</label>
                <select ui-select2 multiple="true" placeholder="Click to pick" ng-change="saveCurrentProject()" ng-disabled="!canSave()" id="additional_districs" class="form-control input-sm" ng-model="parts.project.resource.district_ids">
                  <option ng-repeat="v in valuelists.district" value="{{v.id}}">{{v.description1}}</option>
                </select>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="location">Location</label>
                <input type="text"  ng-blur="saveCurrentProject()" ng-readonly="!canSave()" ng-required="true" class="form-control input-sm" id="location" ng-model="parts.project.resource.location" />
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-group">
                <label for="longitude">Longitude</label>
                <input type="text" ng-blur="saveCurrentProject()" decimal ng-readonly="!canSave()" class="form-control input-sm" id="longitude" ng-model="parts.project.resource.longitude" />
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-group">
                <label for="latitude">Latitude</label>
                <input type="text" ng-blur="saveCurrentProject()" decimal ng-readonly="!canSave()" class="form-control input-sm" id="latitude" ng-model="parts.project.resource.latitude" />
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-7">
              <div class="form-group">
                <label for="has_industrial_waste_water">Discharge of industrial waste water?</label>
                <select ui-select2="{allowClear:false}" ng-change="saveCurrentProject()" ng-disabled="!canSave()" id="has_industrial_waste_water" ng-required="false" class="form-control input-sm" ng-model="parts.project.resource.has_industrial_waste_water">
                  <option ng-repeat="v in valuelists.yesno" value="{{v.id}}">{{v.description1}}</option>
                </select>
              </div>
            </div>
            <div class="col-md-5">
              <div class="form-group">
                <label for="grade">Grade</label>
                <select ui-select2="{allowClear:true}" ng-change="saveCurrentProject()" ng-disabled="!canSaveGrade()" id="grade" ng-required="false" class="form-control input-sm" ng-model="parts.project.resource.grade">
                  <option></option>
                  <option ng-repeat="v in valuelists.grade" value="{{v.id}}">{{v.description1}}</option>
                </select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <div class="form-group">
                <label for="project_remarks">Remarks</label>
                <textarea ng-blur="saveCurrentProject()" ng-readonly="!canSave()" class="form-control input-sm" rows="3" id="project_remarks" ng-model="parts.project.resource.remarks"></textarea>
              </div>
            </div>
          </div>

        </form>
      </div>
    </div>

  </div>

  <div class="col-md-6 project-project-organisation" ng-if="hasSelectedOrganisation()">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h2 class="panel-title" title="id={{parts.organisation.resource.id}}">Organisation (Dirty:{{parts.organisation.form.$dirty}}, valid:{{parts.organisation.form.$valid}})
          <span class="loader pull-right" ng-show="parts.organisation.state == SavingStateEnum.Loading"></span>
          <span class="saving-message-inline pull-right" ng-show="parts.organisation.state == SavingStateEnum.Loaded && !parts.organisation.resource.is_new">Last changed by {{parts.organisation.resource.updated_by}}</span>
          <span class="saving-message-inline pull-right" ng-show="parts.organisation.state == SavingStateEnum.SavingStarted">Saving...</span>
          <span class="saving-message-inline pull-right" ng-show="parts.organisation.state == SavingStateEnum.SavingFinished">All changes saved</span>
          <span class="saving-message-inline pull-right color-error" ng-show="parts.organisation.state == SavingStateEnum.SavingFailed">Saving failed</span>
          <span class="saving-message-inline pull-right color-error" ng-show="parts.organisation.state == SavingStateEnum.Invalid">All required fields must be filled out</span>
        </h2>
      </div>
      <div class="panel-body">
        <form role="form" name="parts.organisation.form" novalidation>

          <div class="row">
            <div class="col-md-8">
              <div class="form-group">
                <label for="name">Name</label>
                <input type="text" ng-blur="saveCurrentOrganisation()" ng-readonly="!canSave()" ng-required="true" class="form-control input-sm" id="name" ng-model="parts.organisation.resource.name" />
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-group">
                <label for="tin">TIN</label>
                <input type="text" ng-blur="saveCurrentOrganisation()" ng-readonly="!canSave()" integer class="form-control input-sm" id="tin" ng-model="parts.organisation.resource.tin"/>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-5">
              <div class="form-group">
                <label for="visiting_address">Visiting address</label>
                <input type="text" ng-blur="saveCurrentOrganisation()" ng-readonly="!canSave()" class="form-control input-sm" id="visiting_address" ng-model="parts.organisation.resource.visiting_address" />
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-group">
                <label for="box_no">PO Box</label>
                <input type="text" ng-blur="saveCurrentOrganisation()" integer ng-readonly="!canSave()" ng-required="true" class="form-control input-sm" id="box_no" ng-model="parts.organisation.resource.box_no" />
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-group">
                <label for="city">City</label>
                <input type="text" ng-blur="saveCurrentOrganisation()" ng-readonly="!canSave()" ng-required="true" class="form-control input-sm" id="city" ng-model="parts.organisation.resource.city" />
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="phone">Phone</label>
                <input type="text" ng-blur="saveCurrentOrganisation()" ng-readonly="!canSave()" class="form-control input-sm" id="phone" ng-model="parts.organisation.resource.phone" />
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="fax">Fax</label>
                <input type="text" ng-blur="saveCurrentOrganisation()" ng-readonly="!canSave()" class="form-control input-sm" id="fax" ng-model="parts.organisation.resource.fax" />
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="form-group">
                <label for="email">Email</label>
                <input type="email" ng-blur="saveCurrentOrganisation()" ng-readonly="!canSave()" class="form-control input-sm" id="email" ng-model="parts.organisation.resource.email" />
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-group">
                <label for="contact_person">Contact person</label>
                <input type="text" ng-blur="saveCurrentOrganisation()" ng-readonly="!canSave()" class="form-control input-sm" id="contact_person" ng-model="parts.organisation.resource.contact_person" />
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-12">
              <div class="form-group">
                <label for="organisation_remarks">Remarks</label>
                <textarea ng-blur="saveCurrentOrganisation()" ng-readonly="!canSave()" class="form-control input-sm" rows="3" id="organisation_remarks" ng-model="parts.organisation.resource.remarks"></textarea>
              </div>
            </div>
          </div>

        </form>
      </div>
    </div>
  </div>

</div>